<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Li Jie&#39;s blog
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>

  

  

<link rel="alternate" href="/atom.xml" title="Li Jie's blog" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/chineselijie"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover3.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Li Jie&#39;s blog</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-13.linux--linux系统磁盘管理" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/13.linux--linux系统磁盘管理/"
    >Linux系统磁盘管理</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/13.linux--linux系统磁盘管理/" class="article-date">
  <time datetime="2019-08-29T15:44:18.590Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>[toc]</p>
<h2 id="磁盘基本概述"><a href="#磁盘基本概述" class="headerlink" title="磁盘基本概述"></a>磁盘基本概述</h2><h3 id="磁盘分类"><a href="#磁盘分类" class="headerlink" title="磁盘分类"></a>磁盘分类</h3><ul>
<li>固态硬盘</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/04/28/EMoKrq.jpg" alt></p>
<p><img src="https://s2.ax1x.com/2019/04/28/EMoas1.jpg" alt></p>
<ul>
<li>机械硬盘</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/04/28/EMoOLq.jpg" alt></p>
<p><img src="https://s2.ax1x.com/2019/04/28/EMoxoT.jpg" alt></p>
<ul>
<li>服务器硬盘</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/04/28/EMT9W4.jpg" alt></p>
<h3 id="固态硬盘的优缺点"><a href="#固态硬盘的优缺点" class="headerlink" title="固态硬盘的优缺点"></a>固态硬盘的优缺点</h3><p>优点：</p>
<ul>
<li>读写速度快</li>
<li>防震抗摔性</li>
<li>低功耗</li>
<li>无噪音</li>
<li>工作温度范围大</li>
<li>轻便</li>
</ul>
<p>缺点</p>
<ul>
<li>容量小</li>
<li>寿命有限制</li>
<li>售价高</li>
</ul>
<h3 id="Linux中磁盘命令方式"><a href="#Linux中磁盘命令方式" class="headerlink" title="Linux中磁盘命令方式"></a>Linux中磁盘命令方式</h3><p>Linux中磁盘的命名方式与磁盘的接口有关，规则如下：</p>
<ul>
<li>传统IDE接口硬盘：<code>/dev/hd[a-z]</code></li>
<li>SCISI接口硬盘：<code>/dev/sd[a-z]</code></li>
<li>虚拟化硬盘：<code>/dev/vd[a-z]</code></li>
</ul>
<p>在设备名称的定义规则如下, 其他的分区可以以此类推<br>系统的第一块SCSI接口的硬盘名称为<code>/dev/sda</code><br>系统的第二块SCSI接口的硬盘名称为<code>/dev/sdb</code><br>系统中分区由数字编号表示, 1-4留给主分区使用和扩展分区, 逻辑分区从5开始</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//第一块磁盘</span><br><span class="line">/dev/sda</span><br><span class="line">//第一块磁盘的第一个分区</span><br><span class="line">/dev/sda1</span><br><span class="line">//第二块磁盘的第一个分区</span><br><span class="line">/dev/sdb1</span><br></pre></td></tr></table></figure>

<h3 id="MBR与GPT"><a href="#MBR与GPT" class="headerlink" title="MBR与GPT"></a>MBR与GPT</h3><p>在使用新磁盘之前，你必须对其进行分区。MBR（Master Boot Record）和GPT（GUID Partition Table）是在磁盘上存储分区信息的两种不同方式。这些分区信息包含了分区从哪里开始的信息，这样操作系统才知道哪个扇区是属于哪个分区的，以及哪个分区是可以启动的。在磁盘上创建分区时，你必须在MBR和GPT之间做出选择</p>
<p>MBR是Master Boot Record的简称，也就是主引导记录，是位于磁盘最前边的一段引导（Loader）代码，主要用来引导操作系统的加载与启动，在传统<a href="https://www.baidu.com/s?wd=硬盘&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">硬盘</a>分区模式中，引导扇区是每个分区（Partition）的第一扇区，而主引导扇区是硬盘的第一扇区。为了方便计算机访问硬盘，把硬盘上的空间划分成许许多多的区块（英文叫sectors，即扇区），然后给每个区块分配一个地址，称为逻辑块地址（即LBA）。</p>
<blockquote>
<p>特点：</p>
<ol>
<li>MBR支持最大2TB磁盘，它无法处理大于2TB容量的磁盘</li>
<li>只支持最多4个主分区。若想要更多分区，需要创建扩展分区，并在其中创建逻辑分区</li>
</ol>
</blockquote>
<p>GPT磁盘是指使用GUID分区表的磁盘，GUID磁盘分区表（GUID Partition Table，缩写：GPT）其含义为“全局唯一标识磁盘分区表”，是一个实体硬盘的分区表的结构布局的标准，</p>
<blockquote>
<p>特点：</p>
<ol>
<li>GPT对磁盘大小没有限制</li>
<li>最多可以创建128个分区</li>
</ol>
</blockquote>
<p><strong>注意：</strong></p>
<blockquote>
<p>MBR与GPT之间互相转换会导致数据丢失</p>
</blockquote>
<p><a href="https://baike.baidu.com/item/%E4%B8%BB%E5%BC%95%E5%AF%BC%E8%AE%B0%E5%BD%95/7612638?fromtitle=mbr&fromid=10473976" target="_blank" rel="noopener">MBR</a></p>
<p><a href="https://baike.baidu.com/item/GPT/15413476" target="_blank" rel="noopener">GPT</a></p>
<p><a href="https://blog.csdn.net/u011198997/article/details/78734628" target="_blank" rel="noopener">MBR和GPT分区区别</a></p>
<h2 id="磁盘容量检查"><a href="#磁盘容量检查" class="headerlink" title="磁盘容量检查"></a>磁盘容量检查</h2><p>使用<code>df</code>命令查看磁盘容量，不加参数以k为单位：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">df -i   //查看inode使用情况</span><br><span class="line">df -h   //以G或者T或者M人性化方式显示</span><br><span class="line">df -T   //查看文件类型</span><br><span class="line"></span><br><span class="line">//使用df命令查看磁盘，下面分别介绍每列什么含义</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># df -Th</span></span><br><span class="line">文件系统              类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/rhel-root xfs        17G  3.4G   14G   20% /</span><br><span class="line">devtmpfs              devtmpfs  977M     0  977M    0% /dev</span><br><span class="line">tmpfs                 tmpfs     993M  5.9M  987M    1% /dev/shm</span><br><span class="line">tmpfs                 tmpfs     993M  9.1M  984M    1% /run</span><br><span class="line">tmpfs                 tmpfs     993M     0  993M    0% /sys/fs/cgroup</span><br><span class="line">/dev/sr0              iso9660   3.8G  3.8G     0  100% /mnt/cdrom</span><br><span class="line">/dev/sda1             xfs      1014M  161M  854M   16% /boot</span><br><span class="line">tmpfs                 tmpfs     199M   28K  199M    1% /run/user/0</span><br></pre></td></tr></table></figure>

<p>使用<code>lsblk</code>查看分区情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment">#  lsblk</span></span><br><span class="line">NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda             8:0    0   20G  0 disk</span><br><span class="line">├─sda1          8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2          8:2    0   19G  0 part</span><br><span class="line">  ├─rhel-root 253:0    0   17G  0 lvm  /</span><br><span class="line">  └─rhel-swap 253:1    0    2G  0 lvm  [SWAP]</span><br><span class="line">sr0            11:0    1  3.8G  0 rom  /mnt/cdrom</span><br></pre></td></tr></table></figure>

<p>使用<code>du</code>命令查看目录或者文件的容量，不加参数以k为单位：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">du -sh opt  //人性化输出显示大小</span><br><span class="line">-s：列出总和</span><br><span class="line">-h：人性化显示容量信息</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看etc目录的大小</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># du -sh /etc</span></span><br><span class="line">43M     /etc</span><br></pre></td></tr></table></figure>

<h2 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><p>分区之前, 需要先给虚拟机添加一块磁盘，以便于我们做后续的实验vmware虚拟机，请按如下进行操作:</p>
<blockquote>
<p>1.找到对应虚拟主机点击右键, 选择设置<br>2.在硬件向导里面点击添加按钮, 在硬件类型中选中“硬盘”, 点击下一步<br>3.磁盘类型选择默认, 然后创建新虚拟磁盘, 调整大小(不要勾选立即分配空间)<br>4.最后点击下一步, 完成即可</p>
</blockquote>
<p><strong>分区工具有fdisk和gdisk，当硬盘小于2T的时候我们应该用fdisk来分区，而当硬盘大于2T的时候则应用gdisk来进行分区</strong></p>
<h3 id="fdisk分区"><a href="#fdisk分区" class="headerlink" title="fdisk分区"></a>fdisk分区</h3><blockquote>
<p>生产分区建议：如无特殊希求，直接使用整个磁盘即可，无需分区</p>
</blockquote>
<blockquote>
<p>学习分区建议： 1P+1E(3L) 2P+1E(2L) 3P+1E(1L) (仅适用于练习)</p>
<p>1P:一个主分区</p>
<p>1E:一个扩展分区</p>
<p>3L:三个逻辑分区</p>
</blockquote>
<blockquote>
<p> <strong>本章切记 学习分区加入两块磁盘，虚拟机中会出现/dev/sdb，sdc，请使用sdb或者sdc来练习，最好fdisk分区使用/dev/sdb，gdisk分区使用/dev/sdc</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># fdisk -l /dev/sda</span></span><br><span class="line"></span><br><span class="line">磁盘 /dev/sda：21.5 GB, 21474836480 字节，41943040 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x000bf37c</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># fdisk /dev/sda</span></span><br><span class="line">欢迎使用 fdisk (util-linux 2.23.2)。</span><br><span class="line"></span><br><span class="line">更改将停留在内存中，直到您决定将更改写入磁盘。</span><br><span class="line">使用写入命令前请三思。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：m     //输入m获取帮助</span><br><span class="line">命令操作</span><br><span class="line">   a   toggle a bootable flag     //切换分区启动标记</span><br><span class="line">   b   edit bsd disklabel          //编辑sdb磁盘标签 </span><br><span class="line">   c   toggle the dos compatibility flag   //切换dos兼容模式 </span><br><span class="line">   d   delete a partition          //删除分区</span><br><span class="line">   g   create a new empty GPT partition table   //创建新的空GPT分区表</span><br><span class="line">   G   create an IRIX (SGI) partition table     //创建IRIX（SGI）分区表</span><br><span class="line">   l   list known partition types     //显示分区类型</span><br><span class="line">   m   <span class="built_in">print</span> this menu               //显示帮助菜单</span><br><span class="line">   n   add a new partition           //新建分区 </span><br><span class="line">   o   create a new empty DOS partition table    //创建新的空白分区表    </span><br><span class="line">   p   <span class="built_in">print</span> the partition table         //显示分区表的信息</span><br><span class="line">   q   quit without saving changes        //不保存退出</span><br><span class="line">   s   create a new empty Sun disklabel   //创建新的Sun磁盘标签</span><br><span class="line">   t   change a partition<span class="string">'s system id      //修改分区ID,可以通过l查看id</span></span><br><span class="line"><span class="string">   u   change display/entry units           //修改容量单位,磁柱或扇区</span></span><br><span class="line"><span class="string">   v   verify the partition table          //检验分区表 </span></span><br><span class="line"><span class="string">   w   write table to disk and exit         //保存退出 </span></span><br><span class="line"><span class="string">   x   extra functionality (experts only)    //拓展功能</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 创建主分区</span></span><br><span class="line"><span class="string">命令(输入 m 获取帮助)：n   //新建分区</span></span><br><span class="line"><span class="string">Partition type:</span></span><br><span class="line"><span class="string">   p   primary (0 primary, 0 extended, 4 free)    //主分区</span></span><br><span class="line"><span class="string">   e   extended       //扩展分区    </span></span><br><span class="line"><span class="string">Select (default p): p      //选择主分区  </span></span><br><span class="line"><span class="string">分区号 (1-4，默认 1)：     //默认回车</span></span><br><span class="line"><span class="string">起始 扇区 (2048-41943039，默认为 2048)：   //默认扇区回车</span></span><br><span class="line"><span class="string">将使用默认值 2048</span></span><br><span class="line"><span class="string">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2048-41943039，默认为 41943039)：+505M  //分配505M</span></span><br><span class="line"><span class="string">分区 1 已设置为 Linux 类型，大小设为 505 MiB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 创建扩展分区</span></span><br><span class="line"><span class="string">命令(输入 m 获取帮助)：n    //新建分区</span></span><br><span class="line"><span class="string">Partition type:</span></span><br><span class="line"><span class="string">   p   primary (1 primary, 0 extended, 3 free)</span></span><br><span class="line"><span class="string">   e   extended</span></span><br><span class="line"><span class="string">Select (default p): e     //创建扩展分区</span></span><br><span class="line"><span class="string">分区号 (2-4，默认 2)：     //默认回车</span></span><br><span class="line"><span class="string">起始 扇区 (1036288-41943039，默认为 1036288)：   //默认扇区回车</span></span><br><span class="line"><span class="string">将使用默认值 1036288</span></span><br><span class="line"><span class="string">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (1036288-41943039，默认为 41943039)：     //默认划分所有空间给扩展分区</span></span><br><span class="line"><span class="string">将使用默认值 41943039</span></span><br><span class="line"><span class="string">分区 2 已设置为 Extended 类型，大小设为 19.5 GiB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 创建逻辑分区</span></span><br><span class="line"><span class="string">命令(输入 m 获取帮助)：n   //新建分区</span></span><br><span class="line"><span class="string">Partition type:</span></span><br><span class="line"><span class="string">   p   primary (1 primary, 1 extended, 2 free)</span></span><br><span class="line"><span class="string">   l   logical (numbered from 5)</span></span><br><span class="line"><span class="string">Select (default p): l      //创建逻辑分区</span></span><br><span class="line"><span class="string">添加逻辑分区 5</span></span><br><span class="line"><span class="string">起始 扇区 (1038336-41943039，默认为 1038336)：</span></span><br><span class="line"><span class="string">将使用默认值 1038336</span></span><br><span class="line"><span class="string">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (1038336-41943039，默认为 41943039)：+10G   //分配10G的逻辑分区</span></span><br><span class="line"><span class="string">分区 5 已设置为 Linux 类型，大小设为 10 GiB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查看分区创建</span></span><br><span class="line"><span class="string">命令(输入 m 获取帮助)：p</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">磁盘 /dev/sda：21.5 GB, 21474836480 字节，41943040 个扇区</span></span><br><span class="line"><span class="string">Units = 扇区 of 1 * 512 = 512 bytes</span></span><br><span class="line"><span class="string">扇区大小(逻辑/物理)：512 字节 / 512 字节</span></span><br><span class="line"><span class="string">I/O 大小(最小/最佳)：512 字节 / 512 字节</span></span><br><span class="line"><span class="string">磁盘标签类型：dos</span></span><br><span class="line"><span class="string">磁盘标识符：0x000bf37c</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   设备 Boot      Start         End      Blocks   Id  System</span></span><br><span class="line"><span class="string">/dev/sda1            2048     1036287      517120   83  Linux</span></span><br><span class="line"><span class="string">/dev/sda2         1036288    41943039    20453376    5  Extended</span></span><br><span class="line"><span class="string">/dev/sda5         1038336    22009855    10485760   83  Linux</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 保存分区</span></span><br><span class="line"><span class="string">命令(输入 m 获取帮助)：w</span></span><br><span class="line"><span class="string">The partition table has been altered!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Calling ioctl() to re-read partition table.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">WARNING: Re-reading the partition table failed with error 16: 设备或资源忙.</span></span><br><span class="line"><span class="string">The kernel still uses the old table. The new table will be used at</span></span><br><span class="line"><span class="string">the next reboot or after you run partprobe(8) or kpartx(8)</span></span><br><span class="line"><span class="string">正在同步磁盘。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 检查磁盘是否是MBR分区方式</span></span><br><span class="line"><span class="string">[root@zhoulijie ~]# fdisk -l /dev/sda | grep 类型</span></span><br><span class="line"><span class="string">磁盘标签类型：dos</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"># 安装parted, 刷新内核立即生效,无需重启</span></span><br><span class="line"><span class="string">[root@zhoulijie ~]# yum -y install parted</span></span><br><span class="line"><span class="string">[root@zhoulijie ~]# partprobe /dev/sda</span></span><br></pre></td></tr></table></figure>

<h3 id="gdisk分区"><a href="#gdisk分区" class="headerlink" title="gdisk分区"></a>gdisk分区</h3><blockquote>
<p><strong>在这里可以把刚才加入的磁盘拿出来使用：/dev/sdc，下面sda都皆是指代sdc</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装gdisk工具</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># yum -y install gdisk</span></span><br><span class="line"></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># gdisk /dev/sda</span></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): n       //创建新分区</span><br><span class="line">Partition number (1-128, default 1):     //默认回车 </span><br><span class="line">First sector (34-41943006, default = 2048) or &#123;+-&#125;size&#123;KMGTP&#125;:    //默认扇区回车</span><br><span class="line">Last sector (2048-41943006, default = 41943006) or &#123;+-&#125;size&#123;KMGTP&#125;: +505M   //分配505M空间   </span><br><span class="line">Current <span class="built_in">type</span> is <span class="string">'Linux filesystem'</span></span><br><span class="line">Hex code or GUID (L to show codes, Enter = 8300):     //默认回车 </span><br><span class="line">Changed <span class="built_in">type</span> of partition to <span class="string">'Linux filesystem'</span></span><br><span class="line"></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): p    //打印查看</span><br><span class="line">Disk /dev/sda: 41943040 sectors, 20.0 GiB</span><br><span class="line">Logical sector size: 512 bytes</span><br><span class="line">Disk identifier (GUID): 2EFF9F0B-87D9-4140-9ECE-AFBE23BB0C81</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">First usable sector is 34, last usable sector is 41943006</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 40908733 sectors (19.5 GiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048         1036287   505.0 MiB   8300  Linux filesystem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): w   //保存分区</span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING</span><br><span class="line">PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y/N): y       //确认</span><br><span class="line">OK; writing new GUID partition table (GPT) to /dev/sda.</span><br><span class="line">Warning: The kernel is still using the old partition table.</span><br><span class="line">The new table will be used at the next reboot.</span><br><span class="line">The operation has completed successfully.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查磁盘是否是gpt格式</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># fdisk -l /dev/sda | grep 类型</span></span><br><span class="line">WARNING: fdisk GPT support is currently new, and therefore <span class="keyword">in</span> an experimental phase. Use at your own discretion.</span><br><span class="line">磁盘标签类型：gpt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装parted, 刷新内核立即生效,无需重启</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># yum -y install parted</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># partprobe /dev/sda</span></span><br></pre></td></tr></table></figure>

<h2 id="磁盘格式化"><a href="#磁盘格式化" class="headerlink" title="磁盘格式化"></a>磁盘格式化</h2><p>使用<code>mkfs</code>命令格式化磁盘，创建文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs常用的选项有</span></span><br><span class="line">-b  //设定数据区块占用空间大小，目前支持1024、2048、4096 bytes每个块。</span><br><span class="line">-t  //用来指定什么类型的文件系统，可以是ext3，ext4, xfs</span><br><span class="line">-i  //设定inode的大小</span><br><span class="line">-N  //设定inode数量，防止Inode数量不够导致磁盘不足</span><br><span class="line">-L  //预设该分区的标签label</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先使用lsblk，列出磁盘分区情况</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># lsblk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化整个sdb磁盘为ext4文件系统</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkfs.ext4  /dev/sdb1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以使用-t指定方式创建ext4文件系统</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkfs -t ext4  /dev/sdb1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以格式化sdb1分区为xfs文件系统</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkfs.xfs  /dev/sdb1</span></span><br></pre></td></tr></table></figure>

<h2 id="磁盘挂载"><a href="#磁盘挂载" class="headerlink" title="磁盘挂载"></a>磁盘挂载</h2><p>在上面的内容中讲到了磁盘的分区和格式化, 那么格式化完了后, 如何使用, 这就涉及到了挂载这块磁盘</p>
<blockquote>
<p>挂载分区前需要创建挂载点, 挂载点以目录形式出现<br>如果往挂载点目录写入数据, 实际上会写入到该分区<br>挂载点建议是空目录, 不是也不影响挂载分区的使用，但是会隐藏原有的文件</p>
</blockquote>
<h3 id="临时挂载磁盘"><a href="#临时挂载磁盘" class="headerlink" title="临时挂载磁盘"></a>临时挂载磁盘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">命令：mount挂载磁盘，实质为文件系统指定访问入口</span><br><span class="line">mount -t       //指定文件系统挂载分区，如ext3，ext4, xfs</span><br><span class="line">mount -a       //重新读取/etc/fstab配置文件的所有分区</span><br><span class="line">mount -o       //指定挂载参数</span><br><span class="line"></span><br><span class="line"><span class="comment"># fstab被损坏情况下,让只读文件系统可写（正常情况下不使用）</span></span><br><span class="line">[root@localhost ~]<span class="comment">#mount -o rw，remount /  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 挂载/dev/sdb1至db1目录</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir /db1</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mount -t xfs /dev/sdb1  /db1</span></span><br></pre></td></tr></table></figure>

<h3 id="永久挂载磁盘"><a href="#永久挂载磁盘" class="headerlink" title="永久挂载磁盘"></a>永久挂载磁盘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//使用blkid命令获取各分区的UUID</span><br><span class="line">[root@localhost ~]# blkid |grep &quot;sdb1&quot;</span><br><span class="line">/dev/sdb1: UUID=&quot;e271b5b2-b1ba-4b18-bde5-66e394fb02d9&quot; TYPE=&quot;xfs&quot;</span><br><span class="line"></span><br><span class="line">//使用UUID挂载磁盘sdb1分区至于db1, 临时挂载</span><br><span class="line">[root@localhost ~]# mount UUID=&quot;e271b5b2-b1ba-4b18-bde5-66e394fb02d9&quot; /db1</span><br><span class="line"></span><br><span class="line">//也可以把下面这行写到/etc/fstab中，永久挂载, 开机自动挂载</span><br><span class="line">[root@localhost ~]# tail -1 /etc/fstab    </span><br><span class="line">UUID=e271b5b2-b1ba-4b18-bde5-66e394fb02d9 /db1 xfs  defaults 0  0</span><br><span class="line"></span><br><span class="line">//加载fstab配置文件, 同时检测语法是否有错误</span><br><span class="line">[root@localhost ~]# mount –a</span><br></pre></td></tr></table></figure>

<p><code>fstab</code>配置文件介绍：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/fstab</span><br><span class="line"></span><br><span class="line">//分区标识(UUID或设备名)                    挂载点 文件类型    挂载参数    不检查 不备份</span><br><span class="line">UUID=e271b5b2-b1ba-4b18-bde5-66e394fb02d9 /db1     xfs     defaults    0     0</span><br><span class="line"></span><br><span class="line">//挂载参数, 可写fstab配置文件, 也可以mount时使用-o参数指定</span><br><span class="line">参数              参数意义                               系统默认值</span><br><span class="line">async           系统每隔一段时间把内存数据写入磁盘中，</span><br><span class="line">sync            时时同步内存和磁盘中数据；</span><br><span class="line">suid，nosuid     允许/不允许分区有suid属性                suid</span><br><span class="line">rw，ro           可以指定文件系统是只读(ro)或可写(rw)       rw</span><br><span class="line">exec，noexec     允许/不允许可执行文件执行，不要挂载根分区    exec</span><br><span class="line">user，nouser     允许/不允许root外的其他用户挂载分区        nouser</span><br><span class="line">auto，noauto     开机自动挂载/不自动挂载                    auto</span><br><span class="line">default         默认文件系统挂载设置 rw, suid, dev, exec, auto, nouser, async</span><br><span class="line"></span><br><span class="line">//加载所有配置</span><br><span class="line">[root@localhost ~]# mount -a</span><br></pre></td></tr></table></figure>

<h3 id="卸载挂载磁盘"><a href="#卸载挂载磁盘" class="headerlink" title="卸载挂载磁盘"></a>卸载挂载磁盘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">umount -lf  //强制卸载挂载</span><br><span class="line"></span><br><span class="line">//使用站点目录卸载</span><br><span class="line">[root@localhost ~]# umount /db1</span><br><span class="line">//使用设备名卸载/dev/sdb1</span><br><span class="line">[root@localhost ~]# umount /dev/sdb1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//umount不能卸载的情况</span><br><span class="line">[root@localhost db1]# umount /db1  </span><br><span class="line">umount: /db1: device is busy.</span><br><span class="line">        (In some cases useful info about processes that use</span><br><span class="line">         the device is found by lsof(8) or fuser(1)</span><br><span class="line">       </span><br><span class="line">//如上情况解决办法有两种, 切换至其他目录 或使用&apos;-l&apos;选项强制卸载    </span><br><span class="line">[root@localhost db1]# umount -l /db1</span><br></pre></td></tr></table></figure>

<h2 id="学以致用环节"><a href="#学以致用环节" class="headerlink" title="学以致用环节"></a>学以致用环节</h2><blockquote>
<p>创建/mnt/cdrom目录，首先临时挂载光盘镜像，光盘镜像在/dev/cdrom</p>
<p>其次卸载挂载磁盘，然后永久挂载，写出详细的命令</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># mkdir /mnt/cdrom</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># mount /dev/cdrom /mnt/cdrom</span></span><br><span class="line">mount: /dev/sr0 写保护，将以只读方式挂载</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># df -Th</span></span><br><span class="line">文件系统              类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/rhel-root xfs        17G  3.4G   14G   20% /</span><br><span class="line">devtmpfs              devtmpfs  977M     0  977M    0% /dev</span><br><span class="line">tmpfs                 tmpfs     993M  5.9M  987M    1% /dev/shm</span><br><span class="line">tmpfs                 tmpfs     993M  9.1M  984M    1% /run</span><br><span class="line">tmpfs                 tmpfs     993M     0  993M    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1             xfs      1014M  161M  854M   16% /boot</span><br><span class="line">tmpfs                 tmpfs     199M   28K  199M    1% /run/user/0</span><br><span class="line">/dev/sr0              iso9660   3.8G  3.8G     0  100% /mnt/cdrom</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># umount /mnt/cdrom</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># df -Th</span></span><br><span class="line">文件系统              类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/rhel-root xfs        17G  3.4G   14G   20% /</span><br><span class="line">devtmpfs              devtmpfs  977M     0  977M    0% /dev</span><br><span class="line">tmpfs                 tmpfs     993M  5.9M  987M    1% /dev/shm</span><br><span class="line">tmpfs                 tmpfs     993M  9.1M  984M    1% /run</span><br><span class="line">tmpfs                 tmpfs     993M     0  993M    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1             xfs      1014M  161M  854M   16% /boot</span><br><span class="line">tmpfs                 tmpfs     199M   28K  199M    1% /run/user/0</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># cat /etc/fstab | tail -n 1</span></span><br><span class="line">/dev/cdrom       /mnt/cdrom       iso9660               defaults        0 0</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># mount -a</span></span><br><span class="line">mount: /dev/sr0 写保护，将以只读方式挂载</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># df -Th</span></span><br><span class="line">文件系统              类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/rhel-root xfs        17G  3.4G   14G   20% /</span><br><span class="line">devtmpfs              devtmpfs  977M     0  977M    0% /dev</span><br><span class="line">tmpfs                 tmpfs     993M  5.9M  987M    1% /dev/shm</span><br><span class="line">tmpfs                 tmpfs     993M  9.1M  984M    1% /run</span><br><span class="line">tmpfs                 tmpfs     993M     0  993M    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1             xfs      1014M  161M  854M   16% /boot</span><br><span class="line">tmpfs                 tmpfs     199M   28K  199M    1% /run/user/0</span><br><span class="line">/dev/sr0              iso9660   3.8G  3.8G     0  100% /mnt/cdrom</span><br></pre></td></tr></table></figure>

<h2 id="交换分区swap"><a href="#交换分区swap" class="headerlink" title="交换分区swap"></a>交换分区swap</h2><p>交换分区SWAP就是LINUX下的虚拟内存分区,它的作用是在物理内存使用完之后,将磁盘空间(也就是SWAP分区)虚拟成内存来使用。</p>
<p>交换分区一般指定虚拟内存的大小为实际内存的1~1.5倍。如果实际内存超过8GB，可以直接划分16GB给虚拟内存即可，如果虚拟内存不够用的情况，须增加一个虚拟磁盘，由于不能给原有的磁盘重新分区，所以可以选择新建。</p>
<h3 id="创建swapfile"><a href="#创建swapfile" class="headerlink" title="创建swapfile"></a>创建swapfile</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># dd if=/dev/zero of=/opt/newdisk bs=1M count=1024</span></span><br><span class="line">//<span class="keyword">if</span>：指定源  一般写/dev/zero</span><br><span class="line">//of：指定目标</span><br><span class="line">//bs：定义块大小</span><br><span class="line">//count：数量</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一般适用于制作光盘</span></span><br></pre></td></tr></table></figure>

<h3 id="格式化swap分区"><a href="#格式化swap分区" class="headerlink" title="格式化swap分区"></a>格式化swap分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># mkswap -f /opt/newdisk</span></span><br><span class="line">正在设置交换空间版本 1，大小 = 1048572 KiB</span><br><span class="line">无标签，UUID=f8ce4f29-2c01-4d93-8e9c-f1f7d7349526</span><br></pre></td></tr></table></figure>

<h3 id="检测当前swap分区情况"><a href="#检测当前swap分区情况" class="headerlink" title="检测当前swap分区情况"></a>检测当前swap分区情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># free -h</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.9G        958M         78M         24M        947M        766M</span><br><span class="line">Swap:          2.0G         16K        2.0G</span><br></pre></td></tr></table></figure>

<h3 id="开启新建的swap分区情况"><a href="#开启新建的swap分区情况" class="headerlink" title="开启新建的swap分区情况"></a>开启新建的swap分区情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># swapon /opt/newdisk</span></span><br><span class="line">swapon: /opt/newdisk：不安全的权限 0644，建议使用 0600。</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># free -h</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.9G        959M         77M         24M        947M        765M</span><br><span class="line">Swap:          3.0G         16K        3.0G</span><br><span class="line">        <span class="comment"># 此时此刻这里多出来1G</span></span><br></pre></td></tr></table></figure>

<h3 id="关闭新建的swap分区"><a href="#关闭新建的swap分区" class="headerlink" title="关闭新建的swap分区"></a>关闭新建的swap分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># swapoff /opt/newdisk</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># free -h</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.9G        958M         78M         24M        947M        766M</span><br><span class="line">Swap:          2.0G         16K        2.0G</span><br><span class="line">          <span class="comment"># 还原到原来的2G</span></span><br></pre></td></tr></table></figure>

<h2 id="生产磁盘故障案例"><a href="#生产磁盘故障案例" class="headerlink" title="生产磁盘故障案例"></a>生产磁盘故障案例</h2><p>Inode被占满，导致磁盘有可用的剩余空间也无法继续使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># dd if=/dev/zero of=/opt/newdisk bs=1k count=1024</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkfs.ext4 -i 1024 /opt/newdisk</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir /data</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mount -t ext4 -o loop /opt/newdisk /data/</span></span><br><span class="line"></span><br><span class="line">//inode被占满</span><br><span class="line">[root@localhost ~]<span class="comment"># touch &#123;1..20000&#125;</span></span><br><span class="line">touch: cannot touch `19997<span class="string">': No space left on device</span></span><br><span class="line"><span class="string">touch: cannot touch `19998'</span>: No space left on device</span><br><span class="line">touch: cannot touch `19999<span class="string">': No space left on device</span></span><br><span class="line"><span class="string">touch: cannot touch `20000'</span>: No space left on device</span><br><span class="line"></span><br><span class="line">//inode被占满，剩余block也是无法继续使用</span><br><span class="line">[root@localhost ~]<span class="comment"># df -i|grep data</span></span><br><span class="line">/opt/newdisk      1024  1024       0  100% /data</span><br><span class="line">[root@localhost ~]<span class="comment"># df -h|grep data</span></span><br><span class="line">/opt/newdisk    891K   34K  806K   5% /data</span><br></pre></td></tr></table></figure>

<p>Block空间即将被占满, 但删除大文件也没有释放空间</p>
<blockquote>
<p>假设现在线上正在运行Nginx服务, Nginx产生的日志已经达到了20个G, 磁盘眼看就看沾满了, 请问不重启Nginx的方式如何处理</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//是会删除文件, 但Nginx持续占用着文件, 所以空间并不会被释放</span><br><span class="line">rm -f access.log</span><br><span class="line"></span><br><span class="line">//正确做法如下, 清空该文件即可释放文件内容</span><br><span class="line">&gt; access.log</span><br><span class="line"><span class="comment"># 意思就是echo “” &gt; access.log</span></span><br><span class="line"><span class="comment">#  标准覆盖输出</span></span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">例子： 给系统新增加一个交换分区(swap)</span><br><span class="line"></span><br><span class="line">考试题目：一般是要求新建一个分区，并且把分区作为swap分区使用</span><br><span class="line"></span><br><span class="line">查看内存和交换分区的使用情况</span><br><span class="line"><span class="comment"># free -m</span></span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:          1841        613       1227         16          0        258</span><br><span class="line">-/+ buffers/cache:        354       1486</span><br><span class="line">Swap:            0          0          0  &lt;--- 没有交换分区</span><br><span class="line"></span><br><span class="line"><span class="comment"># swapon -s  也能用该命令查看，只是默认也是没有交换分区所有没有输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fdisk  -l /dev/sdb</span></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sdb2         2099200     6293503     2097152   83  Linux  &lt;---准备把该分区作为交换分区</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1、新建一个分区，并且把分区类型更改为82 </span><br><span class="line">    新分区我们在上面的练习已经完成了，所以本例子不用分区，而是需要修改该分区的类型</span><br><span class="line"></span><br><span class="line"><span class="comment"># fdisk  /dev/sdb</span></span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：l  列出所有支持的分区类型对应的id</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：t  修改分区id</span><br><span class="line">分区号 (1-5，默认 5)：2  修改第2个分区</span><br><span class="line">Hex 代码(输入 L 列出所有代码)：82  修改成id为82</span><br><span class="line">已将分区“Linux”的类型更改为“Linux swap / Solaris”</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：p</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sdb2         2099200     6293503     2097152   82  Linux swap / Solaris &lt;---修改成功</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：w</span><br><span class="line"></span><br><span class="line">强烈建议： 对分区做了修改后都刷新一下</span><br><span class="line"><span class="comment"># partprobe  /dev/sdb</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2、把sdb2格式化为交换分区</span><br><span class="line"><span class="comment"># mkswap  /dev/sdb2</span></span><br><span class="line">正在设置交换空间版本 1，大小 = 2097148 KiB</span><br><span class="line">无标签，UUID=ba08eb90-2003-44e6-9769-9a9351aebb05</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3、启动交换分区</span><br><span class="line"><span class="comment"># swapon /dev/sdb2  或者  # swanon -a  启动所有交换分区</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看</span><br><span class="line"><span class="comment"># swapon -s</span></span><br><span class="line">文件名             类型      大小  已用  权限</span><br><span class="line">/dev/sdb2                               partition   2097148 0   -1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4、持久化保存交换分区的使用</span><br><span class="line"><span class="comment"># blkid /dev/sdb2</span></span><br><span class="line">/dev/sdb2: UUID=<span class="string">"ba08eb90-2003-44e6-9769-9a9351aebb05"</span> TYPE=<span class="string">"swap"</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/fstab </span></span><br><span class="line">/dev/mapper/rhel-root   /                       xfs     defaults        0 0</span><br><span class="line">UUID=cb3299d6-16e0-4644-9686-27907eefb8f3 /boot                   xfs     defaults        0 0</span><br><span class="line">UUID=ba08eb90-2003-44e6-9769-9a9351aebb05  swap         swap    defaults  0 0</span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/13.linux--linux系统磁盘管理/" data-id="ck7ooyal7003d4su6bzh2znhx"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-12.linux--源码安装包管理" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/12.linux--源码安装包管理/"
    >源码安装管理</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/12.linux--源码安装包管理/" class="article-date">
  <time datetime="2019-08-29T15:44:18.587Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>[TOC]</p>
<h2 id="源码包基本概述"><a href="#源码包基本概述" class="headerlink" title="源码包基本概述"></a>源码包基本概述</h2><p>在linux环境下面安装源码包是比较常见的，在早期运维管理工作当中，大部分软件都是通过源码安装的。那么安装一个源码包，是需要我们自己把源代码编译成二进制的可执行文件。</p>
<p>源码包的编译用到了linux系统里的编译器，通常源码包都是用C语言开发的，这也是因为C语言为linux上最标准的程序语言。Linux上的C语言编译器叫做gcc，利用它就可以把C语言变成可执行的二进制文件。所以如果你的机器上没有安装gcc就没有办法去编译源码。可以使用<code>yum -y install gcc</code>来完成安装。</p>
<h2 id="源码包的好处"><a href="#源码包的好处" class="headerlink" title="源码包的好处"></a>源码包的好处</h2><ul>
<li>自定义修改源代码</li>
<li>定制需要的相关功能</li>
<li>新版软件优先更新源码</li>
</ul>
<h2 id="源码包的获取"><a href="#源码包的获取" class="headerlink" title="源码包的获取"></a>源码包的获取</h2><p>官方网站, 可以获得最新的软件包</p>
<p><a href="http://www.apache.org/" target="_blank" rel="noopener">Apache官方网站</a> </p>
<p><a href="http://nginx.org/" target="_blank" rel="noopener">Nginx官方网站</a></p>
<p> <a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads" target="_blank" rel="noopener">Mysql官方网站</a></p>
<p>例如在nginx官网上下载nginx安装包</p>
<ul>
<li>首先我们提前在windows上面进入nginx网站，找到下载，找打一个包右键，选择复制链接地址</li>
<li>进入Linux系统，输入以下命令</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># wget</span></span><br></pre></td></tr></table></figure>

<ul>
<li>将复制的地址粘贴上去</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># wget http://nginx.org/download/nginx-1.14.2.tar.gz</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在当前目录就可以ls出我们下载下来的文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg       nginx-1.14.2.tar.gz  模板  图片  下载  桌面</span><br><span class="line">initial-setup-ks.cfg  公共                 视频  文档  音乐</span><br></pre></td></tr></table></figure>

<h2 id="源码包的分类"><a href="#源码包的分类" class="headerlink" title="源码包的分类"></a>源码包的分类</h2><ul>
<li>源码格式（需要编译安装）</li>
<li>二进制格式（解压后可以直接使用）</li>
</ul>
<h2 id="源码包的安装"><a href="#源码包的安装" class="headerlink" title="源码包的安装"></a>源码包的安装</h2><p>编译需要编译环境，开发环境，开发库，开发工具。 常用的编译环境有c、c++、perl、java、python5种 c环境的编译器：gcc（GNU C Complier） c++环境的编译器：g++ make：c、c++的统一项目管理工具，编译时有可能调用gcc也有可能调用g++。使用makefile文件定义make按何种次序去编译源程序文件中的源程序</p>
<p><strong>源码安装三部曲（常见）：</strong><br><strong>第一步: ./configure（定制组件）</strong></p>
<blockquote>
<p>1.指定安装路径，例如 –prefix=/opt/nginx-1.12<br>2.启用或禁用某项功能, 例如 –enable-ssl<br>3.和其它软件关联，例如–with-pcre<br>4.检查安装环境，例如是否有编译器 gcc，是否满足软件的依赖需求<br>5.检测通过后生成Makefile文件</p>
</blockquote>
<p><strong>第二步: make</strong></p>
<blockquote>
<p>1.执行make命令进行编译, 可以使用-j指定CPU核心数进行编译<br>2.按Makefile文件进行编译, 编译成可执行二进制文件<br>3.生成各类模块和主程序</p>
</blockquote>
<p><strong>第三步: make install</strong></p>
<blockquote>
<p>1.按Makefile定义好的路径拷贝至安装目录中</p>
</blockquote>
<p>上面介绍的源码三部曲不能百分百通用于所有源码包, 也就是说源码包的安装并非存在标准安装步骤，但是大部分源码安装都是类似的步骤</p>
<p><strong>建议:</strong><br>拿到源码包解压后，然后进入到目录找相关的帮助文档，通常会以INSTALL或者README为文件名</p>
<h4 id="configure脚本的功能"><a href="#configure脚本的功能" class="headerlink" title="configure脚本的功能"></a>configure脚本的功能</h4><ul>
<li>让用户选定编译特性</li>
<li>检查编译环境是否符合程序编译的基本需要</li>
</ul>
<h4 id="源码包编译事例"><a href="#源码包编译事例" class="headerlink" title="源码包编译事例"></a>源码包编译事例</h4><blockquote>
<p>下面我们就来实战一番</p>
<p>在linux中编译nginx 启动nginx服务</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># tar -xf nginx-1.14.2.tar.gz</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># cd nginx-1.14.2/</span></span><br></pre></td></tr></table></figure>

<ul>
<li>源码安装三部曲</li>
</ul>
<p><strong>第一步: ./configure</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># ./configure</span></span><br><span class="line">checking <span class="keyword">for</span> OS</span><br><span class="line"> + Linux 3.10.0-693.el7.x86_64 x86_64</span><br><span class="line">checking <span class="keyword">for</span> C compiler ... not found</span><br><span class="line"></span><br><span class="line">./configure: error: C compiler cc is not found</span><br></pre></td></tr></table></figure>

<blockquote>
<p>哦霍，完蛋    出征未捷身先死。那么往下看吧</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 解决方法</span><br><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># yum install -y gcc gcc-c++ make</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>再次执行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># ./configure</span></span><br><span class="line">........................省略一大片....................</span><br><span class="line"></span><br><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">You can either <span class="built_in">disable</span> the module by using --without-http_rewrite_module</span><br><span class="line">option, or install the PCRE library into the system, or build the PCRE library</span><br><span class="line">statically from the <span class="built_in">source</span> with nginx by using --with-pcre=&lt;path&gt; option.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下面来看解决办法</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># yum install -y pcre-devel</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>再次执行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># ./configure</span></span><br><span class="line">........................省略一大片....................</span><br><span class="line"></span><br><span class="line">./configure: error: the HTTP gzip module requires the zlib library.</span><br><span class="line">You can either <span class="built_in">disable</span> the module by using --without-http_gzip_module</span><br><span class="line">option, or install the zlib library into the system, or build the zlib library</span><br><span class="line">statically from the <span class="built_in">source</span> with nginx by using --with-zlib=&lt;path&gt; option.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下面来看解决办法</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># yum -y install zlib-devel</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> 再次执行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># ./configure</span></span><br><span class="line">........................省略一大片....................</span><br><span class="line"></span><br><span class="line">  nginx pid file: <span class="string">"/usr/local/nginx/logs/nginx.pid"</span></span><br><span class="line">  nginx error <span class="built_in">log</span> file: <span class="string">"/usr/local/nginx/logs/error.log"</span></span><br><span class="line">  nginx http access <span class="built_in">log</span> file: <span class="string">"/usr/local/nginx/logs/access.log"</span></span><br><span class="line">  nginx http client request body temporary files: <span class="string">"client_body_temp"</span></span><br><span class="line">  nginx http proxy temporary files: <span class="string">"proxy_temp"</span></span><br><span class="line">  nginx http fastcgi temporary files: <span class="string">"fastcgi_temp"</span></span><br><span class="line">  nginx http uwsgi temporary files: <span class="string">"uwsgi_temp"</span></span><br><span class="line">  nginx http scgi temporary files: <span class="string">"scgi_temp"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>出现这样就表示完成，其实还有一种错误，这里由于我可能安装openssl-devel</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: SSL modules require the OpenSSL library.</span><br><span class="line">You can either <span class="keyword">do</span> not <span class="built_in">enable</span> the modules, or install the OpenSSL </span><br><span class="line">library into the system, or build the OpenSSL library statically</span><br><span class="line">from the <span class="built_in">source</span> with nginx by using --with-openssl=&lt;path&gt; option.</span><br><span class="line"></span><br><span class="line">// 解决办法</span><br><span class="line">yum install openssl-devel</span><br></pre></td></tr></table></figure>

<p><strong>第二步：make</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># make</span></span><br></pre></td></tr></table></figure>

<p><strong>第三步:  make instal</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># make install</span></span><br><span class="line"></span><br><span class="line">// 此时未知是否安装好，可以使用<span class="built_in">echo</span> $?</span><br><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"><span class="comment">## 0代表没有错误 1代表错误</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动nginx</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># ls</span></span><br><span class="line">[root@zhoulijie nginx-1.14.2]<span class="comment"># cd objs/</span></span><br><span class="line">[root@zhoulijie objs]<span class="comment"># ./nginx</span></span><br><span class="line">[root@zhoulijie objs]<span class="comment"># ss -antl</span></span><br><span class="line">State      Recv-Q Send-Q Local Address:Port               Peer Address:Port     </span><br><span class="line">LISTEN     0      128          *:111                      *:*</span><br><span class="line">LISTEN     0      128          *:80                       *:*</span><br><span class="line"></span><br><span class="line"><span class="comment">## nginx 80端口</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>实验成果</p>
</blockquote>
<p><img src="https://s2.ax1x.com/2019/04/27/EKz4bQ.png" alt></p>
<h4 id="编译安装注意事项"><a href="#编译安装注意事项" class="headerlink" title="编译安装注意事项"></a>编译安装注意事项</h4><ul>
<li>如果安装时不是使用的默认路径，则必须要修改PATH环境变量，以能够识别此程序的二进制文件路径；<ul>
<li>修改/etc/profile文件或在/etc/profile.d/目录建立一个以.sh为后缀的文件，在里面定义export PATH=$PATH:/path/to/somewhere</li>
</ul>
</li>
<li>默认情况下，系统搜索库文件的路径只有/lib，/usr/lib<ul>
<li>增添额外库文件搜索路径方法：<ul>
<li>在/etc/ld.so.conf.d/中创建以.conf为后缀名的文件，而后把要增添的路径直接写至此文件中。此时库文件增添的搜索路径重启后有效，若要使用增添的路径立即生效则要使用ldconfig命令</li>
</ul>
</li>
<li>ldconfig：通知系统重新搜索库文件</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/ld.so.conf和/etc/ls.so.conf.d/*.conf    //配置文件</span><br><span class="line">/etc/ld.so.cache            //缓存文件</span><br><span class="line">-v      //显示重新搜索库的过程</span><br><span class="line">-p      //打印出系统启动时自动加载并缓存到内存中的可用库文件名及文件路径映射关系</span><br></pre></td></tr></table></figure>

<ul>
<li>头文件：输出给系统<ul>
<li>默认：系统在/usr/include中找头文件，若要增添头文件搜索路径，使用链接进行</li>
</ul>
</li>
<li>man文件路径：安装在–prefix指定的目录下的man目录<ul>
<li>默认：系统在/usr/share/man中找man文件。此时因为编译安装的时候不是安装到默认路径下，如果要查找man文件则可以使用以下两种方法：<ul>
<li>man -M /path/to/man_dir command</li>
<li>在/etc/man.config文件中添加一条MANPATH</li>
</ul>
</li>
</ul>
</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/12.linux--源码安装包管理/" data-id="ck7ooyadq000y4su6iluhq3cz"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-11.linux--网络进阶管理" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/11.linux--网络进阶管理/"
    >网络进阶管理</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/11.linux--网络进阶管理/" class="article-date">
  <time datetime="2019-08-29T15:44:18.585Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>[TOC]</p>
<h3 id="链路聚合"><a href="#链路聚合" class="headerlink" title="链路聚合"></a>链路聚合</h3><p>网卡的链路聚合就是将多块网卡连接起来，当一块网卡损坏，网络依旧可以正常运行，可以有效的防止因为网卡损坏带来的损失，同时也可以提高网络访问速度。 </p>
<h3 id="桥接网络"><a href="#桥接网络" class="headerlink" title="桥接网络"></a>桥接网络</h3><p>桥接网络也即网桥，可基于MAC地址在网络间转发流量。网桥识别哪些主机连接到每个网络，构建MAC地址表，然后根据该表做出包转发决策。</p>
<p>软件网桥的最常见应用是在虚拟化应用程序中，用于在一个或多个虚拟NIC中共享一个硬件NIC。</p>
<h3 id="链路聚合配置"><a href="#链路聚合配置" class="headerlink" title="链路聚合配置"></a>链路聚合配置</h3><h4 id="配置bond聚合链路"><a href="#配置bond聚合链路" class="headerlink" title="配置bond聚合链路"></a>配置bond聚合链路</h4><h4 id="配置bong0"><a href="#配置bong0" class="headerlink" title="配置bong0"></a>配置bong0</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli device</span></span><br><span class="line">设备        类型      状态    连接   </span><br><span class="line">virbr0      bridge    连接的  virbr0 </span><br><span class="line">eth0        ethernet  连接的  eth0   </span><br><span class="line">eth1        ethernet  已断开  --     </span><br><span class="line">lo          loopback  未托管  --     </span><br><span class="line">virbr0-nic  tun       未托管  --</span><br></pre></td></tr></table></figure>

<h5 id="创建bond0，-模式为balance-rr，名字为zhoulijie"><a href="#创建bond0，-模式为balance-rr，名字为zhoulijie" class="headerlink" title="创建bond0， 模式为balance-rr，名字为zhoulijie"></a>创建bond0， 模式为balance-rr，名字为zhoulijie</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection add type bond mode balance-rr con-name zhoulijie ifname bond0 ipv4.method manual ipv4.addresses 192.168.83.250/24 ipv4.gateway 192.168.83.2 ipv4.dns 192.168.83.2</span></span><br><span class="line">连接“zhoulijie”(99fe45cb-5d4a-4288-b0b1-1fd2202d25e1) 已成功添加。</span><br></pre></td></tr></table></figure>

<h5 id="添加物理网卡至bond0"><a href="#添加物理网卡至bond0" class="headerlink" title="添加物理网卡至bond0"></a>添加物理网卡至bond0</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection add type bond-slave con-name zlj ifname eth0 master bond0</span></span><br><span class="line">连接“zlj”(4a185231-5752-4e60-b20d-92fce9ed90e2) 已成功添加。</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection add type bond-slave con-name zlj1 ifname eth1 master bond0</span></span><br><span class="line">连接“zlj1”(2883fd9a-2ce9-4e51-bde2-679b3920fae5) 已成功添加。</span><br></pre></td></tr></table></figure>

<h5 id="查看bond配置信息"><a href="#查看bond配置信息" class="headerlink" title="查看bond配置信息"></a>查看bond配置信息</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># cat /proc/net/bonding/bond0</span></span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: load balancing (round-robin)</span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: eth1</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:ab:cc:71</span><br><span class="line">Slave queue ID: 0</span><br></pre></td></tr></table></figure>

<h5 id="关闭eth0网卡-测试bond0是否正常"><a href="#关闭eth0网卡-测试bond0是否正常" class="headerlink" title="关闭eth0网卡, 测试bond0是否正常"></a>关闭eth0网卡, 测试bond0是否正常</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli device disconnect eth0</span></span><br><span class="line">成功断开设备 <span class="string">'eth0'</span>。</span><br></pre></td></tr></table></figure>

<h4 id="配置bong1"><a href="#配置bong1" class="headerlink" title="配置bong1"></a>配置bong1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli device</span></span><br><span class="line">设备        类型      状态    连接   </span><br><span class="line">virbr0      bridge    连接的  virbr0 </span><br><span class="line">eth0        ethernet  连接的  eth0   </span><br><span class="line">eth1        ethernet  已断开  --     </span><br><span class="line">lo          loopback  未托管  --     </span><br><span class="line">virbr0-nic  tun       未托管  --</span><br></pre></td></tr></table></figure>

<h5 id="创建bond1，模式为active-backup，名字为zhoulijie"><a href="#创建bond1，模式为active-backup，名字为zhoulijie" class="headerlink" title="创建bond1，模式为active-backup，名字为zhoulijie"></a>创建bond1，模式为active-backup，名字为zhoulijie</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# nmcli connection add type bond con-name zhoulijie ifname bond1 mode active-backup ipv4.method manual ipv4.addresses 192.168.83.250/24 ipv4.gateway 192.168.83.2 ipv4.dns 192.168.83.2</span><br><span class="line">连接“zhoulijie”(c4c7078e-f912-46fd-af84-6c414267a45b) 已成功添加。</span><br></pre></td></tr></table></figure>

<h5 id="添加物理网卡连接至bond1"><a href="#添加物理网卡连接至bond1" class="headerlink" title="添加物理网卡连接至bond1"></a>添加物理网卡连接至bond1</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection add type bond-slave con-name zlj ifname eth0 master bond1</span></span><br><span class="line">连接“zlj”(280b5deb-e05f-45f7-b771-1c2a325b63c7) 已成功添加。</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection add type bond-slave con-name zlj1 ifname eth1 master bond1</span></span><br><span class="line">连接“zlj1”(d0c28c77-5808-43cc-86f2-f2aefda5304f) 已成功添加。</span><br></pre></td></tr></table></figure>

<h5 id="启用连接"><a href="#启用连接" class="headerlink" title="启用连接"></a>启用连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection up zhoulijie</span></span><br><span class="line">成功激活（主服务器等待从服务器）连接（D-Bus 激活路径：/org/freedesktop/NetworkManager/ActiveConnection/7）</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection up zlj</span></span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/9）</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection up zlj1</span></span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/10）</span><br></pre></td></tr></table></figure>

<h5 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># cat /proc/net/bonding/bond1</span></span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: fault-tolerance (active-backup)</span><br><span class="line">Primary Slave: None</span><br><span class="line">Currently Active Slave: eth0</span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: eth0</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:ab:cc:67</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">Slave Interface: eth1</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:ab:cc:71</span><br><span class="line">Slave queue ID: 0</span><br></pre></td></tr></table></figure>

<h5 id="停止eth0物理网卡设备"><a href="#停止eth0物理网卡设备" class="headerlink" title="停止eth0物理网卡设备"></a>停止eth0物理网卡设备</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli device disconnect eth0</span></span><br><span class="line">成功断开设备 <span class="string">'eth0'</span>。</span><br></pre></td></tr></table></figure>

<h5 id="eth1物理网卡设备会进行自动切换"><a href="#eth1物理网卡设备会进行自动切换" class="headerlink" title="eth1物理网卡设备会进行自动切换"></a>eth1物理网卡设备会进行自动切换</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># grep "Currently Active Slave" /proc/net/bonding/bond1</span></span><br><span class="line">Currently Active Slave: eth1</span><br></pre></td></tr></table></figure>

<h4 id="配置team聚合链路"><a href="#配置team聚合链路" class="headerlink" title="配置team聚合链路"></a>配置team聚合链路</h4><p><code>centos/rhce7</code>使用<code>teaming</code>实现聚合链路,能够提供网卡绑定之后的网络吞吐性能,并且提供网卡的故障切换处理能力。<br><code>Team</code>是基于一个小型内核驱动实现聚合链路，在用户层提供<code>teamd</code>命令实现链路管理。</p>
<p><code>teamd</code>可以实现以下模式的聚合链路</p>
<blockquote>
<p>broadcast 广播容错<br>roundrobin 负载轮询<br>activebackup 主备(必考)<br>loadbalance 负载均衡<br>lacp 需要交换机支持lacp协议</p>
</blockquote>
<h5 id="请使用命令行配置，图形界面配置不稳定"><a href="#请使用命令行配置，图形界面配置不稳定" class="headerlink" title="请使用命令行配置，图形界面配置不稳定"></a>请使用命令行配置，图形界面配置不稳定</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# nmcli connection add type team con-name team0 ifname team0 config &apos;&#123;&quot;runner&quot;:&#123;&quot;name&quot;:&quot;activebackup&quot;&#125;&#125;&apos; ipv4.addresses 192.168.83.222/24 ipv4.gateway 192.168.83.2 ipv4.dns 192.168.83.2 ipv4.method manual</span><br><span class="line">连接“team0”(80474187-7e56-4874-9d24-e228cb39b851) 已成功添加。</span><br></pre></td></tr></table></figure>

<h5 id="添加物理网卡连接至team0"><a href="#添加物理网卡连接至team0" class="headerlink" title="添加物理网卡连接至team0"></a>添加物理网卡连接至team0</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection add type team-slave con-name team0-port1 ifname eth1 master team0</span></span><br><span class="line">连接“team0-port1”(4c6539de-8ea3-43fc-beb1-598587a8c05f) 已成功添加。</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection add type team-slave con-name team0-port2 ifname eth2 master team0</span></span><br><span class="line">连接“team0-port2”(0798fb06-daee-4b5f-bd1f-8ad455964cb6) 已成功添加。</span><br></pre></td></tr></table></figure>

<h5 id="检查team0状态"><a href="#检查team0状态" class="headerlink" title="检查team0状态"></a>检查team0状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# ping -I team0 192.168.83.222</span><br><span class="line">[root@zhoulijie ~]# teamdctl team0 state</span><br></pre></td></tr></table></figure>

<h5 id="断掉后检测"><a href="#断掉后检测" class="headerlink" title="断掉后检测"></a>断掉后检测</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli dev disconnect eth1</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># teamdctl team0 state</span></span><br></pre></td></tr></table></figure>

<h4 id="动态修改team模式"><a href="#动态修改team模式" class="headerlink" title="动态修改team模式"></a>动态修改team模式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 导出配置进行修改 (man teamd.conf)</span><br><span class="line">[root@zhoulijie ~]# teamdctl team0 config dump &gt; /tmp/team.conf</span><br><span class="line">[root@zhoulijie ~]# vim /tmp/team.conf</span><br><span class="line"></span><br><span class="line">//以最新修改的配置选项修改team0属性</span><br><span class="line">[root@zhoulijie ~]# nmcli con mod team0 team.config /tmp/team.conf</span><br><span class="line"></span><br><span class="line">//修改之后需要重启team0</span><br><span class="line">[root@zhoulijie ~]# nmcli connection down team0;nmcli connection up team0 </span><br><span class="line">[root@zhoulijie ~]# nmcli connection up team0-port1</span><br><span class="line">[root@zhoulijie ~]# nmcli connection up team0-port2</span><br></pre></td></tr></table></figure>

<h3 id="桥接网络配置"><a href="#桥接网络配置" class="headerlink" title="桥接网络配置"></a>桥接网络配置</h3><h5 id="创建桥接网络br1"><a href="#创建桥接网络br1" class="headerlink" title="创建桥接网络br1"></a>创建桥接网络br1</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# nmcli connection add type bridge con-name br1 ifname br1 ipv4.addresses 192.168.83.222/24 ipv4.method manual</span><br></pre></td></tr></table></figure>

<h5 id="桥接至eth1"><a href="#桥接至eth1" class="headerlink" title="桥接至eth1"></a>桥接至eth1</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# nmcli connection add type bridge-slave con-name br1-port1 ifname eth1 master br1 nmcli connection add type bridge-slave con-name br1-port1 ifname eth1 master br1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ping -I br1 192.168.83.1</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># brctl show</span></span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/11.linux--网络进阶管理/" data-id="ck7ooya2p00024su6j9szyitc"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-10.linux--网络基础管理" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/10.linux--网络基础管理/"
    >网络基础管理</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/10.linux--网络基础管理/" class="article-date">
  <time datetime="2019-08-29T15:44:18.580Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>[TOC]</p>
<h2 id="网卡命名"><a href="#网卡命名" class="headerlink" title="网卡命名"></a>网卡命名</h2><h3 id="传统网卡命名机制"><a href="#传统网卡命名机制" class="headerlink" title="传统网卡命名机制"></a>传统网卡命名机制</h3><blockquote>
<p>传统命名： </p>
<p>以太网eth[0,1,2,…] </p>
<p>wlan[0,1,2,…] </p>
</blockquote>
<h3 id="redhat7网卡命名机制"><a href="#redhat7网卡命名机制" class="headerlink" title="redhat7网卡命名机制"></a>redhat7网卡命名机制</h3><blockquote>
<p>systemd对网络设备的命名方式：</p>
<ol>
<li>如果Firmware或BIOS为主板上集成的设备提供的索引信息可用，且可预测，则根据此索引进行命名，例如eno1</li>
<li>如果Firmware或BIOS为PCI-E扩展槽所提供的索引信息可用，且可预测，则根据此索引进行命名，例如ens1</li>
<li>如果硬件接口的物理位置信息可用，则根据此信息进行命名，例如enp2s0</li>
<li>如果用户显式启动，也可根据MAC地址进行命名，例如enx2387a1dc56</li>
<li>上述均不可用时，则使用传统命名机制</li>
</ol>
</blockquote>
<p>上述命名机制中，有的需要biosdevname程序的参与。所以必须安装biosdevname程序且启用它。</p>
<h3 id="网络接口名称组成格式"><a href="#网络接口名称组成格式" class="headerlink" title="网络接口名称组成格式"></a>网络接口名称组成格式</h3><h3 id="网卡设备的命名过程"><a href="#网卡设备的命名过程" class="headerlink" title="网卡设备的命名过程"></a>网卡设备的命名过程</h3><ol>
<li>udev，辅助工具程序/lib/udev/rename_device会根据/usr/lib/udev/rules.d/60-net.rules中的信息设定网卡名称</li>
<li>biosdevname会根据/usr/lib/udev/rules.d/71-biosdevname.rules中的信息设定网卡名称</li>
<li>通过udev检测网络接口设备，根据/usr/lib/udev/rules.d/75-net-description中的变量信息设定网卡名称</li>
</ol>
<h3 id="回归传统命名"><a href="#回归传统命名" class="headerlink" title="回归传统命名"></a>回归传统命名</h3><h5 id="修改网卡配置文件"><a href="#修改网卡配置文件" class="headerlink" title="修改网卡配置文件"></a>修改网卡配置文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># cd /etc/sysconfig/network-scripts/</span></span><br><span class="line">[root@zhoulijie network-scripts]<span class="comment"># mv ifcfg-ens33 ifcfg-eth0</span></span><br><span class="line">[root@zhoulijie network-scripts]<span class="comment"># vim ifcfg-eth0</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">NAME=eth0  //此处要把ens33改成eth0</span><br><span class="line">UUID=bb501ad9-f26f-4310-b857-14a1fc520546</span><br><span class="line">DEVICE=eth0  //此处要把ens33改成eth0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.83.140</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.83.2</span><br><span class="line">DNS1=192.168.83.2</span><br></pre></td></tr></table></figure>

<h5 id="编辑-etc-default-grub配置文件"><a href="#编辑-etc-default-grub配置文件" class="headerlink" title="编辑/etc/default/grub配置文件"></a>编辑/etc/default/grub配置文件</h5><blockquote>
<p>在以GRUB_CMDLINE_LINUX开头的行内rhgb的前面加上net.ifnames=0 biosdevname=0 </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie network-scripts]<span class="comment"># vim /etc/default/grub</span></span><br><span class="line">GRUB_TIMEOUT=5</span><br><span class="line">GRUB_DISTRIBUTOR=<span class="string">"<span class="variable">$(sed 's, release .*$,,g' /etc/system-release)</span>"</span></span><br><span class="line">GRUB_DEFAULT=saved</span><br><span class="line">GRUB_DISABLE_SUBMENU=<span class="literal">true</span></span><br><span class="line">GRUB_TERMINAL_OUTPUT=<span class="string">"console"</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">"crashkernel=auto rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap net.ifnames=0 biosdevname=0 rhgb quiet"</span></span><br><span class="line">GRUB_DISABLE_RECOVERY=<span class="string">"true"</span></span><br></pre></td></tr></table></figure>

<h5 id="为grub2生成其配置文件"><a href="#为grub2生成其配置文件" class="headerlink" title="为grub2生成其配置文件"></a>为grub2生成其配置文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie network-scripts]<span class="comment"># grub2-mkconfig -o /etc/grub2.cfg</span></span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-3.10.0-693.el7.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-3.10.0-693.el7.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-0-rescue-fd0bcf5782d24ba5b903b175c35f328e</span><br><span class="line">Found initrd image: /boot/initramfs-0-rescue-fd0bcf5782d24ba5b903b175c35f328e.img</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h5 id="重启系统"><a href="#重启系统" class="headerlink" title="重启系统"></a>重启系统</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie network-scripts]<span class="comment"># reboot</span></span><br></pre></td></tr></table></figure>

<h2 id="网络管理常用命令"><a href="#网络管理常用命令" class="headerlink" title="网络管理常用命令"></a>网络管理常用命令</h2><h3 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h3><h5 id="查看当前处于活动状态的所有网络接口"><a href="#查看当前处于活动状态的所有网络接口" class="headerlink" title="查看当前处于活动状态的所有网络接口"></a>查看当前处于活动状态的所有网络接口</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ifconfig</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.140  netmask 255.255.255.0  broadcast 192.168.83.255</span><br><span class="line">        inet6 fe80::20c:29ff:feab:cc67  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:ab:cc:67  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 694  bytes 64096 (62.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 435  bytes 53145 (51.8 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 18  bytes 1624 (1.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 18  bytes 1624 (1.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255</span><br><span class="line">        ether 52:54:00:f0:f8:b0  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<h5 id="仅查看单个网卡状态"><a href="#仅查看单个网卡状态" class="headerlink" title="仅查看单个网卡状态"></a>仅查看单个网卡状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ifconfig eth0</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.140  netmask 255.255.255.0  broadcast 192.168.83.255</span><br><span class="line">        inet6 fe80::20c:29ff:feab:cc67  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:ab:cc:67  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 726  bytes 66886 (65.3 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 453  bytes 56481 (55.1 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<h5 id="查看所有网卡状态信息-包括禁用和启用"><a href="#查看所有网卡状态信息-包括禁用和启用" class="headerlink" title="查看所有网卡状态信息, 包括禁用和启用"></a>查看所有网卡状态信息, 包括禁用和启用</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ifconfig -a</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.140  netmask 255.255.255.0  broadcast 192.168.83.255</span><br><span class="line">        inet6 fe80::20c:29ff:feab:cc67  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:ab:cc:67  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 763  bytes 70122 (68.4 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 475  bytes 60789 (59.3 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 18  bytes 1624 (1.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 18  bytes 1624 (1.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255</span><br><span class="line">        ether 52:54:00:f0:f8:b0  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">virbr0-nic: flags=4098&lt;BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        ether 52:54:00:f0:f8:b0  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<h5 id="网卡配置信息含义如下"><a href="#网卡配置信息含义如下" class="headerlink" title="网卡配置信息含义如下"></a>网卡配置信息含义如下</h5><blockquote>
<p> UP: 网卡处于活动状态</p>
<p> BROADCAST: 支持广播</p>
<p> RUNNING: 网线已接入</p>
<p> MULTICAST: 支持组播</p>
<p> MTU: 最大传输单元(字节),即此接口一次所能传输的最大封包</p>
<p> inet: 显示IPv4地址行</p>
<p> inet6: 显示IPv6地址行</p>
<p>link/enther: 指设备硬件(MAC)地址</p>
<p> txqueuelen: 传输缓存区长度大小</p>
<p>RX packets: 接收的数据包</p>
<p>TX packets: 发送的数据包</p>
<p>errors: 总的收包的错误数量</p>
<p>dropped: 由于各种原因, 导致拷贝在内存过程中被丢弃</p>
<p>collisions: 网络信号冲突情况, 值不为0则可能存在网络故障</p>
</blockquote>
<h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3><blockquote>
<p>//语法：ip [ OPTIONS ] OBJECT { COMMAND | help }<br>OBJECT：<br>    link：网络接口属性<br>    addr：协议地址<br>    route：路由 </p>
</blockquote>
<h5 id="查看网络有接口地址"><a href="#查看网络有接口地址" class="headerlink" title="查看网络有接口地址"></a>查看网络有接口地址</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ip link show</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 00:0c:29:ab:cc:67 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:00:f0:f8:b0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:00:f0:f8:b0 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure>

<h5 id="显示报文统计信息"><a href="#显示报文统计信息" class="headerlink" title="显示报文统计信息"></a>显示报文统计信息</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ip -s link show</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast</span><br><span class="line">    1624       18       0       0       0       0</span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns</span><br><span class="line">    1624       18       0       0       0       0</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 00:0c:29:ab:cc:67 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast</span><br><span class="line">    35806      380      0       0       0       0</span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns</span><br><span class="line">    27393      240      0       0       0       0</span><br><span class="line">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:00:f0:f8:b0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast</span><br><span class="line">    0          0        0       0       0       0</span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns</span><br><span class="line">    0          0        0       0       0       0</span><br><span class="line">4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:00:f0:f8:b0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast</span><br><span class="line">    0          0        0       0       0       0</span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns</span><br><span class="line">    0          0        0       0       0       0</span><br></pre></td></tr></table></figure>

<h5 id="启用或禁用网络接口ip-link-set-DEV-up-down"><a href="#启用或禁用网络接口ip-link-set-DEV-up-down" class="headerlink" title="启用或禁用网络接口ip link set DEV {up|down}"></a>启用或禁用网络接口ip link set DEV {up|down}</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ip link set lo down</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ip link set lo up</span></span><br></pre></td></tr></table></figure>

<h5 id="查看网络接口的地址"><a href="#查看网络接口的地址" class="headerlink" title="查看网络接口的地址"></a>查看网络接口的地址</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ip addr show eth0</span></span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:0c:29:ab:cc:67 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.83.140/24 brd 192.168.83.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::20c:29ff:feab:cc67/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h5 id="添加IP地址"><a href="#添加IP地址" class="headerlink" title="添加IP地址"></a>添加IP地址</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ip addr add 192.168.83.141/24 dev eth0</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ip addr show eth0</span></span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:0c:29:ab:cc:67 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.83.140/24 brd 192.168.83.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.83.141/24 scope global secondary eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::20c:29ff:feab:cc67/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h5 id="删除IP地址"><a href="#删除IP地址" class="headerlink" title="删除IP地址"></a>删除IP地址</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ip addr del 192.168.83.141/24 dev eth0</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ip addr show eth0</span></span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:0c:29:ab:cc:67 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.83.140/24 brd 192.168.83.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::20c:29ff:feab:cc67/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h3 id="路由管理"><a href="#路由管理" class="headerlink" title="路由管理"></a>路由管理</h3><blockquote>
<p>ip route：routing table management</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//添加路由：ip route add TARGET via GW dev IFACE src SOURCE_IP</span><br><span class="line">    TARGET：</span><br><span class="line">        主机路由：IP</span><br><span class="line">        网络路由：NETWORK/MASK </span><br><span class="line">        </span><br><span class="line">//删除路由：ip route del TARGET</span><br><span class="line">    TARGET：</span><br><span class="line">        主机路由：IP</span><br><span class="line">        网络路由：NETWORK/MASK</span><br><span class="line">                        </span><br><span class="line">//查看路由：ip route show</span><br><span class="line"></span><br><span class="line">//刷新路由表：ip route flush</span><br><span class="line">    [dev IFACE]</span><br><span class="line">    [via PREFIX]</span><br></pre></td></tr></table></figure>



<h3 id="route"><a href="#route" class="headerlink" title="route"></a>route</h3><p>Linux主机之间是使用IP进行通信, 假设A主机和B主机同在一个网段内且网卡都处于激活状态, 则A具备和B直接通信的能力, 但如果A主机和B主机处于两个不同的网段, 则A必须通过路由器才能和B通信, 路由器属于IT设备的基础设施, 每一个网段都应该至少有一个网关 </p>
<h5 id="查看当前路由表"><a href="#查看当前路由表" class="headerlink" title="查看当前路由表"></a>查看当前路由表</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># route</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         gateway         0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.83.0    0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line">192.168.122.0   0.0.0.0         255.255.255.0   U     0      0        0 virbr0</span><br></pre></td></tr></table></figure>

<h5 id="以数字方式显示各主机或端口等相关信息"><a href="#以数字方式显示各主机或端口等相关信息" class="headerlink" title="以数字方式显示各主机或端口等相关信息"></a>以数字方式显示各主机或端口等相关信息</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.83.2    0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.83.0    0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line">192.168.122.0   0.0.0.0         255.255.255.0   U     0      0        0 virbr0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>增加路由<br>语法：route add [-net|-host] target [netmask Nm][gw Gw]  [[dev] If]</p>
</blockquote>
<h5 id="增加网段路由"><a href="#增加网段路由" class="headerlink" title="增加网段路由"></a>增加网段路由</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># route add -net 192.168.83.0/24 gw 192.168.83.2 dev eth0</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># route add -net 0.0.0.0 gw 192.168.83.2 dev eth0</span></span><br></pre></td></tr></table></figure>

<h5 id="增加主机路由"><a href="#增加主机路由" class="headerlink" title="增加主机路由"></a>增加主机路由</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># route add -host 192.168.83.144 gw 192.168.83.2</span></span><br></pre></td></tr></table></figure>

<h5 id="删除路由"><a href="#删除路由" class="headerlink" title="删除路由"></a>删除路由</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># route del -net 192.168.83.0/24</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># route del -net 0.0.0.0/0 gw 192.168.83.2</span></span><br></pre></td></tr></table></figure>

<h3 id="hostname与hostnamectl"><a href="#hostname与hostnamectl" class="headerlink" title="hostname与hostnamectl"></a>hostname与hostnamectl</h3><p>生产环境中必须配置主机名,同时主机名也需要遵循一定的规范, 比如: </p>
<table>
<thead>
<tr>
<th align="center">地区</th>
<th align="center">项目</th>
<th align="center">业务</th>
<th align="center">服务</th>
<th align="center">节点</th>
<th align="center">地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">wuhan</td>
<td align="center">Supermarket</td>
<td align="center">Library file</td>
<td align="center">mysql</td>
<td align="center">master01</td>
<td align="center">192.168.83.1</td>
</tr>
<tr>
<td align="center">guangzhou</td>
<td align="center">Bank</td>
<td align="center">Library file</td>
<td align="center">mysql</td>
<td align="center">master01</td>
<td align="center">192.168.83.111</td>
</tr>
<tr>
<td align="center">shanghai</td>
<td align="center">Street</td>
<td align="center">Library file</td>
<td align="center">mysql</td>
<td align="center">master01</td>
<td align="center">192.168.83.10</td>
</tr>
</tbody></table>
<h5 id="查看主机名"><a href="#查看主机名" class="headerlink" title="查看主机名"></a>查看主机名</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># hostname</span></span><br><span class="line">zhoulijie</span><br></pre></td></tr></table></figure>

<h5 id="hostname临时修改主机名"><a href="#hostname临时修改主机名" class="headerlink" title="hostname临时修改主机名"></a>hostname临时修改主机名</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># hostname 123</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># bash</span></span><br><span class="line">[root@123 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h5 id="设置永久主机名"><a href="#设置永久主机名" class="headerlink" title="设置永久主机名"></a>设置永久主机名</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@123 ~]<span class="comment"># vim /etc/hostname</span></span><br><span class="line">[root@123 ~]<span class="comment"># cat /etc/hostname</span></span><br><span class="line">zhoulijie</span><br><span class="line">[root@123 ~]<span class="comment"># bash</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：</strong> 在Linux中以命令方式修改网络配置只在当前状态有效，重启后将失效。故若想使修改的配置重启后依然有效，则必须编辑配置文件进行配置的修改。 </p>
</blockquote>
<h2 id="网络相关配置文件"><a href="#网络相关配置文件" class="headerlink" title="网络相关配置文件"></a>网络相关配置文件</h2><h3 id="网络配置文件"><a href="#网络配置文件" class="headerlink" title="网络配置文件"></a>网络配置文件</h3><blockquote>
<p>网络配置文件：/etc/sysconfig/network</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NETWORKING=&#123;yes|no&#125;：设定整个系统是否启用网络功能，若设为no，则不论网卡如何设置都不能使用网络功能。</span><br><span class="line">HOSTNAME：设置主机名</span><br></pre></td></tr></table></figure>

<h4 id="网络接口配置文件"><a href="#网络接口配置文件" class="headerlink" title="网络接口配置文件"></a>网络接口配置文件</h4><p>网络接口即网卡，其配置文件的路径是<code>/etc/sysconfig/network-scripts/ifcfg-INTERFACE_NAME</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0 </span><br><span class="line">TYPE=Ethernet                //接口类型。常见的接口类型有：Ethernet，Bridge</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static             //引导协议，可选值有｛static｜none｜dhcp｜bootp｝。如果要使用静态地址，使用static或none都可以</span><br><span class="line">DEFROUTE=yes                //将接口设定为默认路由[yes|no]</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">NAME=eth0                   //连接名称</span><br><span class="line">UUID=bb501ad9-f26f-4310-b857-14a1fc520546     //设备的惟一标识</span><br><span class="line">DEVICE=eth0                 //关联的设备名称，要与文件名的后半部&quot;INTERFACE_NAME&quot;保持一致</span><br><span class="line">ONBOOT=yes                  //在系统引导时是否自动激活此网络接口，可选值有&#123; yes ｜ no &#125;</span><br><span class="line">IPADDR=192.168.83.140       //固定IP地址</span><br><span class="line">NETMASK=255.255.255.0       //子网掩码</span><br><span class="line">GATEWAY=192.168.83.2        //默认网关</span><br><span class="line">DNS1=192.168.83.2           //第一个DNS服务器指向(还可以有DNS2、DNS3)</span><br></pre></td></tr></table></figure>

<h3 id="路由配置文件"><a href="#路由配置文件" class="headerlink" title="路由配置文件"></a>路由配置文件</h3><p>路由配置文件的路径是<code>/etc/sysconfig/network-scripts/route-INTERFACE_NAME</code></p>
<p>添加格式1：</p>
<pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># vim /etc/sysconfig/network-scripts/route-eth0</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># cat /etc/sysconfig/network-scripts/route-eth0</span></span><br><span class="line">192.168.83.0/24 via 192.168.83.2</span><br></pre></td></tr></table></figure></code></pre><p>添加格式2：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># vim /etc/sysconfig/network-scripts/route-eth0</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># cat /etc/sysconfig/network-scripts/route-eth0</span></span><br><span class="line">ADDRESS0=192.168.83.0</span><br><span class="line">NETMASK0=255.255.255.0</span><br><span class="line">GATEWAY0=192.168.83.2</span><br></pre></td></tr></table></figure>

<h3 id="DNS配置文件"><a href="#DNS配置文件" class="headerlink" title="DNS配置文件"></a>DNS配置文件</h3><p>DNS配置文件的路径是<code>/etc/resolv.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# vim /etc/resolv.conf</span><br><span class="line">[root@zhoulijie ~]# cat /etc/resolv.conf</span><br><span class="line"># Generated by NetworkManager</span><br><span class="line">nameserver 192.168.83.2</span><br></pre></td></tr></table></figure>

<h2 id="NerworkManager管理网络"><a href="#NerworkManager管理网络" class="headerlink" title="NerworkManager管理网络"></a>NerworkManager管理网络</h2><p><code>RHEL/CentOS7</code>系统默认使用<code>NetworkManager</code>来提供网络服务，这是一种动态管理网络配置的守护进程，能够让网络设备保持连接状态。<br><code>NetworkManager</code>提供的命令行和图形配置工具对网络进行设定, 设定保存的配置文件在<code>/etc/sysconfig/network-scripts</code>目录下, 工具有 <code>nmcli, nmtui, nm-connect-editor</code></p>
<p><code>device</code>物理设备, 例如 <code>ens33,enp2s0,virbr0,team0</code><br><code>connection</code>连接设置, 具体网络配置方案</p>
<blockquote>
<p>1.不同的网络连接配置可以应用到相同的物理设备，但物理设备同一时间只能应用其中某个网络连接<br>2.针对物理网络接口, 设定不同的网络连接, 在不同的使用环境中激活相应的网络连接，就可以实现网络配置信息的自动切换了</p>
</blockquote>
<p>使用<code>nmcli</code>命令查看设备以及连接情况</p>
<h5 id="查看设备状态"><a href="#查看设备状态" class="headerlink" title="查看设备状态"></a>查看设备状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli device</span></span><br><span class="line">设备        类型      状态    连接   </span><br><span class="line">virbr0      bridge    连接的  virbr0 </span><br><span class="line">eth0        ethernet  连接的  eth0   </span><br><span class="line">lo          loopback  未托管  --     </span><br><span class="line">virbr0-nic  tun       未托管  --</span><br></pre></td></tr></table></figure>

<h5 id="查看指定设备的详细状态"><a href="#查看指定设备的详细状态" class="headerlink" title="查看指定设备的详细状态"></a>查看指定设备的详细状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli device show eth0</span></span><br><span class="line">GENERAL.设备:                           eth0</span><br><span class="line">GENERAL.类型:                           ethernet</span><br><span class="line">GENERAL.硬盘:                           00:0C:29:AB:CC:67</span><br><span class="line">GENERAL.MTU:                            1500</span><br><span class="line">GENERAL.状态:                           100 (连接的)</span><br><span class="line">GENERAL.连接:                           eth0</span><br><span class="line">GENERAL.连接路径:                       /org/freedesktop/NetworkManager/ActiveConnection/1</span><br><span class="line">WIRED-PROPERTIES.载波:                  开</span><br><span class="line">IP4.地址[1]:                            192.168.83.140/24</span><br><span class="line">IP4.网关:                               192.168.83.2</span><br><span class="line">IP4.路由[1]:                            dst = 192.168.83.144/32, nh = 192.168.83.2, mt = 0</span><br><span class="line">IP4.DNS[1]:                             192.168.83.2</span><br><span class="line">IP6.地址[1]:                            fe80::20c:29ff:feab:cc67/64</span><br><span class="line">IP6.网关:                               --</span><br></pre></td></tr></table></figure>

<h5 id="查看连接状态"><a href="#查看连接状态" class="headerlink" title="查看连接状态"></a>查看连接状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection</span></span><br><span class="line">名称    UUID                                  类型            设备   </span><br><span class="line">eth0    bb501ad9-f26f-4310-b857-14a1fc520546  802-3-ethernet  eth0   </span><br><span class="line">virbr0  d8b4e76e-b469-4ff4-8937-cef5cc254873  bridge          virbr0</span><br></pre></td></tr></table></figure>

<h5 id="查看所有活动的连接"><a href="#查看所有活动的连接" class="headerlink" title="查看所有活动的连接"></a>查看所有活动的连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection show</span></span><br><span class="line">名称    UUID                                  类型            设备   </span><br><span class="line">eth0    bb501ad9-f26f-4310-b857-14a1fc520546  802-3-ethernet  eth0   </span><br><span class="line">virbr0  d8b4e76e-b469-4ff4-8937-cef5cc254873  bridge          virbr0</span><br></pre></td></tr></table></figure>

<h5 id="查看指定设备连接的详细情况"><a href="#查看指定设备连接的详细情况" class="headerlink" title="查看指定设备连接的详细情况"></a>查看指定设备连接的详细情况</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># nmcli connection show eth0</span></span><br><span class="line">connection.id:                          eth0</span><br><span class="line">connection.uuid:                        bb501ad9-f26f-4310-b857-14a1fc520546</span><br><span class="line">connection.stable-id:                   --</span><br><span class="line">connection.interface-name:              eth0</span><br><span class="line">connection.type:                        802-3-ethernet</span><br><span class="line">connection.autoconnect:                 yes</span><br><span class="line">connection.autoconnect-priority:        0</span><br><span class="line">connection.autoconnect-retries:         -1 (默认)</span><br><span class="line">connection.timestamp:                   1555937607</span><br><span class="line">connection.read-only:                   no</span><br><span class="line">connection.permissions:                 --</span><br><span class="line">connection.zone:                        --</span><br><span class="line">connection.master:                      --</span><br><span class="line">connection.slave-type:                  --</span><br><span class="line">connection.autoconnect-slaves:          -1 (默认)</span><br><span class="line">connection.secondaries:                 --</span><br><span class="line">connection.gateway-ping-timeout:        0</span><br><span class="line">connection.metered:                     未知</span><br><span class="line">connection.lldp:                        -1 (default)</span><br><span class="line">802-3-ethernet.port:                    --</span><br><span class="line">802-3-ethernet.speed:                   0</span><br><span class="line">802-3-ethernet.duplex:                  --</span><br><span class="line">802-3-ethernet.auto-negotiate:          no</span><br><span class="line">802-3-ethernet.mac-address:             --</span><br><span class="line">802-3-ethernet.cloned-mac-address:      --</span><br><span class="line">802-3-ethernet.generate-mac-address-mask:--</span><br><span class="line">802-3-ethernet.mac-address-blacklist:   --</span><br><span class="line">802-3-ethernet.mtu:                     自动</span><br><span class="line">802-3-ethernet.s390-subchannels:        --</span><br><span class="line">802-3-ethernet.s390-nettype:            --</span><br><span class="line">802-3-ethernet.s390-options:            --</span><br><span class="line">802-3-ethernet.wake-on-lan:             1 (default)</span><br><span class="line">802-3-ethernet.wake-on-lan-password:    --</span><br><span class="line">ipv4.method:                            manual</span><br><span class="line">ipv4.dns:                               192.168.83.2</span><br><span class="line">ipv4.dns-search:                        --</span><br><span class="line">ipv4.dns-options:                       （默认）</span><br><span class="line">ipv4.dns-priority:                      0</span><br><span class="line">ipv4.addresses:                         192.168.83.140/24</span><br><span class="line">ipv4.gateway:                           192.168.83.2</span><br><span class="line">ipv4.routes:                            --</span><br><span class="line">ipv4.route-metric:                      -1</span><br><span class="line">ipv4.ignore-auto-routes:                no</span><br><span class="line">ipv4.ignore-auto-dns:                   no</span><br><span class="line">ipv4.dhcp-client-id:                    --</span><br><span class="line">ipv4.dhcp-timeout:                      0</span><br><span class="line">ipv4.dhcp-send-hostname:                yes</span><br><span class="line">ipv4.dhcp-hostname:                     --</span><br><span class="line">ipv4.dhcp-fqdn:                         --</span><br><span class="line">ipv4.never-default:                     no</span><br><span class="line">ipv4.may-fail:                          yes</span><br><span class="line">ipv4.dad-timeout:                       -1 (默认)</span><br><span class="line">ipv6.method:                            ignore</span><br><span class="line">ipv6.dns:                               --</span><br><span class="line">ipv6.dns-search:                        --</span><br><span class="line">ipv6.dns-options:                       （默认）</span><br><span class="line">ipv6.dns-priority:                      0</span><br><span class="line">ipv6.addresses:                         --</span><br><span class="line">ipv6.gateway:                           --</span><br><span class="line">ipv6.routes:                            --</span><br><span class="line">ipv6.route-metric:                      -1</span><br><span class="line">ipv6.ignore-auto-routes:                no</span><br><span class="line">ipv6.ignore-auto-dns:                   no</span><br><span class="line">ipv6.never-default:                     no</span><br><span class="line">ipv6.may-fail:                          yes</span><br><span class="line">ipv6.ip6-privacy:                       -1 (未知)</span><br><span class="line">ipv6.addr-gen-mode:                     stable-privacy</span><br><span class="line">ipv6.dhcp-send-hostname:                yes</span><br><span class="line">ipv6.dhcp-hostname:                     --</span><br><span class="line">ipv6.token:                             --</span><br><span class="line">proxy.method:                           none</span><br><span class="line">proxy.browser-only:                     no</span><br><span class="line">proxy.pac-url:                          --</span><br><span class="line">proxy.pac-script:                       --</span><br><span class="line">GENERAL.名称:                           eth0</span><br><span class="line">GENERAL.UUID:                           bb501ad9-f26f-4310-b857-14a1fc520546</span><br><span class="line">GENERAL.设备:                           eth0</span><br><span class="line">GENERAL.状态:                           已激活</span><br><span class="line">GENERAL.默认:                           是</span><br><span class="line">GENERAL.默认6:                          否</span><br><span class="line">GENERAL.VPN 参数:                       否</span><br><span class="line">GENERAL.区:                             --</span><br><span class="line">GENERAL.DBUS路径:                       /org/freedesktop/NetworkManager/ActiveConnection/1</span><br><span class="line">GENERAL.连接路径:                       /org/freedesktop/NetworkManager/Settings/1</span><br><span class="line">GENERAL.指定对象:                       --</span><br><span class="line">GENERAL.主路径:                         --</span><br><span class="line">IP4.地址[1]:                            192.168.83.140/24</span><br><span class="line">IP4.网关:                               192.168.83.2</span><br><span class="line">IP4.路由[1]:                            dst = 192.168.83.144/32, nh = 192.168.83.2, mt = 0</span><br><span class="line">IP4.DNS[1]:                             192.168.83.2</span><br><span class="line">IP6.地址[1]:                            fe80::20c:29ff:feab:cc67/64</span><br><span class="line">IP6.网关:                               --</span><br></pre></td></tr></table></figure>

<h2 id="使用原生network管理网络"><a href="#使用原生network管理网络" class="headerlink" title="使用原生network管理网络"></a>使用原生network管理网络</h2><p><code>CentOS/RHEL</code>的网络配置文件默认目录为<code>/etc/sysconfig/network-scripts</code><br>默认第一块物理网卡配置文件为<code>ifcfg-eth0</code>, 如果有第二块物理网卡, 配置文件则为<code>ifcfg-eth1</code>以此类推。 注意: 如果新增物理网卡没有配置文件，可选择复制系统默认的进行修改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//设置NetworkManger开机不启动, 同时停止NetworkManger服务</span><br><span class="line">[root@zhoulijie ~]# systemctl disable NetworkManager</span><br><span class="line">[root@zhoulijie ~]# systemctl stop NetworkManager</span><br><span class="line"></span><br><span class="line">//添加一块物理网卡, 然后新增网络连接配置文件</span><br><span class="line">//复制配置eth0配置文件为eth1</span><br><span class="line">[root@zhoulijie ~]# cd /etc/sysconfig/network-scripts/</span><br><span class="line">[root@zhoulijie network-scripts]# cp ifcfg-eth0 ifcfg-eth1</span><br><span class="line"></span><br><span class="line">//编辑网卡配置文件</span><br><span class="line">[root@zhoulijie ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">NAME=eth1</span><br><span class="line">UUID=bb501ad9-f26f-4310-b857-14a1fc520546</span><br><span class="line">DEVICE=eth1</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.83.141</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.83.2</span><br><span class="line">DNS1=192.168.83.2</span><br><span class="line"></span><br><span class="line">//重启network网络服务加载网络并设置开机启动</span><br><span class="line">[root@zhoulijie ~]# systemctl restart network</span><br><span class="line">[root@zhoulijie ~]# systemctl enable network</span><br></pre></td></tr></table></figure>

<h2 id="网络检测工具与故障排查"><a href="#网络检测工具与故障排查" class="headerlink" title="网络检测工具与故障排查"></a>网络检测工具与故障排查</h2><h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><p><code>ping</code>命令的目的在于测试另一台主机是否可达, 如果ping不到某台主机,就说明对方主机已经出现了问题, 但是不排除由于链路中的防火墙、ping被丢弃等原因造成ping不通的情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//ping命令常用选项：</span><br><span class="line">    -c 指定ping的次数</span><br><span class="line">    -i 指定ping包的发送间隔</span><br><span class="line">    -w 如果ping没有回应, 则在指定超时时间后退出</span><br></pre></td></tr></table></figure>

<h3 id="host与nslookup"><a href="#host与nslookup" class="headerlink" title="host与nslookup"></a>host与nslookup</h3><p><code>host/nslookup</code>命令用于查询DNS记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># host www.baidu.com</span></span><br><span class="line">www.baidu.com is an <span class="built_in">alias</span> <span class="keyword">for</span> www.a.shifen.com.</span><br><span class="line">www.a.shifen.com has address 180.97.33.107</span><br><span class="line">www.a.shifen.com has address 180.97.33.108</span><br><span class="line"></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># nslookup  www.baidu.com</span></span><br><span class="line">Server:         192.168.83.2</span><br><span class="line">Address:        192.168.83.2<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">www.baidu.com   canonical name = www.a.shifen.com.</span><br><span class="line">Name:   www.a.shifen.com</span><br><span class="line">Address: 180.97.33.108</span><br><span class="line">Name:   www.a.shifen.com</span><br><span class="line">Address: 180.97.33.107</span><br></pre></td></tr></table></figure>

<h3 id="traceroute"><a href="#traceroute" class="headerlink" title="traceroute"></a>traceroute</h3><p><code>traceroute</code>命令用于路由跟踪, 检测网络故障出现在ISP运营商或是对端服务无法响应</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># traceroute www.baidu.com</span></span><br><span class="line">traceroute to www.baidu.com (180.97.33.107), 30 hops max, 60 byte packets</span><br><span class="line">1  gateway (192.168.83.2)  0.143 ms  0.066 ms  0.089 ms</span><br><span class="line"> 2  * * *</span><br><span class="line"> 3  * * *</span><br><span class="line"> 4  * * *</span><br><span class="line"> 5  * * *</span><br><span class="line"> 6  * * *</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在武汉地区，路由追踪被运营商限制</p>
<p>在北上广深可以路由追踪</p>
</blockquote>
<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p><code>netstat</code>用于查看网络状态</p>
<h5 id="显示路由表"><a href="#显示路由表" class="headerlink" title="显示路由表"></a>显示路由表</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -r</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">default         gateway         0.0.0.0         UG        0 0          0 eth0</span><br><span class="line">192.168.83.0    0.0.0.0         255.255.255.0   U         0 0          0 eth0</span><br><span class="line">192.168.83.144  gateway         255.255.255.255 UGH       0 0          0 eth0</span><br><span class="line">192.168.122.0   0.0.0.0         255.255.255.0   U         0 0          0 virbr0</span><br></pre></td></tr></table></figure>

<h5 id="以数字方式显示路由表"><a href="#以数字方式显示路由表" class="headerlink" title="以数字方式显示路由表"></a>以数字方式显示路由表</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -rn</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">0.0.0.0         192.168.83.2    0.0.0.0         UG        0 0          0 eth0</span><br><span class="line">192.168.83.0    0.0.0.0         255.255.255.0   U         0 0          0 eth0</span><br><span class="line">192.168.83.144  192.168.83.2    255.255.255.255 UGH       0 0          0 eth0</span><br><span class="line">192.168.122.0   0.0.0.0         255.255.255.0   U         0 0          0 virbr0</span><br></pre></td></tr></table></figure>

<h5 id="显示建立的tcp连接"><a href="#显示建立的tcp连接" class="headerlink" title="显示建立的tcp连接"></a>显示建立的tcp连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -t</span></span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span><br></pre></td></tr></table></figure>

<h5 id="显示udp连接"><a href="#显示udp连接" class="headerlink" title="显示udp连接"></a>显示udp连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -u</span></span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span><br></pre></td></tr></table></figure>

<h5 id="显示监听状态的连接"><a href="#显示监听状态的连接" class="headerlink" title="显示监听状态的连接"></a>显示监听状态的连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -l</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State      </span><br><span class="line">tcp        0      0 0.0.0.0:sunrpc          0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 zhoulijie:domain        0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 localhost:ipp           0.0.0.0:*               LISTEN    </span><br><span class="line">..................以下省略.......................</span><br></pre></td></tr></table></figure>

<h5 id="显示所有状态的连接"><a href="#显示所有状态的连接" class="headerlink" title="显示所有状态的连接"></a>显示所有状态的连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -a</span></span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State      </span><br><span class="line">tcp        0      0 0.0.0.0:sunrpc          0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 zhoulijie:domain        0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 localhost:ipp           0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 localhost:smtp          0.0.0.0:*               LISTEN   </span><br><span class="line">..................以下省略.......................</span><br></pre></td></tr></table></figure>

<h5 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h5><blockquote>
<p> -antlp</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -antlp</span></span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 0.0.0.0:55033           0.0.0.0:*               LISTEN      1732/rpc.statd</span><br><span class="line">tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      1726/rpcbind</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     </span><br><span class="line">..................以下省略.......................</span><br></pre></td></tr></table></figure>

<h3 id="ss"><a href="#ss" class="headerlink" title="ss"></a>ss</h3><p><code>ss</code>是一种网络状态查看工具，取代netstat</p>
<blockquote>
<p>语法：ss [options][ FILTER ]<br>常用的options：<br>    -t：tcp协议相关<br>    -u：udp协议相关<br>    -w：裸套接字相关<br>    -x：unix套接字相关<br>    -l：listen状态的连接<br>    -a：所有<br>    -n：数字格式<br>    -p：相关的程序及pid<br>    -e：扩展的信息<br>    -m：内存用量<br>    -o：显示计时器信息</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">常见的FILTER：</span><br><span class="line">    FILTER := [ state TCP-STATE ] [ EXPRESSION ]</span><br><span class="line">    如：ss -tan state ESTABLISHED</span><br><span class="line">                        </span><br><span class="line">常见的state：</span><br><span class="line">    //tcp finite state machine：有限状态机</span><br><span class="line">        LISTEN：监听</span><br><span class="line">        ESTABLISHED：已建立的连接</span><br><span class="line">        </span><br><span class="line">EXPRESSION：</span><br><span class="line">	dport =</span><br><span class="line">	sport =</span><br><span class="line">示例：&apos;( dport = :ssh or sport = :ssh)&apos;，此处的ssh也即服务名可以使用其对应的端口号代替，等号两边必须有空格</span><br></pre></td></tr></table></figure>

<h5 id="常用组合"><a href="#常用组合" class="headerlink" title="常用组合"></a>常用组合</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ss -tan</span></span><br><span class="line">State      Recv-Q Send-Q                Local Address:Port                               Peer Address:Port</span><br><span class="line">LISTEN     0      128                               *:22                                            *:*</span><br><span class="line">LISTEN     0      100                       127.0.0.1:25                                            *:*</span><br><span class="line">ESTAB      0      0                     172.16.12.128:22                                  172.16.12.1:56187</span><br><span class="line">ESTAB      0      0                     172.16.12.128:22                                  172.16.12.1:53808</span><br><span class="line">LISTEN     0      128                              :::22                                           :::*</span><br><span class="line">LISTEN     0      100                             ::1:25                                           :::*</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ss -tanl</span></span><br><span class="line">State      Recv-Q Send-Q                Local Address:Port                               Peer Address:Port</span><br><span class="line">LISTEN     0      128                               *:22                                            *:*</span><br><span class="line">LISTEN     0      100                       127.0.0.1:25                                            *:*</span><br><span class="line">LISTEN     0      128                              :::22                                           :::*</span><br><span class="line">LISTEN     0      100                             ::1:25                                           :::*</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ss -antlp</span></span><br><span class="line">State      Recv-Q Send-Q                Local Address:Port                               Peer Address:Port</span><br><span class="line">LISTEN     0      128                               *:22                                            *:*                   users:((<span class="string">"sshd"</span>,pid=889,fd=3))</span><br><span class="line">LISTEN     0      100                       127.0.0.1:25                                            *:*                   users:((<span class="string">"master"</span>,pid=1007,fd=13))</span><br><span class="line">LISTEN     0      128                              :::22                                           :::*                   users:((<span class="string">"sshd"</span>,pid=889,fd=4))</span><br><span class="line">LISTEN     0      100                             ::1:25                                           :::*                   users:((<span class="string">"master"</span>,pid=1007,fd=14))</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ss -anu</span></span><br><span class="line">State      Recv-Q Send-Q                Local Address:Port                               Peer Address:Port</span><br><span class="line">UNCONN     0      0                                 *:23511                                         *:*</span><br><span class="line">UNCONN     0      0                                 *:68                                            *:*</span><br><span class="line">UNCONN     0      0                                :::35299                                        :::*</span><br></pre></td></tr></table></figure>

<h5 id="常见端口"><a href="#常见端口" class="headerlink" title="常见端口"></a>常见端口</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http    80/tcp </span><br><span class="line">https   443/tcp </span><br><span class="line">ssh     22/tcp </span><br><span class="line">ftp     20,21/tcp</span><br><span class="line">mysql   3306/tcp</span><br><span class="line">rsync   873/rsync</span><br><span class="line">redis   6379/tcp</span><br></pre></td></tr></table></figure>

<h3 id="网络故障排查"><a href="#网络故障排查" class="headerlink" title="网络故障排查"></a>网络故障排查</h3><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>1.如何查看系统中每个ip的连接数 </p>
<blockquote>
<p> netstat -ntu | awk ‘{print $5}’ | cut -d: -f1 | sort | uniq -c | sort -n</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -ntu | awk '&#123;print $5&#125;' | cut -d: -f1 | sort | uniq -c | sort -n</span></span><br><span class="line">      1 Address</span><br><span class="line">      1 servers)</span><br></pre></td></tr></table></figure>

<p>2.请列出下列服务使用的端口,http,ftp,ssh,telnet,mysql,dns </p>
<blockquote>
<p> http      80 </p>
<p> ftp        20,21 </p>
<p> ssh       22</p>
<p> telnet    23</p>
<p> mysql    3306 </p>
<p> dns       53</p>
</blockquote>
<p>3.如何在虚拟机上新增加一块网卡，并配置IP为172.16.0.10，指定网关为172.16.0.1 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># cd /etc/sysconfig/network-scripts/</span></span><br><span class="line">[root@zhoulijie network-scripts]<span class="comment"># cp ifcfg-eth0 ifcfg-eth1</span></span><br><span class="line">[root@zhoulijie network-scripts]<span class="comment"># vim ifcfg-eth1</span></span><br><span class="line">[root@zhoulijie network-scripts]<span class="comment"># cat ifcfg-eth1</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">NAME=eth1      //此处eth0改成eth1</span><br><span class="line">UUID=bb501ad9-f26f-4310-b857-14a1fc520546</span><br><span class="line">DEVICE=eth1    //此处eth0改成eth1</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=172.16.0.10  //此处更改IP</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=172.16.0.1  //此处更改网关</span><br><span class="line">DNS1=172.16.0.1     //此处更改DNS1</span><br><span class="line">[root@zhoulijie network-scripts]<span class="comment"># systemctl restart network</span></span><br></pre></td></tr></table></figure>

<p>4.详细描述dns解析过程，以访问<a href="http://www.baidu.com为例" target="_blank" rel="noopener">www.baidu.com为例</a> </p>
<blockquote>
<p>打开浏览器，输入一个域名:<a href="http://www.baidu.com，这时，你使用的电脑会发出一个DNS请求到本地DNS服务器。本地DNS服务器一般都是你的网络接入服务器商提供，比如中国电信，中国移动。" target="_blank" rel="noopener">www.baidu.com，这时，你使用的电脑会发出一个DNS请求到本地DNS服务器。本地DNS服务器一般都是你的网络接入服务器商提供，比如中国电信，中国移动。</a></p>
<p>查询<a href="http://www.baidu.com的DNS请求到达本地DNS服务器之后，本地DNS服务器会首先查询它的缓存记录，如果缓存中有此条记录，就可以直接返回结果。如果没有，本地DNS服务器还要向DNS根服务器进行查询。" target="_blank" rel="noopener">www.baidu.com的DNS请求到达本地DNS服务器之后，本地DNS服务器会首先查询它的缓存记录，如果缓存中有此条记录，就可以直接返回结果。如果没有，本地DNS服务器还要向DNS根服务器进行查询。</a></p>
<p>根DNS服务器没有记录具体的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上去继续查询，并给出域服务器的地址。</p>
<p>本地DNS服务器继续向域服务器发出请求，在这个例子中，请求的对象是.com域服务器。.com域服务器收到请求之后，也不会直接返回域名和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址。</p>
<p>最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP地址对应关系，本地DNS服务器不仅要把IP地址返回给用户电脑，还要把这个对应关系保存在缓存中，以备下次别的用户查询时，可以直接返回结果，加快网络访问。</p>
</blockquote>
<p>5.如何查看系统中运行了多少个进程 </p>
<blockquote>
<p> ps -aux | wc -l</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie network-scripts]<span class="comment"># ps -aux | wc -l</span></span><br><span class="line">243</span><br></pre></td></tr></table></figure>

<p>6.如何查看系统中启动了哪些端口</p>
<blockquote>
<p>ss -tan</p>
</blockquote>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment">#  ss -tan</span></span><br><span class="line">State      Recv-Q Send-Q                         Local Address:Port                                        Peer Address:Port              </span><br><span class="line">LISTEN     0      128                                        *:111                                                    *:*                  </span><br><span class="line">LISTEN     0      5                              192.168.122.1:53                                                     *:*                  </span><br><span class="line">LISTEN     0      128                                        *:22                                                     *:*                  </span><br><span class="line">LISTEN     0      128                                127.0.0.1:631                                                    *:*                  </span><br><span class="line">LISTEN     0      100                                127.0.0.1:25                                                     *:*                  </span><br><span class="line">LISTEN     0      128                                       :::111                                                   :::*                  </span><br><span class="line">LISTEN     0      128                                       :::22                                                    :::*                  </span><br><span class="line">LISTEN     0      128                                      ::1:631                                                   :::*                  </span><br><span class="line">LISTEN     0      100                                      ::1:25</span><br></pre></td></tr></table></figure>

<p>7.如何查看是否开启80端口，及查看sshd进程是否存在 </p>
<blockquote>
<p>netstat   -nultp | grep 80</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat   -nultp | grep 80</span></span><br><span class="line"></span><br><span class="line">[root@zhoulijie ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ps -aux | grep sshd</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ps -aux | grep sshd</span></span><br><span class="line">root       1193  0.0  0.2 105996  4076 ?        Ss   18:48   0:00 /usr/sbin/sshd -D</span><br><span class="line">root       6448  0.0  0.0 112676   984 pts/0    R+   22:23   0:00 grep --color=auto sshd</span><br></pre></td></tr></table></figure>

<p>8.列出所有处于监听状态的tcp端口 </p>
<blockquote>
<p>netstat -l | grep tcp</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -l | grep tcp</span></span><br><span class="line">tcp        0      0 0.0.0.0:sunrpc          0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 zhoulijie:domain        0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 localhost:ipp           0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 localhost:smtp          0.0.0.0:*               LISTEN     </span><br><span class="line">tcp6       0      0 [::]:sunrpc             [::]:*                  LISTEN     </span><br><span class="line">tcp6       0      0 [::]:ssh                [::]:*                  LISTEN     </span><br><span class="line">tcp6       0      0 localhost:ipp           [::]:*                  LISTEN     </span><br><span class="line">tcp6       0      0 localhost:smtp          [::]:*                  LISTEN</span><br></pre></td></tr></table></figure>

<p>9.查看所有的端口信息, 包括 PID 和进程名称 </p>
<blockquote>
<p>netstat -antlp</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># netstat -antlp</span></span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      1/systemd           </span><br><span class="line">tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      1391/dnsmasq        </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1193/sshd           </span><br><span class="line">tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      1197/cupsd          </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1321/master         </span><br><span class="line">tcp6       0      0 :::111                  :::*                    LISTEN      1/systemd           </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1193/sshd           </span><br><span class="line">tcp6       0      0 ::1:631                 :::*                    LISTEN      1197/cupsd          </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      1321/master</span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/10.linux--网络基础管理/" data-id="ck7ooyamu003x4su6nqoicvis"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-9.linux--linux进程管理" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/9.linux--linux进程管理/"
    >linux进程管理</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/9.linux--linux进程管理/" class="article-date">
  <time datetime="2019-08-29T15:44:18.571Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>[TOC]</p>
<h2 id="进程基本概述"><a href="#进程基本概述" class="headerlink" title="进程基本概述"></a>进程基本概述</h2><p>进程是已启动的可执行程序的运行中实例。</p>
<p>/proc目录下以数字为名的目录，每一个目录代表一个进程，保存着进程的属性信息。每一个进程的PID是唯一的，就算进程退出了，其它进程也不会占用其PID。</p>
<h4 id="进程的组成部分"><a href="#进程的组成部分" class="headerlink" title="进程的组成部分"></a>进程的组成部分</h4><ul>
<li>已分配内存的地址空间</li>
<li>安全属性，包括所有权凭据和特权</li>
<li>程序代码的一个或多个执行线程</li>
<li>进程状态</li>
</ul>
<h4 id="进程的环境"><a href="#进程的环境" class="headerlink" title="进程的环境"></a>进程的环境</h4><ul>
<li>本地和全局变量</li>
<li>当前调度上下文</li>
<li>分配的系统资源，如文件描述符和网络端口</li>
</ul>
<h4 id="进程的产生"><a href="#进程的产生" class="headerlink" title="进程的产生"></a>进程的产生</h4><p>现有的（父）进程复制自己的地址空间（fork）来创建一个新的（子）进程结构。 每个新进程分配有一个唯一的进程ID（PID），满足跟踪和安全性之需。PID与父进程ID（PPID）是新进程环境的元素。 任何进程可创建子进程。所有进程都是第一个系统进程的后代。RHEL7上，第一个系统进程是systemd。 </p>
<p><img src="https://s2.ax1x.com/2019/04/09/AoEPY9.png" alt></p>
<p>通过fork例程，子进程继承安全性身份、过去和当前的文件描述符、端口和资源特权、环境变量，以及程序代码。随后，子进程可能exec其自己的程序代码。通常，父进程在子进程运行期间处于睡眠状态，设置一个在子进程完成时发出信号的请求（wait）。在退出时，子进程可能已经关闭或丢弃了其资源和环境，剩余的部分被称作僵停。父进程在子进程退出时收到信号而被唤醒，清理剩余结构，然后继续执行其自己的程序代码。 </p>
<h4 id="进程的分类"><a href="#进程的分类" class="headerlink" title="进程的分类"></a>进程的分类</h4><ul>
<li>前台进程：与终端相关的进程，通过终端启动的进程 <ul>
<li>注意：也可把在前台启动的进程送往后台，以守护模式运行</li>
</ul>
</li>
</ul>
<ul>
<li>守护进程：daemon，与终端无关的进程（如内核），在系统引导过程中启动的进程</li>
</ul>
<h2 id="进程状态"><a href="#进程状态" class="headerlink" title="进程状态"></a>进程状态</h2><p><img src="https://s2.ax1x.com/2019/04/09/AoE86P.png" alt></p>
<blockquote>
<p>Excuting                          //运行态<br>Ready                              //就绪态，也可以称作睡眠态<br>Uninterruptible sleep   //不可中断的睡眠。不可随时唤醒，只有当IO资源加载成功后才能唤醒<br>Interruptible sleep      //可中断的睡眠。可随时唤醒<br>Zombie                        //僵尸进程。正常运行结束了，但是不释放占据的内存<br>Stopped                       //停止态，暂停于内存中，但不会被调度，除非手动启动之</p>
</blockquote>
<blockquote>
<p>进程睡眠的原因： 当一个执行中的进程，需要加载额外的IO资源的时候，由于IO设备的速度太慢，所以会转入睡眠状态等待，交出CPU给其他进程，以免浪费剩余执行时间 </p>
</blockquote>
<p>在多任务处理操作系统中，每个CPU（或CPU核心）在一个时间点上处理一个进程。在进程运行时，它对CPU时间和资源分配的直接要求会有变化。进程分配有一个状态，它随着环境要求而改变。 </p>
<h6 id="Linux进程状态"><a href="#Linux进程状态" class="headerlink" title="Linux进程状态"></a>Linux进程状态</h6><table>
<thead>
<tr>
<th>标志</th>
<th>内核定义的状态名称和描述</th>
</tr>
</thead>
<tbody><tr>
<td>R</td>
<td>TASK_RUNNING：进程正在CPU上执行，或者正在等待运行。处于运行中（或可运行）状态时，进程可能正在执行用户例程或内核例程（系统调用），或者已排队并就绪</td>
</tr>
<tr>
<td>S</td>
<td>TASK_INTERRUPTIBLE：进程处于睡眠状态且正在等待某一条件：硬件请求、系统资源访问或信号。当事件或信号满足该条件时，该进程将返回到运行中</td>
</tr>
<tr>
<td>D</td>
<td>TASK_UNINTERRUPTIBLE：此进程也在睡眠，但与S状态不同，不会响应传递的信号。仅在特定的条件下使用，其中进程中断可能会导致意外的设备状态</td>
</tr>
<tr>
<td>K</td>
<td>TASK_KILLABLE：进程处于睡眠状态，与不可中断的D状态相同，但有所修改，允许等待中的任务通过响应信号而被中断（彻底退出）。实用程序通常将可中断的进程显示为D状态</td>
</tr>
<tr>
<td>T</td>
<td>TASK_STOPPED：进程已被停止（暂停），通常是通过用户或其他进程发出的信号。进程可以通过另一信号返回到运行中状态，继续执行（恢复）</td>
</tr>
<tr>
<td>T</td>
<td>TASK_TRACED：正在被调试的进程也会临时停止，并且共享同一个T状态标志</td>
</tr>
<tr>
<td>Z</td>
<td>EXIT_ZOMBIE：子进程在退出时向父进程发出信号。除进程身份（PID）之外的所有资源都已释放</td>
</tr>
<tr>
<td>X</td>
<td>EXIT_DEAD：当父进程清理（获取）剩余的子进程结构时，进程现在已彻底释放。此状态从不会在进程列出实用程序中看到</td>
</tr>
<tr>
<td>&lt;</td>
<td>高优先级进程</td>
</tr>
<tr>
<td>N</td>
<td>低优先级进程</td>
</tr>
<tr>
<td>+</td>
<td>前台进程组中的进程</td>
</tr>
<tr>
<td>|</td>
<td>多线程进程</td>
</tr>
<tr>
<td>s</td>
<td>会话进程首进程</td>
</tr>
</tbody></table>
<h2 id="进程优先级"><a href="#进程优先级" class="headerlink" title="进程优先级"></a>进程优先级</h2><h4 id="linux进程调度与多任务"><a href="#linux进程调度与多任务" class="headerlink" title="linux进程调度与多任务"></a>linux进程调度与多任务</h4><p>现代计算机系统中既包含每次只能执行一个指令的低端处理器，也包含高性能超级计算机，这些超级计算机每台配备数百个CPU，每个CPU上具有多个核心，它们可以并行执行数以百计的指令。但是所有这些系统往往具有一个共同点：它们需要运行的进程数量总是超出实际具有的核心数。</p>
<p>通过时间分片技术，Linux（和其他操作系统）实际能够运行的进程数（和线程数）可以超出可用的实际处理单元数。操作系统进程调度程序将在单个核心上的进程之间进行快速切换，从而给用户一种有多个进程在同时运行的印象。</p>
<p>执行此切换的Linux内核部分称为进程调度程序。</p>
<h4 id="进程优先级-1"><a href="#进程优先级-1" class="headerlink" title="进程优先级"></a>进程优先级</h4><ul>
<li>进程优先级范围：0-139，数字越小，优先级越高 <ul>
<li>0-99：实时优先级，内核调整</li>
<li>100-139：静态优先级，用户可控制</li>
</ul>
</li>
<li>进程优先级高的特点： <ul>
<li>获得更多的CPU运行时间</li>
<li>更优先获得CPU运行的机会</li>
</ul>
</li>
</ul>
<p>要修改进程的优先级可以通过调整进程的nice值来实现，nice值越小，优先级越高： nice值的范围是（-20，19），-20对应100，19对应139 </p>
<h4 id="相对优先级"><a href="#相对优先级" class="headerlink" title="相对优先级"></a>相对优先级</h4><p>由于不是每种进程都与其他进程同样重要，可告知调度程序为不同的进程使用不同的调度策略。常规系统上运行的大多数进程所使用的调度策略称为<code>SCHED_OTHER</code>(也称为<code>SCHED_NORMAL</code>)，但还有一些其他策略可用于不同的目的。</p>
<p>由于并非所有进程都以同样的方式创建，可为采用<code>SCHED_NORMAL</code>策略运行的进程指定相对优先级。此优先级称为进程的<code>nice</code>值。一个进程可以有40种不同级别的<code>nice</code>值。</p>
<p>这些<code>nice</code>级别的范围是从-20到19。默认情况下，进程将继承其父进程的<code>nice</code>级别，通常为0</p>
<blockquote>
<p><code>nice</code>级别越高，表示优先级越低（该进程容易将其CPU使用量让给其他进程）<br><code>nice</code>级别越低，表示优先级越高（该进程更加不倾向于让出CPU）<br>如果不存在资源争用（例如当活动进程数少于可用CPU核心数时），即使<code>nice</code>级别高的进程也将仍使用它们可使用的所有可用CPU资源。但当请求CPU时间的进程数超过可用核心数时，<code>nice</code>级别较高的进程将比<code>nice</code>级别较低的进程收到更少的CPU时间</p>
</blockquote>
<h4 id="nice级别与权限"><a href="#nice级别与权限" class="headerlink" title="nice级别与权限"></a>nice级别与权限</h4><p>为很占CPU资源的进程设置较低的<code>nice</code>级别可能会对同一系统上运行的其他进程的性能造成负面影响，所以仅允许root用户设置负<code>nice</code>级别以及降低现有进程的<code>nice</code>级别。</p>
<p>普通非特权用户仅允许设置正的<code>nice</code>级别。只能对现有进程提升<code>nice</code>级别，而不能降低<code>nice</code>级别。</p>
<h4 id="进程优先级调整"><a href="#进程优先级调整" class="headerlink" title="进程优先级调整"></a>进程优先级调整</h4><p>进程优先级调整：调整nice值</p>
<blockquote>
<p>//调整已经启动的进程的nice值：<br>    renice NI PID（例：renice 3 3704）<br>//在启动时指定nice值：（-20，19）<br>    nice -n NI COMMAND</p>
</blockquote>
<h2 id="进程管理命令"><a href="#进程管理命令" class="headerlink" title="进程管理命令"></a>进程管理命令</h2><p>Linux系统各进程的相关信息均保存在/proc/PID目录下的各文件中 </p>
<h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><p>ps命令用于查看系统中的进程状态</p>
<blockquote>
<p>-a  显示所有进程（包括其他用户的进程） </p>
<p>-u  用户以及其他详细信息 </p>
<p>-x  显示没有控制终端的进程 </p>
</blockquote>
<p>Linux系统中时刻运行着许多进程，如果能够合理地管理它们，则可以优化系统的性能。在Linux系统中，有5种常见的进程状态，分别为运行、中断、不可中断、僵死与停止，其各自含义如下所示。 </p>
<blockquote>
<p><strong>R（运行）：</strong>进程正在运行或在运行队列中等待。</p>
<p><strong>S（中断）：</strong>进程处于休眠中，当某个条件形成后或者接收到信号时，则脱离该   状态。</p>
<p><strong>D（不可中断）：</strong>进程不响应系统异步信号，即便用kill命令也不能将其中断。</p>
<p><strong>Z（僵死）：</strong>进程已经终止，但进程描述符依然存在, 直到父进程调用wait4()系统函数后将进程释放。</p>
<p><strong>T（停止）：</strong>进程收到停止信号后停止运行。</p>
</blockquote>
<p>当执行ps aux命令后通常会看到如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># ps aux</span></span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.3  50776  7212 ?        Ss   4月08   0:01 /usr/lib/syst</span><br><span class="line">root          2  0.0  0.0      0     0 ?        S    4月08   0:00 [kthreadd]</span><br><span class="line">root          3  0.0  0.0      0     0 ?        S    4月08   0:00 [ksoftirqd/0]</span><br><span class="line">root          5  0.0  0.0      0     0 ?        S&lt;   4月08   0:00 [kworker/0:0H</span><br><span class="line">root          7  0.0  0.0      0     0 ?        S    4月08   0:00 [migration/0]</span><br><span class="line">root          8  0.0  0.0      0     0 ?        S    4月08   0:00 [rcu_bh]</span><br><span class="line">...............................以下省略...............................</span><br></pre></td></tr></table></figure>

<h4 id="pstree"><a href="#pstree" class="headerlink" title="pstree"></a>pstree</h4><p>pstree用于显示当前系统上的进程树 </p>
<blockquote>
<p> 如果没有 使用yum安装</p>
<p>yum install -y psmisc</p>
</blockquote>
<h4 id="pgrep"><a href="#pgrep" class="headerlink" title="pgrep"></a>pgrep</h4><p>以grep风格指定只显示哪些进程，在当前系统中找符合某些特性的进程。只显示进程号 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># pgrep vim</span></span><br><span class="line">3469</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ps aux | grep vim</span></span><br><span class="line">root       3469  0.0  0.2 151920  5036 pts/0    S+   01:24   0:00 vim 1</span><br><span class="line">root       3502  0.0  0.0 112656   988 pts/2    R+   01:32   0:00 grep --color=auto vim</span><br></pre></td></tr></table></figure>

<h4 id="pidof"><a href="#pidof" class="headerlink" title="pidof"></a>pidof</h4><p>pidof命令用于查询某个指定服务进程的PID值</p>
<p>每个进程的进程号码值（PID）是唯一的，因此可以通过PID来区分不同的进程。例如，可以使用如下命令来查询本机上正在运行的vim的PID：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开两个终端</span></span><br><span class="line"><span class="comment"># 在第一个终端上输入：</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># vim a</span></span><br><span class="line"><span class="comment"># 在第二个终端上输入：</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># pidof vim</span></span><br><span class="line">3358</span><br></pre></td></tr></table></figure>

<h4 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h4><p>虚拟内存状态查看命令 </p>
<blockquote>
<p>vmstat 2        //表示每2秒刷新一次<br>vmstat 2   5      //表示每2秒刷新一次，刷新5次后退出</p>
<p> -s          //显示内存的统计数据  </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># vmstat</span></span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   <span class="keyword">in</span>   cs us sy id wa st</span><br><span class="line"> 2  0      0 1489572   1524 152768    0    0     8     2   12   21  0  0 100  0  0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>procs：<br>    r（running）  //表示等待运行的队列长度，也即等待运行的进程的个数<br>    b（block）    //表示阻塞队列长度，也即处于不可中断睡眠态的进程个数<br>memory：<br>    swpd        //交换内存的使用总量<br>    free        //空闲物理内存总量<br>    buffer      //用于buffer的内存总量<br>    cache       //用于cache的内存总量<br>swap：<br>    si（swap in）     //表示从物理内存有多少页面换进swap，也即数据进入swap的数据速率（kb/s）<br>    so（swap out）    //表示从swap有多少页面换进物理内存，也即数据离开swap的数据速率（kb/s）<br>io：<br>    bi（block in）    //表示磁盘块有多少个被调入内存中，也即从块设备读入数据到系统的速率（kb/s）<br>    bo（block out）   //表示有多少个磁盘块从内存中被同步到硬盘上去了，也即保存数据至块设备的速率（kb/s）<br>system：<br>    in（ interrupts）     //表示中断的个数，也即中断速率（kb/s）<br>    cs（context switch）  //表示上下文切换的次数，也即进程切换速率（kb/s）<br>CPU：<br>    us      //表示用户空间<br>    sy      //表示内核空间<br>    id      //表示空闲百分比<br>    wa      //表示等待IO完成所占据的时间百分比<br>    st      //表示steal，被虚拟化技术偷走的时间（比如运行虚拟机）</p>
</blockquote>
<h2 id="控制作业"><a href="#控制作业" class="headerlink" title="控制作业"></a>控制作业</h2><h4 id="作业与会话"><a href="#作业与会话" class="headerlink" title="作业与会话"></a>作业与会话</h4><p>作业控制是<code>shell</code>的一种功能，它允许单个shell实例运行和管理多个命令。</p>
<p>作业与在<code>shell</code>提示符中输入的每个管道相关联。该管道中的所有进程均是作业的一部分，并且是同一个进程组的成员。（如果在<code>shell</code>提示符中仅输入了一条命令，则这条命令可视为命令的最小管道。该命令将是该作业的唯一成员）</p>
<p>一次只能有一个作业从特定终端窗口读取输入和键盘生成的信号。属于该作业的进程是该控制终端的前台进程。</p>
<p>该控制终端的后台进程是与该终端相关联的任何其他作业的成员。终端的后台进程无法从终端读取输入或接收键盘生成的中断，但可以写入终端。后台中的作业可能已停止（暂停），也可能正在运行。如果某个正在运行的后台作业尝试从终端读取内容，则该作业将自动暂停。</p>
<p>每个终端是其自身的会话，并且可以具有一个前台进程和多个独立的后台进程。一个作业只能属于一个会话，也就是属于其控制终端的会话。</p>
<h4 id="作业分类"><a href="#作业分类" class="headerlink" title="作业分类"></a>作业分类</h4><p>Linux作业分为前台作业与后台作业两种。其各自的特点如下：</p>
<ul>
<li>前台作业：通过终端启动，且启动后一直占据了命令提示符</li>
<li>后台作业：可以通过终端启动，但启动之后，释放命令提示符，后续的操作在后台完成<ul>
<li>此类作业虽然被送往后台运行，但其依然与终端相关。如果希望送往后台后，剥离与终端的关系需要执行（nohup COMMAND &amp;）</li>
</ul>
</li>
</ul>
<h4 id="在后台运行作业"><a href="#在后台运行作业" class="headerlink" title="在后台运行作业"></a>在后台运行作业</h4><p>在命令后跟上&amp;符号可以生成一个后台作业</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># sleep 1000 &amp;</span></span><br><span class="line">[1] 3538</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># sleep 1000 &amp;</span></span><br><span class="line">[2] 3540</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ps</span></span><br><span class="line">   PID TTY          TIME CMD</span><br><span class="line">  3475 pts/2    00:00:00 bash</span><br><span class="line">  3538 pts/2    00:00:00 sleep</span><br><span class="line">  3540 pts/2    00:00:00 sleep</span><br><span class="line">  3541 pts/2    00:00:00 ps</span><br></pre></td></tr></table></figure>

<p>jobs命令用于显示当前所有的后台作业</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]-  运行中               sleep 1000 &amp;</span><br><span class="line">[2]+  运行中               sleep 1000 &amp;</span><br></pre></td></tr></table></figure>

<p>fg命令用于将后台作业调至前台运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># fg</span></span><br><span class="line">sleep 1000</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 当只有一个后台作业时，直接使用fg命令，不跟任何参数即可将后台作业调至前台运行，但是当有多个作业时则必须跟上%+作业号，也就是上面命令执行结果中以[]括起来的数字。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]-  运行中               sleep 1000 &amp;</span><br><span class="line">[2]+  运行中               sleep 1000 &amp;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 使用ctrl+z可将前台进程发送到后台，此时作业将处于停止状态</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># fg %1</span></span><br><span class="line">sleep 1000</span><br><span class="line">^Z</span><br><span class="line">[1]+  已停止               sleep 1000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用bg命令+作业号可使后台已停止的作业重新运行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># bg %1</span></span><br><span class="line">[1]+ sleep 1000 &amp;</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]-  运行中               sleep 1000 &amp;</span><br><span class="line">[2]+  运行中               sleep 1000 &amp;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>kill加上作业号可以手动杀死指定作业</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]-  运行中               sleep 1000 &amp;</span><br><span class="line">[2]+  运行中               sleep 1000 &amp;</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># kill %1</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]-  已终止               sleep 1000</span><br><span class="line">[2]+  运行中               sleep 1000 &amp;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> jobs命令的结果中</p>
<ul>
<li>//命令将默认操作的作业<ul>
<li>//命令将第二个默认操作的作业</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h2><p>进程间通信（IPC：Inter Process Communication）</p>
<p>进程间通信方式：</p>
<ul>
<li><p>同一主机</p>
<ul>
<li>共享内存</li>
<li>信号：Signal</li>
</ul>
</li>
<li><p>不同主机</p>
<ul>
<li><p>rpc：remote procecure call</p>
<ul>
<li><p>基于socket实现进程间通信</p>
<blockquote>
<p>socket 套接字  ip加接口   ss -natl</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="使用信号控制进程"><a href="#使用信号控制进程" class="headerlink" title="使用信号控制进程"></a>使用信号控制进程</h2><p>信号是传递至进程的软件中断。信号向执行中的程序报告事件。生成信号的事件可以是错误或外部事件（如I/O请求或计时器过期），或者来自于明确请求（如使用信号发送命令）</p>
<p>下表列出了系统管理员用于日常进程管理的基本信号。请通过短名称（HUP）或正确名称（SIGHUP）指代信号。</p>
<ul>
<li>指定一个信号的方法： <ul>
<li>信号号码（数字标识）：<code>kill -1</code></li>
<li>信号完整名称：<code>kill -SIGKILL</code></li>
<li>信号简写名称：<code>kill -TERM或kill -KILL或kill -INT或kill -HUP</code></li>
</ul>
</li>
</ul>
<p>基本进程管理信号 </p>
<table>
<thead>
<tr>
<th>信号编号 ID</th>
<th>短名称</th>
<th>定义</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>HUP</td>
<td>挂起</td>
<td>让一个进程不用重启就可以重读配置文件，并让新的配置信息生效</td>
</tr>
<tr>
<td>2</td>
<td>INT</td>
<td>键盘中断</td>
<td>中断一个前台进程。ctrl+c就是用的SIGINT信号</td>
</tr>
<tr>
<td>9</td>
<td>KILL</td>
<td>中断，无法拦截</td>
<td>导致立即终止程序。无法被拦截、忽略或处理</td>
</tr>
<tr>
<td>15 默认值</td>
<td>TERM</td>
<td>终止</td>
<td>导致程序终止。和SIGKILL不同，可以被拦截、忽略或处理。要求程序终止的友好方式，允许自我清理</td>
</tr>
</tbody></table>
<p>用户可以中断自己的进程，但只有root才能终止由其他人拥有的进程。</p>
<h4 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h4><p>kill命令根据ID向进程发送信号。虽其名称为kill，但该命令可用于发送任何信号，而不仅仅是终止程序的信号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># kill -l</span></span><br><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP</span><br><span class="line"> 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1</span><br><span class="line">11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM</span><br><span class="line">16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR</span><br><span class="line">31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># kill 3571</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ps</span></span><br><span class="line">   PID TTY          TIME CMD</span><br><span class="line">  3475 pts/2    00:00:00 bash</span><br><span class="line">  3610 pts/2    00:00:00 ps</span><br><span class="line">[2]+  已终止               sleep 1000</span><br></pre></td></tr></table></figure>

<h2 id="监控进程活动"><a href="#监控进程活动" class="headerlink" title="监控进程活动"></a>监控进程活动</h2><h4 id="IO负载"><a href="#IO负载" class="headerlink" title="IO负载"></a>IO负载</h4><p>负载平均值代表一段时间内感知的系统负载。Linux通过预期服务等待时间的表示来实施平均负载计算。</p>
<p>Linux不仅计算进程数，也作为独立的任务计算线程数。运行中线程和等待I/O资源的线程的CPU请求队列对应于R和D进程状态。等待I/O包括处于睡眠而等待预期磁盘和网络响应的任务。</p>
<p>负载数属于全局计数器计算，是所有CPU的总和数。由于从睡眠返回的任务可能会重新调度到不同的CPU，难以精确的每CPU计数，但累计数的准确度可以保障。显示的平均负载代表所有的CPU。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># grep 'model name' /proc/cpuinfo</span></span><br><span class="line">model name      : Intel(R) Core(TM) i7-7500U CPU @ 2.70GHz</span><br></pre></td></tr></table></figure>

<p>一些UNIX系统仅考虑CPU使用率或运行队列长度来指示系统负载。由于具有空闲CPU的系统可能会因为磁盘或网络资源忙而遇到很长时间的等待，因此Linux负载平均值中包含了对I/O的考量。遇到负载平均值很高但CPU活动很低时，请检查磁盘和网络活动。</p>
<p>Linux中可以使用<code>top</code>、<code>uptime</code>显示负载平均值的情况。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># uptime</span></span><br><span class="line"> 02:11:29 up  5:54,  3 users,  load average: 0.00, 0.01, 0.05</span><br></pre></td></tr></table></figure>

<p>将显示的负载平均值除以系统中的逻辑CPU数。当值低于1表示资源利用率较好，等待时间很短。当值高于1表示资源饱和，而且有一定的服务等待时间。</p>
<p>空闲CPU队列的负载数为0。每个就绪和等待的线程使计数增加1。总队列数为1时，资源（CPU、磁盘或网络）正在使用中，但没有请求把时间花在等待上。增加的请求数会累积该计数，但由于许多请求可以在时限内处理，资源使用率会很高，而等待时间则不会。</p>
<p>因为磁盘或网络资源忙碌等待I/O而处于睡眠的进程包含在该计数内，而且使负载平均值增大。虽然不能表示CPU使用率，队列数依然表明用户和程序正在等待资源服务。</p>
<p>在资源饱和前，平均负载将保持在1以下，因为几乎不会在队列中发现等待的任务。只有资源饱和导致请求留在排队状态并且被负载计算例程计数时，负载平均才会增大。当资源使用率接近100%时，每个增加的请求将开始遭遇服务等待时间。</p>
<h4 id="实时进程监控"><a href="#实时进程监控" class="headerlink" title="实时进程监控"></a>实时进程监控</h4><h4 id="top"><a href="#top" class="headerlink" title="top"></a>top</h4><p>top命令用于动态地监视进程活动与系统负载等信息 </p>
<blockquote>
<p>top命令相当强大，能够动态地查看系统运维状态，完全将它看作Linux中的“强化版的Windows任务管理器” .</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">top - 01:07:42 up  4:50,  4 users,  load average: 0.00, 0.01, 0.05</span><br><span class="line">Tasks: 412 total,   2 running, 410 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem:   1870760 total,   323388 used,  1547372 free,      780 buffers</span><br><span class="line">KiB Swap:  2097148 total,        0 used,  2097148 free.   101676 cached Mem</span><br><span class="line"></span><br><span class="line">   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class="line">     1 root      20   0   50776   7212   2480 S  0.0  0.4   0:01.26 systemd</span><br><span class="line">     2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd</span><br><span class="line">     3 root      20   0       0      0      0 S  0.0  0.0   0:00.04 ksoftirqd/0</span><br><span class="line">     5 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kworker/0:+</span><br><span class="line">     7 root      rt   0       0      0      0 S  0.0  0.0   0:00.00 migration/0</span><br><span class="line">     8 root      20   0       0      0      0 S  0.0  0.0   0:00.00 rcu_bh</span><br><span class="line">     9 root      20   0       0      0      0 S  0.0  0.0   0:00.00 rcuob/0</span><br><span class="line">...............................以下省略..................................</span><br></pre></td></tr></table></figure>

<blockquote>
<p>第1行：系统时间、运行时间、登录终端数、系统负载（三个数值分别为1分钟、5分钟、15分钟内的平均值，数值越小意味着负载越低）。</p>
<p>第2行：进程总数、运行中的进程数、睡眠中的进程数、停止的进程数、僵死的进程数。</p>
<p>第3行：用户占用资源百分比、系统内核占用资源百分比、改变过优先级的进程资源百分比、空闲的资源百分比等。其中数据均为CPU数据并以百分比格式显示，例如“97.1 id”意味着有97.1%的CPU处理器资源处于空闲。</p>
<p>第4行：物理内存总量、内存使用量、内存空闲量、作为内核缓存的内存量。</p>
<p>第5行：虚拟内存总量、虚拟内存使用量、虚拟内存空闲量、已被提前加载的内存量。</p>
</blockquote>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p><strong>写出以下描述对应的进程状态标志：</strong></p>
<table>
<thead>
<tr>
<th>描述</th>
<th align="center">状态标志</th>
</tr>
</thead>
<tbody><tr>
<td>进程已被停止(暂停)</td>
<td align="center">T</td>
</tr>
<tr>
<td>进程已释放了其所有资源(pid除外)</td>
<td align="center">Z</td>
</tr>
<tr>
<td>进程正在CPU上运行或者正在等待于CPU上运行</td>
<td align="center">R</td>
</tr>
<tr>
<td>进程正处于睡眠状态，直至满足某些条件后才会启动</td>
<td align="center">S</td>
</tr>
<tr>
<td>进程正在等待I/O或某些条件得到满足，并且绝对不会影响信号</td>
<td align="center">D</td>
</tr>
</tbody></table>
<p><strong>按以下顺序练习后台与前台进程操作：</strong></p>
<p>并排打开两个终端窗口，分别称为左窗口和右窗口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># 1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<p>在左窗口中，启动一个进程，该进程以一秒为间隔持续向~/outfile文件附加单词”rock”和一个空格。整个命令集必须包含在括号内，以便作业控制可以将该集合解译为一个作业</p>
<blockquote>
<p>[root@localhost ~]# (while true;do echo -n ‘rock ‘ &gt;&gt; ~/outfile;sleep 1;done)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># (while true;do echo -n 'rock ' &gt;&gt; ~/outfile;sleep 1;done)</span></span><br></pre></td></tr></table></figure>

<p>在右窗口中，使用<code>tail</code>确认新进程正在写入该文件</p>
<blockquote>
<p> [root@localhost ~]# tail -f ~/outfile</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie yum.repos.d]<span class="comment"># tail -f ~/outfile</span></span><br><span class="line">rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock rock</span><br></pre></td></tr></table></figure>

<p>在左窗口中，使用<code>ctrl+z</code>快捷键暂停正在运行的进程。<code>shell</code>将返回作业ID并用方括号括起。在右窗口中确认进程输出已经停止</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment">#  (while true;do echo -n 'rock ' &gt;&gt; ~/outfile;sleep 1;done)</span></span><br><span class="line">^Z</span><br><span class="line">[1]+  已停止               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'rock '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> )</span><br></pre></td></tr></table></figure>

<p>在左窗口中，查看jobs列表。+表示当前的作业。使用<code>bg</code>命令在后台重新启动该作业，并再次查看jobs列表，在右窗口中，确认进程输出再次处于活动状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]+  已停止               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'rock '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> )</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># bg</span></span><br><span class="line">[1]+ ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'rock '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]+  运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'rock '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br></pre></td></tr></table></figure>

<p>在左窗口中，再启动两个进程，以便向同一输出文件附加内容。将”rock”替换为”paper”，再替换为”scissors”。要将进程正确置于后台，整个命令集必须包含在括号内，并且以&amp;符号结尾</p>
<blockquote>
<p>[root@localhost ~]# (while true;do echo -n ‘paper ‘ &gt;&gt; ~/outfile;sleep 1;done) &amp;</p>
</blockquote>
<blockquote>
<p>[root@localhost ~]# (while true;do echo -n ‘scissors ‘ &gt;&gt; ~/outfile;sleep 1;done) &amp;</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment">#  (while true;do echo -n 'paper ' &gt;&gt; ~/outfile;sleep 1;done) &amp;</span></span><br><span class="line">[3] 3858</span><br><span class="line">[root@zhoulijie ~]<span class="comment">#  (while true;do echo -n 'scissors ' &gt;&gt; ~/outfile;sleep 1;done) &amp;</span></span><br><span class="line">[4] 3887</span><br></pre></td></tr></table></figure>

<p>在左窗口中，检查jobs，以查看所有三个进程都在运行中。在右窗口中，确认所有三个进程都附加内容到文件中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]   运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'rock '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[2]-  运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'paper '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[3]+  运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'scissors '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br></pre></td></tr></table></figure>

<p>仅使用之前学习的命令，暂停”rock”进程。在左窗口中，使用从jobs列表中确定的作业ID使作业进入前台，然后使用ctrl+z暂停该作业，确认”rock”进程为已停止。在右窗口中，确认”rock”输出不再活动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]   运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'rock '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[2]-  运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'paper '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[3]+  运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'scissors '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># fg %1</span></span><br><span class="line">( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'rock '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> )</span><br><span class="line">^Z</span><br><span class="line">[1]+  已停止               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'rock '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> )</span><br></pre></td></tr></table></figure>

<p>终止”paper”进程。在左窗口中，使作业进入前台，然后使用ctrl+c终止该作业，确认”paper”进程已经消失。在右窗口中，确认”paper”输出不再活动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[3]-  运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'scissors '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[4]+  运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'paper '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># fg %4</span></span><br><span class="line">( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'paper '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> )</span><br><span class="line">^C</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors scissors</span><br></pre></td></tr></table></figure>

<p>在左窗口中，使用ps查看剩余的作业。暂停中的作业具有状态T标志。其他后台作业为睡眠中(S)，因为ps在显示时处于”CPU上”(R)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# ps j</span><br><span class="line">  PPID    PID   PGID    SID TTY       TPGID STAT   UID   TIME COMMAND</span><br><span class="line">   960   2580   2580   2580 tty1       2580 Ss+      0   0:00 -bash</span><br><span class="line">  3333   3337   3337   3337 pts/0      4653 Ss       0   0:00 -bash</span><br><span class="line">  3470   3475   3475   3475 pts/2      5657 Ss       0   0:00 -bash</span><br><span class="line">  3337   3690   3690   3337 pts/0      4653 T        0   0:00 tail -f /root/outfil</span><br><span class="line">  3337   4653   4653   3337 pts/0      4653 S+       0   0:00 tail -f /root/outfil</span><br><span class="line">  3475   4699   4699   3475 pts/2      5657 S        0   0:00 -bash</span><br><span class="line">  4699   5656   4699   3475 pts/2      5657 S        0   0:00 sleep 1</span><br><span class="line">  3475   5657   5657   3475 pts/2      5657 R+       0   0:00 ps j</span><br></pre></td></tr></table></figure>

<p>停止剩余的两个作业。在左窗口中，使其中一个作业进入前台。使用ctrl+c将其终止，对剩余的作业重复此操作。停止的作业在前入前台时会临时重新启动。确认没有剩余的作业，输出也已停止。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[1]+  运行中               ( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'scissors '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> ) &amp;</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># fg %1</span></span><br><span class="line">( <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">'scissors '</span> &gt;&gt; ~/outfile; sleep 1;</span><br><span class="line"><span class="keyword">done</span> )</span><br><span class="line">^C</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># jobs</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>在右窗口中，停止tail命令。关闭多余的终端窗口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie yum.repos.d]<span class="comment"># ps</span></span><br><span class="line">   PID TTY          TIME CMD</span><br><span class="line">  3337 pts/0    00:00:00 bash</span><br><span class="line">  3690 pts/0    00:00:00 tail</span><br><span class="line">  5870 pts/0    00:00:00 ps</span><br><span class="line">[root@zhoulijie yum.repos.d]<span class="comment"># kill 3690</span></span><br><span class="line">[root@zhoulijie yum.repos.d]<span class="comment"># ps</span></span><br><span class="line">   PID TTY          TIME CMD</span><br><span class="line">  5876 pts/0    00:00:00 bash</span><br><span class="line">  5897 pts/0    00:00:00 ps</span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/9.linux--linux进程管理/" data-id="ck7ooyalk003i4su6wznu84g5"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-8.linux--软件管理" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/8.linux--软件管理/"
    >软件管理</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/8.linux--软件管理/" class="article-date">
  <time datetime="2019-08-29T15:44:18.566Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>[TOC]</p>
<h2 id="软件包的途径"><a href="#软件包的途径" class="headerlink" title="软件包的途径"></a>软件包的途径</h2><h2 id="软件包管理的职责"><a href="#软件包管理的职责" class="headerlink" title="软件包管理的职责"></a>软件包管理的职责</h2><ul>
<li>将二进制程序，库文件，配置文件，帮助文件打包成一个文件；</li>
<li>安装软件时按需将二进制文件，库文件，配置文件，帮助文件放到相应的位置；</li>
<li>生成数据库，追踪所安装的每一个文件；</li>
<li>软件卸载时根据安装时生成的数据库将对应的文件删除</li>
</ul>
<h2 id="软件包管理的核心功能"><a href="#软件包管理的核心功能" class="headerlink" title="软件包管理的核心功能"></a>软件包管理的核心功能</h2><ul>
<li>制作软件包</li>
<li>安装软件</li>
<li>卸载软件</li>
<li>升级软件</li>
<li>查询软件</li>
<li>校验软件</li>
</ul>
<h2 id="软件包管理"><a href="#软件包管理" class="headerlink" title="软件包管理"></a>软件包管理</h2><h2 id="软件包分类"><a href="#软件包分类" class="headerlink" title="软件包分类"></a>软件包分类</h2><h2 id="软件包管理工具"><a href="#软件包管理工具" class="headerlink" title="软件包管理工具"></a>软件包管理工具</h2><h2 id="软件安装方式"><a href="#软件安装方式" class="headerlink" title="软件安装方式"></a>软件安装方式</h2><ul>
<li>通过前端工具安装</li>
<li>通过后端工具安装</li>
<li>编译安装</li>
</ul>
<h2 id="rpm包命名规范"><a href="#rpm包命名规范" class="headerlink" title="rpm包命名规范"></a>rpm包命名规范</h2><p><img src="https://s2.ax1x.com/2019/04/23/EErG2q.jpg" alt></p>
<h2 id="rpm包管理"><a href="#rpm包管理" class="headerlink" title="rpm包管理"></a>rpm包管理</h2><h2 id="什么是rpm包及其作用"><a href="#什么是rpm包及其作用" class="headerlink" title="什么是rpm包及其作用"></a>什么是rpm包及其作用</h2><p>rpm是Redhat Package Manager的简称，用于管理软件包。 rpm有一个强大的数据库/var/lib/rpm。 rpm的管理工作包括软件的安装、卸载、升级、查询、校验、重建数据库、验证软件包来源合法性等等。</p>
<h4 id="rpm包安装"><a href="#rpm包安装" class="headerlink" title="rpm包安装"></a>rpm包安装</h4><blockquote>
<p>语法: rpm -ivh /PATH/TO/PACKAGE_FILE …</p>
<p>常用选项：<br>    -i: 安装<br>    -v: 显示详细信息<br>    -h: 显示安装进度条<br>    –test: 测试安装，但不真正执行安装过程<br>    –nodeps: 忽略依赖关系<br>    –replacepkgs: 重新安装，替换原有安装<br>    –oldpackage: 降级<br>    –force: 强行安装，可以实现重装或降级<br>    –nodigest: 不检查包的完整性<br>    –nosignature: 不检查包的来源合法性<br>    –noscripts: 不执行程序包脚本片断<br>        %pre：安装前脚本    –nopre<br>        %post：安装后脚本    –nopost<br>        %preun：卸载前脚本    –nopreun<br>        %postun：卸载后脚本    –nopostun</p>
</blockquote>
<h6 id="安装软件包-需要指定软件包绝对路径"><a href="#安装软件包-需要指定软件包绝对路径" class="headerlink" title="安装软件包, 需要指定软件包绝对路径"></a>安装软件包, 需要指定软件包绝对路径</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># rpm -ivh /mnt/cdrom/Packages/vsftpd-3.0.2-22.el7.x86_64.rpm </span></span><br><span class="line">警告：/mnt/cdrom/Packages/vsftpd-3.0.2-22.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID fd431d51: NOKEY</span><br><span class="line">准备中...                          <span class="comment">################################# [100%]</span></span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:vsftpd-3.0.2-22.el7              <span class="comment">################################# [100%]</span></span><br></pre></td></tr></table></figure>

<h6 id="在软件包所在目录下可以不指定绝对路径"><a href="#在软件包所在目录下可以不指定绝对路径" class="headerlink" title="在软件包所在目录下可以不指定绝对路径"></a>在软件包所在目录下可以不指定绝对路径</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># cd /mnt/cdrom/Packages/</span></span><br><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ivh tree-1.6.0-10.el7.x86_64.rpm </span></span><br><span class="line">警告：tree-1.6.0-10.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID fd431d51: NOKEY</span><br><span class="line">准备中...                          <span class="comment">################################# [100%]</span></span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:tree-1.6.0-10.el7                <span class="comment">################################# [100%]</span></span><br></pre></td></tr></table></figure>

<h6 id="测试一个软件包是否能在该系统上安装"><a href="#测试一个软件包是否能在该系统上安装" class="headerlink" title="测试一个软件包是否能在该系统上安装"></a>测试一个软件包是否能在该系统上安装</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ivh --test vsftpd-3.0.2-22.el7.x86_64.rpm</span></span><br><span class="line">警告：/mnt/cdrom/Packages/vsftpd-3.0.2-22.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID fd431d51: NOKEY</span><br><span class="line">准备中...                          <span class="comment">################################# [100%]</span></span><br><span class="line">	软件包 vsftpd-3.0.2-22.el7.x86_64 已经安装</span><br></pre></td></tr></table></figure>

<h6 id="如果软件包存在-强制再次安装"><a href="#如果软件包存在-强制再次安装" class="headerlink" title="如果软件包存在, 强制再次安装"></a>如果软件包存在, 强制再次安装</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ivh --force vsftpd-3.0.2-22.el7.x86_64.rpm </span></span><br><span class="line">警告：vsftpd-3.0.2-22.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID fd431d51: NOKEY</span><br><span class="line">准备中...                          <span class="comment">################################# [100%]</span></span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:vsftpd-3.0.2-22.el7              <span class="comment">################################# [100%]</span></span><br></pre></td></tr></table></figure>

<h6 id="安装samba服务需要依赖其他组件-使用–nodeps可重新强制安装"><a href="#安装samba服务需要依赖其他组件-使用–nodeps可重新强制安装" class="headerlink" title="安装samba服务需要依赖其他组件, 使用–nodeps可重新强制安装"></a>安装samba服务需要依赖其他组件, 使用–nodeps可重新强制安装</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ivh --nodeps tree-1.6.0-10.el7.x86_64.rpm </span></span><br><span class="line">警告：tree-1.6.0-10.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID fd431d51: NOKEY</span><br><span class="line">准备中...                          <span class="comment">################################# [100%]</span></span><br><span class="line">	软件包 tree-1.6.0-10.el7.x86_64 已经安装</span><br></pre></td></tr></table></figure>

<h4 id="rpm包查询"><a href="#rpm包查询" class="headerlink" title="rpm包查询"></a>rpm包查询</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">rpm -q PACKAGE_NAME                 //查询指定的包是否已安装</span><br><span class="line">rpm -qa                             //查询已经安装的所有包</span><br><span class="line">rpm -qi PACKAGE_NAME                //查询指定包的说明信息</span><br><span class="line">rpm -ql PACKAGE_NAME                //查询指定软件包安装后生成的文件列表</span><br><span class="line">rpm -qf /path/to/somefile           //查询指定的文件是由哪个rpm包安装生成的</span><br><span class="line">rpm -qc PACKAGE_NAME                //查询指定包安装的配置文件</span><br><span class="line">rpm -qd PACKAGE_NAME                //查询指定包安装的帮助文件</span><br><span class="line">rpm -q --scripts PACKAGE_NAME       //查询指定包中包含的脚本</span><br><span class="line">rpm -q --whatprovides CAPABILITY    //查询指定的CAPABILITY（能力）由哪个包所提供</span><br><span class="line">    如：rpm -q --whatprovides /bin/cat</span><br><span class="line">rpm -q --whatrequires CAPABILITY    //查询指定的CAPABILITY被哪个包所依赖</span><br><span class="line">rpm -q --changelog COMMAND          //查询COMMAND的制作日志</span><br><span class="line">rpm -q --scripts PACKAGE_NAME       //查询指定软件包包含的所有脚本文件</span><br><span class="line">rpm -qR PACKAGE_NAME                //查询指定的软件包所依赖的CAPABILITY</span><br><span class="line">rpm -q --provides PACKAGE_NAME      //列出指定软件包所提供的CAPABILITY</span><br><span class="line"></span><br><span class="line">rpm -qpi /PATH/TO/PACKAGE_FILE      //查询指定未安装包的说明信息</span><br><span class="line">rpm -qpl /PATH/TO/PACKAGE_FILE      //查询未安装的软件包会产生哪些文件</span><br></pre></td></tr></table></figure>

<h6 id="查询vsftpd这个rpm包是否安装"><a href="#查询vsftpd这个rpm包是否安装" class="headerlink" title="查询vsftpd这个rpm包是否安装"></a>查询vsftpd这个rpm包是否安装</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -q vsftpd</span></span><br><span class="line">vsftpd-3.0.2-22.el7.x86_64</span><br></pre></td></tr></table></figure>

<h6 id="模糊查找系统已安装的rpm包"><a href="#模糊查找系统已安装的rpm包" class="headerlink" title="模糊查找系统已安装的rpm包"></a>模糊查找系统已安装的rpm包</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qa |grep vsftpd</span></span><br><span class="line">vsftpd-3.0.2-22.el7.x86_64</span><br></pre></td></tr></table></figure>

<h6 id="查询vsftpd软件包的相关信息"><a href="#查询vsftpd软件包的相关信息" class="headerlink" title="查询vsftpd软件包的相关信息"></a>查询vsftpd软件包的相关信息</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qi vsftpd</span></span><br><span class="line">Name        : vsftpd</span><br><span class="line">Version     : 3.0.2</span><br><span class="line">Release     : 22.el7</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: 2019年04月23日 星期二 21时46分42秒</span><br><span class="line">Group       : System Environment/Daemons</span><br><span class="line">Size        : 356220</span><br><span class="line">License     : GPLv2 with exceptions</span><br><span class="line">Signature   : RSA/SHA256, 2017年03月23日 星期四 22时25分48秒, Key ID 199e2f91fd431d51</span><br><span class="line">Source RPM  : vsftpd-3.0.2-22.el7.src.rpm</span><br><span class="line">Build Date  : 2017年03月23日 星期四 22时01分19秒</span><br><span class="line">Build Host  : x86-034.build.eng.bos.redhat.com</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : Red Hat, Inc. &lt;http://bugzilla.redhat.com/bugzilla&gt;</span><br><span class="line">Vendor      : Red Hat, Inc.</span><br><span class="line">URL         : https://security.appspot.com/vsftpd.html</span><br><span class="line">Summary     : Very Secure Ftp Daemon</span><br><span class="line">Description :</span><br><span class="line">vsftpd is a Very Secure FTP daemon. It was written completely from</span><br><span class="line">scratch.</span><br></pre></td></tr></table></figure>

<h6 id="查询rpm包所安装的文件"><a href="#查询rpm包所安装的文件" class="headerlink" title="查询rpm包所安装的文件"></a>查询rpm包所安装的文件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ql vsftpd</span></span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br><span class="line">/etc/vsftpd/vsftpd_conf_migrate.sh</span><br><span class="line">。。。。。。省略以下。。。。。。。。</span><br></pre></td></tr></table></figure>

<h6 id="查询rpm包相关的配置文件"><a href="#查询rpm包相关的配置文件" class="headerlink" title="查询rpm包相关的配置文件"></a>查询rpm包相关的配置文件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qc vsftpd</span></span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure>

<h6 id="查询配置文件或命令来自于哪个rpm包"><a href="#查询配置文件或命令来自于哪个rpm包" class="headerlink" title="查询配置文件或命令来自于哪个rpm包"></a>查询配置文件或命令来自于哪个rpm包</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qf /etc/vsftpd/vsftpd.conf</span></span><br><span class="line">vsftpd-3.0.2-22.el7.x86_64</span><br><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qf /usr/sbin/vsftpd</span></span><br><span class="line">vsftpd-3.0.2-22.el7.x86_64</span><br></pre></td></tr></table></figure>

<h6 id="查询未安装的软件包会产生哪些文件"><a href="#查询未安装的软件包会产生哪些文件" class="headerlink" title="查询未安装的软件包会产生哪些文件"></a>查询未安装的软件包会产生哪些文件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qlp vsftpd-3.0.2-22.el7.x86_64.rpm </span></span><br><span class="line">警告：vsftpd-3.0.2-22.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID fd431d51: NOKEY</span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br><span class="line">/etc/vsftpd/vsftpd_conf_migrate.sh</span><br><span class="line">/usr/lib/systemd/system-generators/vsftpd-generator</span><br><span class="line">。。。。。。省略以下。。。。。。。。</span><br></pre></td></tr></table></figure>

<h6 id="查询未安装的软件说明信息"><a href="#查询未安装的软件说明信息" class="headerlink" title="查询未安装的软件说明信息"></a>查询未安装的软件说明信息</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qip vsftpd-3.0.2-22.el7.x86_64.rpm </span></span><br><span class="line">警告：vsftpd-3.0.2-22.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID fd431d51: NOKEY</span><br><span class="line">Name        : vsftpd</span><br><span class="line">Version     : 3.0.2</span><br><span class="line">Release     : 22.el7</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: (not installed)</span><br><span class="line">Group       : System Environment/Daemons</span><br><span class="line">Size        : 356220</span><br><span class="line">License     : GPLv2 with exceptions</span><br><span class="line">Signature   : RSA/SHA256, 2017年03月23日 星期四 22时25分48秒, Key ID 199e2f91fd431d51</span><br><span class="line">Source RPM  : vsftpd-3.0.2-22.el7.src.rpm</span><br><span class="line">Build Date  : 2017年03月23日 星期四 22时01分19秒</span><br><span class="line">Build Host  : x86-034.build.eng.bos.redhat.com</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : Red Hat, Inc. &lt;http://bugzilla.redhat.com/bugzilla&gt;</span><br><span class="line">Vendor      : Red Hat, Inc.</span><br><span class="line">URL         : https://security.appspot.com/vsftpd.html</span><br><span class="line">Summary     : Very Secure Ftp Daemon</span><br><span class="line">Description :</span><br><span class="line">vsftpd is a Very Secure FTP daemon. It was written completely from</span><br><span class="line">scratch.</span><br></pre></td></tr></table></figure>

<h4 id="rpm包升级"><a href="#rpm包升级" class="headerlink" title="rpm包升级"></a>rpm包升级</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh /PATH/TO/NEW_PACKAGE_FILE  //如果装有老版本的，则升级；否则，则安装</span><br><span class="line">rpm -Fvh /PATH/TO/NEW_PACKAGE_FILE  //如果装有老版本的，则升级；否则，退出</span><br><span class="line">    --oldpackage：降级</span><br><span class="line">    </span><br><span class="line">[root@zhoulijie Packages]# rpm -Uvh vsftpd-3.0.2-22.el7.x86_64.rpm </span><br><span class="line">警告：vsftpd-3.0.2-22.el7.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID fd431d51: NOKEY</span><br><span class="line">准备中...                          ################################# [100%]</span><br><span class="line">	软件包 vsftpd-3.0.2-22.el7.x86_64 已经安装</span><br></pre></td></tr></table></figure>

<h4 id="rpm包卸载"><a href="#rpm包卸载" class="headerlink" title="rpm包卸载"></a>rpm包卸载</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//语法：rpm -e PACKAGE_NAME</span><br><span class="line"></span><br><span class="line">//先查询, 然后卸载 </span><br><span class="line">[root@zhoulijie Packages]# rpm -qa | grep vsftpd</span><br><span class="line">vsftpd-3.0.2-22.el7.x86_64</span><br><span class="line">[root@zhoulijie Packages]# rpm -e vsftpd</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>如果其他包依赖于要卸载的包，这个被依赖的包是无法卸载的，除非强制卸载，强制卸载后依赖于这个包的其他程序将无法正常工作</p>
<h4 id="rpm包校验"><a href="#rpm包校验" class="headerlink" title="rpm包校验"></a>rpm包校验</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 如果执行以下命令无内容输出说明此包未被修改过</span><br><span class="line">[root@localhost ~]# rpm -V vsftpd</span><br><span class="line">S.5....T.  c /etc/pam.d/vsftpd</span><br><span class="line">.......T.  c /etc/vsftpd/ftpusers</span><br><span class="line">S.5....T.  c /etc/vsftpd/vsftpd.conf</span><br><span class="line">.M.......    /var/ftp/pub</span><br><span class="line"></span><br><span class="line">S   //文件的容量大小是否被改变</span><br><span class="line">M   //文件的类型或者文件的属性是否被修改</span><br><span class="line">5   //MD5这一种指纹加密的内容已经不同</span><br><span class="line">D   //装置的主/次代码已经改变</span><br><span class="line">L   //路径已经被改变</span><br><span class="line">U   //文件的所属主已被修改</span><br><span class="line">G   //文件的所属组已被修改</span><br><span class="line">T   //文件的创建时间已被改变</span><br></pre></td></tr></table></figure>

<h4 id="rpm重建数据库"><a href="#rpm重建数据库" class="headerlink" title="rpm重建数据库"></a>rpm重建数据库</h4><p>数据库信息在/var/lib/rpm目录中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm --rebuilddb     //重建数据库，一定会重新建立</span><br><span class="line">rpm --initdb        //初始化数据库，没有才建立，有就不用建立</span><br></pre></td></tr></table></figure>

<h4 id="检察软件包来源合法性和完整性"><a href="#检察软件包来源合法性和完整性" class="headerlink" title="检察软件包来源合法性和完整性"></a>检察软件包来源合法性和完整性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">加密类型：</span><br><span class="line">    对称加密    //加密解密使用同一个密钥</span><br><span class="line">    公钥加密    //一对密钥，公钥和私钥。公钥隐含于私钥中，可以提取出来并公布出去</span><br><span class="line">    单向加密    //只能加密不能解密</span><br><span class="line">    </span><br><span class="line">/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release     //红帽官方公钥</span><br><span class="line"></span><br><span class="line">rpm -K PACKAGE_FILE     //检查指定包有无密钥信息</span><br><span class="line">    dsa，gpg            //验证来源合法性，也即验证签名。可以使用--nosignatrue略过此项</span><br><span class="line">    sha1，md5           //验证软件包完整性。可以使用--nodigest略过此项</span><br><span class="line">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release    //导入密钥文件</span><br><span class="line">    CentOS 7发行版光盘提供的密钥文件    //RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>如何查询 util-linux 软件包安装了哪些文件？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ql util-linux</span></span><br></pre></td></tr></table></figure>

<p>如何查询 mkdir 命令是由哪个 RPM 软件包安装的？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qf /usr/bin/mkdir</span></span><br></pre></td></tr></table></figure>

<p>升级软件包时，-F、-U选项有何区别？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh 如果装有老版本的，则升级；否则，则安装</span><br><span class="line">rpm -Fvh 如果装有老版本的，则升级；否则，退出</span><br></pre></td></tr></table></figure>

<p>如何检查vsftpd软件包是否安装?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -q vsftpd</span></span><br></pre></td></tr></table></figure>

<p>如何检查vsftpd软件包所有的文件存放目录?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ql vsftpd</span></span><br></pre></td></tr></table></figure>

<p>如何检查vsftpd软件包的配置文件?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -qc vsftpd</span></span><br></pre></td></tr></table></figure>

<p>如何使用rpm安装vsftpd服务?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ivh vsftpd-3.0.2-22.el7.x86_64.rpm</span></span><br></pre></td></tr></table></figure>

<p>如何使用rpm强制安装依赖包?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -ivh --force vsftpd-3.0.2-22.el7.x86_64.rpm</span></span><br></pre></td></tr></table></figure>

<p>如何使用rpm卸载vsftpd软件包?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie Packages]<span class="comment"># rpm -e vsftpd</span></span><br></pre></td></tr></table></figure>

<p>将本章学习到的rpm命令整理成一个列表，写明每个命令的作用</p>
<table>
<thead>
<tr>
<th align="center">安装软件的命令格式</th>
<th align="center">rpm -ivh RPM安装包</th>
</tr>
</thead>
<tbody><tr>
<td align="center">升级软件的命令格式</td>
<td align="center">rpm -Uvh  RPM安装包</td>
</tr>
<tr>
<td align="center">卸载软件的命令格式</td>
<td align="center">rpm -e  RPM安装包</td>
</tr>
<tr>
<td align="center">查询软件描述信息的命令格式</td>
<td align="center">rpm -qpi  RPM安装包</td>
</tr>
<tr>
<td align="center">列出软件文件信息的命令格式</td>
<td align="center">rpm -qpl  RPM安装包</td>
</tr>
<tr>
<td align="center">查询文件属于哪个RPM的命令格式</td>
<td align="center">rpm -qf  RPM安装包</td>
</tr>
</tbody></table>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/8.linux--软件管理/" data-id="ck7ooyaif002f4su6y716pblc"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-7.linux--用户和组管理" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/7.linux--用户和组管理/"
    >用户和组管理</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/7.linux--用户和组管理/" class="article-date">
  <time datetime="2019-08-29T15:44:18.557Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="用户和组管理"><a href="#用户和组管理" class="headerlink" title="用户和组管理"></a>用户和组管理</h1><p>[TOC]</p>
<h2 id="何为用户何为组？"><a href="#何为用户何为组？" class="headerlink" title="何为用户何为组？"></a>何为用户何为组？</h2><h4 id="用户和组的概念"><a href="#用户和组的概念" class="headerlink" title="用户和组的概念"></a>用户和组的概念</h4><p>例如：小明和他的家人</p>
<p>小明就是用户，他的家就是这个组，他的家人就是这个组里面的组员</p>
<p>*<em>用户存在的目的是为了实现资源的分派。 *</em></p>
<p>小明在家里有知识，可以教给小明的爸爸妈妈，小明的妈妈会做饭，可以做的饭给小明和小明爸爸吃，小明的爸爸有钱，可以给小明和小明妈妈花。</p>
<h4 id="用户分类"><a href="#用户分类" class="headerlink" title="用户分类"></a>用户分类</h4><p>Linux用户分为管理员和普通用户两种：</p>
<table>
<thead>
<tr>
<th align="center">用户类别</th>
<th align="center">用户ID</th>
</tr>
</thead>
<tbody><tr>
<td align="center">管理员</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">普通用户</td>
<td align="center">1-65535</td>
</tr>
</tbody></table>
<p>其中普通用户又分为系统用户和登录用户两种： </p>
<table>
<thead>
<tr>
<th align="center">用户类别</th>
<th align="center">用户ID</th>
</tr>
</thead>
<tbody><tr>
<td align="center">系通用户</td>
<td align="center">1-999（为 守护类进程获取系统资源而完成权限指派的用户 ）</td>
</tr>
<tr>
<td align="center">登陆用户</td>
<td align="center">1000-60000（为了完成交互式登录使用的用户）</td>
</tr>
</tbody></table>
<h4 id="Linux安全上下文"><a href="#Linux安全上下文" class="headerlink" title="Linux安全上下文"></a>Linux安全上下文</h4><blockquote>
<p> 运行中的程序：进程</p>
<p>以进程发起者的身份运行</p>
<p>进程所能够访问的所有资源的权限取决于进程的发起者的身份</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先我们打开两个终端</span></span><br><span class="line"><span class="comment"># 在第一个终端里输入</span></span><br><span class="line">[root@MR ~]<span class="comment"># cd /tmp</span></span><br><span class="line">[root@MR tmp]<span class="comment"># ls</span></span><br><span class="line">shadow</span><br><span class="line">[root@MR tmp]<span class="comment"># touch 123</span></span><br><span class="line">[root@MR tmp]<span class="comment"># ls -l</span></span><br><span class="line">总用量 4</span><br><span class="line">-rw-r--r--. 1 root root   0 3月  27 07:37 123</span><br><span class="line">----------. 1 root root 608 3月   8 15:48 shadow</span><br><span class="line"><span class="comment"># 在这里我们可以看到root是可读可写的权限</span></span><br><span class="line"><span class="comment"># 在第二个终端里输入</span></span><br><span class="line">[root@MR ~]<span class="comment"># su - zhou</span></span><br><span class="line">上一次登录：三 3月 27 04:27:47 CST 2019pts/1 上</span><br><span class="line">[zhou@MR ~]$ <span class="built_in">cd</span> /tmp</span><br><span class="line">[zhou@MR tmp]$ ls -l</span><br><span class="line">总用量 4</span><br><span class="line">-rw-r--r--. 1 root root   0 3月  27 07:37 123</span><br><span class="line">----------. 1 root root 608 3月   8 15:48 shadow</span><br><span class="line">[zhou@MR tmp]$ vim 123</span><br><span class="line">~</span><br><span class="line"><span class="string">"123"</span> [只读] 0L, 0C                                           0,0-1        全部</span><br><span class="line"><span class="comment"># 然后我们在第一个终端里输入</span></span><br><span class="line">[root@MR tmp]<span class="comment"># ps aux | grep vim</span></span><br><span class="line">zhou       4946  0.1  0.2 151916  5004 pts/0    S+   07:40   0:00 vim 123</span><br><span class="line">root       4948  0.0  0.0 112656   992 pts/2    R+   07:40   0:00 grep --color=auto vim</span><br><span class="line"><span class="comment"># 在这里我们可以看到 vim 123 是由zhou用户发起的进程</span></span><br><span class="line"><span class="comment"># 但是我们子啊第二步骤里面可以看到这个文件只是一个只读文件</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Linux通过安全上下文的概念完成用户权限的指派。</p>
<p>先判断用户是否是某文件的属主</p>
<p>再判断用户是否属于某个组</p>
<p>最后定其为其他用户</p>
</blockquote>
<h4 id="Linux用户组类别"><a href="#Linux用户组类别" class="headerlink" title="Linux用户组类别"></a>Linux用户组类别</h4><table>
<thead>
<tr>
<th align="center">用户组类别</th>
<th align="center">特征</th>
</tr>
</thead>
<tbody><tr>
<td align="center">私有组</td>
<td align="center">创建用户时，如果没有为其指定所属的组， 系统会自动为其创建一个与用户名相同的组</td>
</tr>
<tr>
<td align="center">基本组</td>
<td align="center">用户的默认组</td>
</tr>
<tr>
<td align="center">附加组(额外组)</td>
<td align="center">默认组以外的其它组</td>
</tr>
</tbody></table>
<h2 id="Linux-用户和组相关的配置文件"><a href="#Linux-用户和组相关的配置文件" class="headerlink" title="Linux 用户和组相关的配置文件"></a>Linux 用户和组相关的配置文件</h2><h4 id="各配置文件的说明"><a href="#各配置文件的说明" class="headerlink" title="各配置文件的说明"></a>各配置文件的说明</h4><table>
<thead>
<tr>
<th align="center">配置文件</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">/etc/passwd</td>
<td align="center">用户及其属性信息（名称、uid、基本组id等等）</td>
</tr>
<tr>
<td align="center">/etc/group</td>
<td align="center">组及其属性信息</td>
</tr>
<tr>
<td align="center">/etc/shadow</td>
<td align="center">用户密码及其相关属性</td>
</tr>
<tr>
<td align="center">/etc/gshadow</td>
<td align="center">组密码及其相关属性。在用户执行基本组切换时使用</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># tail -n5 /etc/passwd</span></span><br><span class="line">postfix:x:89:89::/var/spool/postfix:/sbin/nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line">zhou:x:1000:1000::/home/zhou:/bin/bash</span><br><span class="line">wangqing:x:1001:1003:wu liang tian zun:/opt/123:/bin/csh</span><br><span class="line">openstack:x:1002:1005::/home/openstack:/bin/bash</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># tail -n5 /etc/group</span></span><br><span class="line">taoist:x:1001:wangqing</span><br><span class="line">tianzun:x:1002:wangqing</span><br><span class="line">wangqing:x:1003:</span><br><span class="line">123:x:1004:</span><br><span class="line">openstack:x:1005:</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>配置文件</th>
<th align="center">/etc/passwd</th>
<th align="center">/etc/group</th>
</tr>
</thead>
<tbody><tr>
<td>第一字段</td>
<td align="center">用户名</td>
<td align="center">组名</td>
</tr>
<tr>
<td>第二字段</td>
<td align="center">密码占位符号</td>
<td align="center">组名</td>
</tr>
<tr>
<td>第三字段</td>
<td align="center">UID</td>
<td align="center">组密码</td>
</tr>
<tr>
<td>第四字段</td>
<td align="center">GID</td>
<td align="center">GID</td>
</tr>
<tr>
<td>第五字段</td>
<td align="center">用户的描述信息</td>
<td align="center">以当前组为附加组的用户列表(分隔符为逗号)</td>
</tr>
<tr>
<td>第六字段</td>
<td align="center">用户家目录</td>
<td align="center"></td>
</tr>
<tr>
<td>第七字段</td>
<td align="center">用户的登录shell</td>
<td align="center"></td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># tail -n5 /etc/shadow</span></span><br><span class="line">postfix:!!:17961::::::</span><br><span class="line">sshd:!!:17961::::::</span><br><span class="line">zhou:!!:17981:0:99999:7:::</span><br><span class="line">wangqing:!!:17981:0:99999:3::17986:</span><br><span class="line">openstack:!!:17981:0:99999:7:::</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># tail -n5 /etc/gshadow</span></span><br><span class="line">taoist:!::wangqing</span><br><span class="line">tianzun:!::</span><br><span class="line">wangqing:!::</span><br><span class="line">123:<span class="variable">$6</span><span class="variable">$f3I23</span>/woA<span class="variable">$DV6eA</span>/Qc0KsZkbwOo1uqC3YRx30riDKd/ZOtrEulPnct2knx4gBakc8rFYwnCOXFKaG4H7Cdf1alzK/V6fpTl/::</span><br><span class="line">openstack:!::</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">配置文件</th>
<th align="center">/etc/shadow</th>
</tr>
</thead>
<tbody><tr>
<td align="center">第一字段</td>
<td align="center">登录名</td>
</tr>
<tr>
<td align="center">第二字段</td>
<td align="center">加密后的密码</td>
</tr>
<tr>
<td align="center">第三字段</td>
<td align="center">最近一次更改密码的日期</td>
</tr>
<tr>
<td align="center">第四字段</td>
<td align="center">密码的最小使用期限</td>
</tr>
<tr>
<td align="center">第五字段</td>
<td align="center">密码的最大使用期限</td>
</tr>
<tr>
<td align="center">第六字段</td>
<td align="center">密码警告时间段</td>
</tr>
<tr>
<td align="center">第七字段</td>
<td align="center">密码禁用期</td>
</tr>
<tr>
<td align="center">第八字段</td>
<td align="center">帐号的过期日期</td>
</tr>
<tr>
<td align="center">第九字段</td>
<td align="center">保留字段</td>
</tr>
</tbody></table>
<blockquote>
<p> 以上配置文件均可用vim 进行改动</p>
</blockquote>
<h4 id="加密方法"><a href="#加密方法" class="headerlink" title="加密方法"></a>加密方法</h4><ul>
<li>对称加密：加密和解密使用同一个密钥 </li>
<li>公钥加密：每个密码都成对出现，一个为私钥（secret key），一个为公钥（public key）</li>
<li>单向加密：也叫散列加密，提取数据特征码，能加密不能解密，常用于做数据完整性校验 </li>
</ul>
<p>单向加密的特点：</p>
<ul>
<li><p>雪崩效应（初始条件的微小改变，将会引起结果的巨大改变）</p>
</li>
<li><p>定长输出 </p>
<p>​    1.MD5：128位定长输出</p>
<p>​    2.SHA1：160位定长输出</p>
<p>​    3.SHA224：224位定长输出</p>
<p>​    4.SHA256：256位定长输出</p>
<p>​    5.SHA384：384位定长输出</p>
<p>​    6.SHA512：512位定长输出</p>
</li>
</ul>
<blockquote>
<p>一般我们只用MD5进行加密</p>
</blockquote>
<h4 id="Linux用户密码加密方式"><a href="#Linux用户密码加密方式" class="headerlink" title="Linux用户密码加密方式"></a>Linux用户密码加密方式</h4><blockquote>
<p> Linux密码是使用的单向加密方式进行加密 </p>
<p>意思是每个密码都不一样，在加密前给用户设置的密码加上一点杂质，再对这个杂质+用户密码一起使用单向加密。由于单向加密的雪崩效应，就算两人设置的密码是一样的，但因为杂质的不同，最终的结果也会截然不同</p>
</blockquote>
<p>密码复杂性策略：</p>
<ul>
<li>使用数字、大写字母、小写字母及特殊字符中至少3种</li>
<li>足够长</li>
<li>使用随机密码，不要使用有意义的单词或数字</li>
<li>定期更换，不要使用最近曾经使用过的密码</li>
</ul>
<h2 id="用户和组相关的命令"><a href="#用户和组相关的命令" class="headerlink" title="用户和组相关的命令"></a>用户和组相关的命令</h2><h4 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h4><h6 id="用户创建命令useradd"><a href="#用户创建命令useradd" class="headerlink" title="用户创建命令useradd"></a>用户创建命令useradd</h6><p>-u 指定uid</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># cd</span></span><br><span class="line">[root@MR ~]<span class="comment"># useradd -u 8888 yue</span></span><br><span class="line">[root@MR ~]<span class="comment"># id yue</span></span><br><span class="line">uid=8888(yue) gid=8888(yue) 组=8888(yue)</span><br></pre></td></tr></table></figure>

<p>-g 指定gid</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@MR home]<span class="comment"># tail -n5 /etc/group</span></span><br><span class="line">taoist:x:1001:wangqing</span><br><span class="line">tianzun:x:1002:wangqing</span><br><span class="line">wangqing:x:1003:</span><br><span class="line">123:x:1004:</span><br><span class="line">openstack:x:1005:</span><br><span class="line">[root@MR home]<span class="comment"># useradd -g tianzun yue</span></span><br><span class="line">[root@MR home]<span class="comment"># id yue</span></span><br><span class="line">uid=1003(yue) gid=1002(tianzun) 组=1002(tianzun)</span><br></pre></td></tr></table></figure>

<p>-G 指定附加组，组与组之间用逗号隔开，记住附加组必须存在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@MR home]<span class="comment"># tail -n5 /etc/group</span></span><br><span class="line">taoist:x:1001:wangqing</span><br><span class="line">tianzun:x:1002:wangqing</span><br><span class="line">wangqing:x:1003:</span><br><span class="line">123:x:1004:</span><br><span class="line">openstack:x:1005:</span><br><span class="line">[root@MR home]<span class="comment"># useradd -G tianzun,taoist yue</span></span><br><span class="line">[root@MR home]<span class="comment"># id yue</span></span><br><span class="line">uid=1003(yue) gid=1006(yue) 组=1006(yue),1001(taoist),1002(tianzun)</span><br></pre></td></tr></table></figure>

<p>-c 添加注释信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@MR home]<span class="comment"># useradd -c"hahahahahaha" yue</span></span><br><span class="line">[root@MR home]<span class="comment"># tail -n5 /etc/passwd</span></span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line">zhou:x:1000:1000::/home/zhou:/bin/bash</span><br><span class="line">wangqing:x:1001:1003:wu liang tian zun:/opt/123:/bin/csh</span><br><span class="line">openstack:x:1002:1005::/home/openstack:/bin/bash</span><br><span class="line">yue:x:1003:1006:hahahahahaha:/home/yue:/bin/bash</span><br></pre></td></tr></table></figure>

<p>-d 指定用户的家目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@MR home]<span class="comment"># cd /tmp</span></span><br><span class="line">[root@MR tmp]<span class="comment"># ls</span></span><br><span class="line">123  shadow</span><br><span class="line">[root@MR tmp]<span class="comment"># mkdir abc</span></span><br><span class="line">[root@MR tmp]<span class="comment"># useradd -d /tmp/abc yue</span></span><br><span class="line">useradd：警告：此主目录已经存在。</span><br><span class="line">不从 skel 目录里向其中复制任何文件。</span><br></pre></td></tr></table></figure>

<p>-s 指定shell，但这个shell必须在/etc/shells里面存在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># useradd -s /sbin/nologin yue</span></span><br><span class="line">[root@MR tmp]<span class="comment"># tail -n5 /etc/passwd</span></span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line">zhou:x:1000:1000::/home/zhou:/bin/bash</span><br><span class="line">wangqing:x:1001:1003:wu liang tian zun:/opt/123:/bin/csh</span><br><span class="line">openstack:x:1002:1005::/home/openstack:/bin/bash</span><br><span class="line">yue:x:1003:1006::/home/yue:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>-M 创建用户时不给其创建家目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># useradd -M yue</span></span><br><span class="line">[root@MR /]<span class="comment"># ls /home</span></span><br><span class="line">openstack  wangqing  zhou</span><br></pre></td></tr></table></figure>

<h6 id="用户删除命令userdel"><a href="#用户删除命令userdel" class="headerlink" title="用户删除命令userdel"></a>用户删除命令userdel</h6><p>-r 删除用户的同时删除其家目录（userdel默认不会删除其家目录）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@MR /]<span class="comment"># useradd yue</span></span><br><span class="line">[root@MR /]<span class="comment"># ls /home</span></span><br><span class="line">openstack  wangqing  yue  zhou</span><br><span class="line">[root@MR /]<span class="comment"># userdel -r yue</span></span><br><span class="line">[root@MR /]<span class="comment"># ls /home</span></span><br><span class="line">openstack  wangqing  zhou</span><br></pre></td></tr></table></figure>

<h6 id="查看用户账号的信息命令id"><a href="#查看用户账号的信息命令id" class="headerlink" title="查看用户账号的信息命令id"></a>查看用户账号的信息命令id</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@MR /]<span class="comment"># id zhou</span></span><br><span class="line">uid=1000(zhou) gid=1000(zhou) 组=1000(zhou),0(root)</span><br></pre></td></tr></table></figure>

<h6 id="修改用户账号属性的命令usermod"><a href="#修改用户账号属性的命令usermod" class="headerlink" title="修改用户账号属性的命令usermod"></a>修改用户账号属性的命令usermod</h6><p>-u 修改uid</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@MR /]<span class="comment"># id yue</span></span><br><span class="line">uid=1003(yue) gid=1006(yue) 组=1006(yue)</span><br><span class="line">[root@MR /]<span class="comment"># usermod -u 8888 yue</span></span><br><span class="line">[root@MR /]<span class="comment"># id yue</span></span><br><span class="line">uid=8888(yue) gid=1006(yue) 组=1006(yue)</span><br></pre></td></tr></table></figure>

<p>-g 修改gid</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@MR /]<span class="comment"># id yue</span></span><br><span class="line">uid=8888(yue) gid=1006(yue) 组=1006(yue)</span><br><span class="line">[root@MR /]<span class="comment"># groupadd -g 7777 hah</span></span><br><span class="line">[root@MR /]<span class="comment"># usermod -g 7777 yue</span></span><br><span class="line">[root@MR /]<span class="comment"># id yue</span></span><br><span class="line">uid=8888(yue) gid=7777(hah) 组=7777(hah)</span><br></pre></td></tr></table></figure>

<p>-a -G  不使用-a选项，会覆盖此前的附加组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@MR /]<span class="comment"># id yue</span></span><br><span class="line">uid=8888(yue) gid=7777(hah) 组=7777(hah)</span><br><span class="line">[root@MR /]<span class="comment"># usermod -a -G yue yue</span></span><br><span class="line">[root@MR /]<span class="comment"># id yue</span></span><br><span class="line">uid=8888(yue) gid=7777(hah) 组=7777(hah),1006(yue)</span><br></pre></td></tr></table></figure>

<p>-d -m  改变用户家目录的同时把原来家目录的文件移动到新的家目录中</p>
<blockquote>
<p>切记-d在-m后面</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@MR /]<span class="comment"># ls /home</span></span><br><span class="line">openstack  wangqing  yue  zhou</span><br><span class="line">[root@MR /]<span class="comment"># cd /home/yue</span></span><br><span class="line">[root@MR yue]<span class="comment"># touch 123</span></span><br><span class="line">[root@MR yue]<span class="comment"># ls</span></span><br><span class="line">123</span><br><span class="line">[root@MR yue]<span class="comment"># cd /tmp</span></span><br><span class="line">[root@MR tmp]<span class="comment"># ls</span></span><br><span class="line">abc  shadow</span><br><span class="line">[root@MR tmp]<span class="comment"># mkdir qqq</span></span><br><span class="line">[root@MR tmp]<span class="comment"># ls</span></span><br><span class="line">abc  qqq  shadow</span><br><span class="line">[root@MR tmp]<span class="comment"># usermod -md /tmp/qqq yue</span></span><br><span class="line">usermod：目录 /tmp/qqq 不存在</span><br><span class="line">[root@MR tmp]<span class="comment"># tail -n5 /etc/passwd</span></span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line">zhou:x:1000:1000::/home/zhou:/bin/bash</span><br><span class="line">wangqing:x:1001:1003:wu liang tian zun:/opt/123:/bin/csh</span><br><span class="line">openstack:x:1002:1005::/home/openstack:/bin/bash</span><br><span class="line">yue:x:1003:1006::/tmp/qqq:/bin/bash</span><br></pre></td></tr></table></figure>

<h6 id="切换用户命令su"><a href="#切换用户命令su" class="headerlink" title="切换用户命令su"></a>切换用户命令su</h6><table>
<thead>
<tr>
<th>切换用户的方式</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>su USERNAME</td>
<td>非登录式切换，即不会读取目标用户的配置文件</td>
</tr>
<tr>
<td>su - USERNAME</td>
<td>登录式切换，即会读取目标用户的配置文件。完全切换</td>
</tr>
<tr>
<td>su -</td>
<td>不指定用户时默认切换至root用户</td>
</tr>
</tbody></table>
<blockquote>
<p>root su至其他用户不需要密码，非root用户su至其他用户时需要输入目标用户的密码 </p>
</blockquote>
<p>bash的配置文件:</p>
<table>
<thead>
<tr>
<th align="center">配置文件类型</th>
<th align="center">配置文件路径</th>
</tr>
</thead>
<tbody><tr>
<td align="center">全局配置</td>
<td align="center">/etc/profile /etc/profile.d/*.sh /etc/bashrc</td>
</tr>
<tr>
<td align="center">个人配置</td>
<td align="center">~/.bash_profile ～/.bashrc</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">配置文件类型</th>
<th align="center">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">profile类</td>
<td align="center">为交互式登录的shell提供配置，用来设定环境变量、运行命令或脚本</td>
</tr>
<tr>
<td align="center">bashrc类</td>
<td align="center">为非交互式登录的shell提供配置，用来设定本地变量、定义命令别名</td>
</tr>
</tbody></table>
<p>登录式shell如何读取配置文件</p>
<blockquote>
<p> /etc/profile –&gt; /etc/profile.d/*.sh –&gt; ~/.bash_profile –&gt; ~/.bashrc –&gt; /etc/bashrc</p>
</blockquote>
<p>非登录式shell如何读取配置文件</p>
<blockquote>
<p>~/.bashrc –&gt; /etc/bashrc –&gt; /etc/profile.d/*.sh</p>
</blockquote>
<h4 id="密码管理"><a href="#密码管理" class="headerlink" title="密码管理"></a>密码管理</h4><h6 id="密码管理命令passwd"><a href="#密码管理命令passwd" class="headerlink" title="密码管理命令passwd"></a>密码管理命令passwd</h6><p>–stdin 从标准输入获取用户密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@MR qqq]<span class="comment"># useradd yue</span></span><br><span class="line">[root@MR qqq]<span class="comment"># echo "123456" | passwd --stdin yue</span></span><br><span class="line">更改用户 yue 的密码 。</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br></pre></td></tr></table></figure>

<h6 id="改变用户密码过期信息命令chage"><a href="#改变用户密码过期信息命令chage" class="headerlink" title="改变用户密码过期信息命令chage"></a>改变用户密码过期信息命令chage</h6><p>-E 过期时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># chage -E 2019-05-31 yue</span></span><br><span class="line">[root@MR ~]<span class="comment"># tail -n5 /etc/shadow</span></span><br><span class="line">sshd:!!:17961::::::</span><br><span class="line">zhou:!!:17981:0:99999:7:::</span><br><span class="line">wangqing:!!:17981:0:99999:3::17986:</span><br><span class="line">openstack:!!:17981:0:99999:7:::</span><br><span class="line">yue:<span class="variable">$6</span><span class="variable">$BRQKiE3H</span><span class="variable">$Ns7arFcpyOipUDWQ9CzJJlxvodMKEDN9iGfSYxo1V0PsW7OF5DU7cFpdCAi8EbyPv7KoVl1</span>.PXnSUatlRU2jN/:17982:0:99999:7::18047:</span><br><span class="line"><span class="comment"># 此时间代表从1970年1月1日开始的多少天</span></span><br></pre></td></tr></table></figure>

<p>-w 警告时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认提前7天警告</span></span><br><span class="line">[root@MR ~]<span class="comment"># chage -W 3 yue</span></span><br><span class="line">[root@MR ~]<span class="comment"># tail -n5 /etc/shadow</span></span><br><span class="line">sshd:!!:17961::::::</span><br><span class="line">zhou:!!:17981:0:99999:7:::</span><br><span class="line">wangqing:!!:17981:0:99999:3::17986:</span><br><span class="line">openstack:!!:17981:0:99999:7:::</span><br><span class="line">yue:<span class="variable">$6</span><span class="variable">$BRQKiE3H</span><span class="variable">$Ns7arFcpyOipUDWQ9CzJJlxvodMKEDN9iGfSYxo1V0PsW7OF5DU7cFpdCAi8EbyPv7KoVl1</span>.PXnSUatlRU2jN/:17982:0:99999:3::18047:</span><br></pre></td></tr></table></figure>

<h6 id="密码生成工具openssl"><a href="#密码生成工具openssl" class="headerlink" title="密码生成工具openssl"></a>密码生成工具openssl</h6><p>version  查看程序版本号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># openssl version</span></span><br><span class="line">OpenSSL 1.0.1e-fips 11 Feb 2013</span><br></pre></td></tr></table></figure>

<p> dgst   提取特征码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># openssl dgst -md5 /home/yue</span></span><br><span class="line">Read Error <span class="keyword">in</span> /home/yue</span><br><span class="line">139969262737312:error:0200B015:system library:fread:Is a directory:bss_file.c:24                                5:</span><br><span class="line">139969262737312:error:20082002:BIO routines:FILE_READ:system lib:bss_file.c:246:</span><br></pre></td></tr></table></figure>

<p> passwd   生成密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># openssl passwd -1 -salt hello</span></span><br><span class="line">Password:</span><br><span class="line"><span class="variable">$1</span><span class="variable">$hello</span><span class="variable">$bs8EXZ2u6YMHz8lF7E05u0</span></span><br></pre></td></tr></table></figure>

<p>  rand    生成伪随机数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># openssl rand -base64 30</span></span><br><span class="line">J7oxn34FkHcdxdTvmtsyf3VCUaZf/SU8I5jprwMS</span><br></pre></td></tr></table></figure>

<h4 id="组管理"><a href="#组管理" class="headerlink" title="组管理"></a>组管理</h4><h6 id="创建组命令groupadd"><a href="#创建组命令groupadd" class="headerlink" title="创建组命令groupadd"></a>创建组命令groupadd</h6><p>-g 指定GID</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># groupadd -g 6666 natasha</span></span><br><span class="line">[root@MR ~]<span class="comment"># tail -n5 /etc/group</span></span><br><span class="line">123:x:1004:</span><br><span class="line">openstack:x:1005:</span><br><span class="line">hah:x:7777:</span><br><span class="line">yue:x:7778:</span><br><span class="line">natasha:x:6666:</span><br></pre></td></tr></table></figure>

<h6 id="修改组命令groupmod"><a href="#修改组命令groupmod" class="headerlink" title="修改组命令groupmod"></a>修改组命令groupmod</h6><p>-g 修改gid</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># groupmod -g 4444 natasha</span></span><br><span class="line">[root@MR ~]<span class="comment"># tail -n5 /etc/group</span></span><br><span class="line">123:x:1004:</span><br><span class="line">openstack:x:1005:</span><br><span class="line">hah:x:7777:</span><br><span class="line">yue:x:7778:</span><br><span class="line">natasha:x:4444:</span><br></pre></td></tr></table></figure>

<p>-n 修改组名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># groupmod -n hahahaha natasha</span></span><br><span class="line">[root@MR ~]<span class="comment"># tail -n5 /etc/group</span></span><br><span class="line">123:x:1004:</span><br><span class="line">openstack:x:1005:</span><br><span class="line">hah:x:7777:</span><br><span class="line">yue:x:7778:</span><br><span class="line">hahahaha:x:4444:</span><br></pre></td></tr></table></figure>

<h6 id="删除组命令groupdel"><a href="#删除组命令groupdel" class="headerlink" title="删除组命令groupdel"></a>删除组命令groupdel</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># groupdel hahahaha</span></span><br><span class="line">[root@MR ~]<span class="comment"># tail -n5 /etc/group</span></span><br><span class="line">wangqing:x:1003:</span><br><span class="line">123:x:1004:</span><br><span class="line">openstack:x:1005:</span><br><span class="line">hah:x:7777:</span><br><span class="line">yue:x:7778:</span><br></pre></td></tr></table></figure>

<p>给组设定密码命令gpasswd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># gpasswd hahahaha</span></span><br><span class="line">正在修改 hahahaha 组的密码</span><br><span class="line">新密码：</span><br><span class="line">请重新输入新密码：</span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>1.创建用户wangqing，附加组为taoist和tianzun，默认shell为/bin/csh，注释信息为“wu liang tian zun” </p>
<p><strong>groupadd taoist</strong></p>
<p><strong>groupadd tianzun</strong></p>
<p><strong>useradd -G taoist,tianzun -c”wu liang tian zun” -s /bin/csh wangqing</strong></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/7.linux--用户和组管理/" data-id="ck7ooyakg00364su69gtpv78p"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-6.linux--yum工具的使用" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/6.linux--yum工具的使用/"
    >yum工具的使用</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/6.linux--yum工具的使用/" class="article-date">
  <time datetime="2019-08-29T15:44:18.552Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>[toc]</p>
<h2 id="rpm的弊端"><a href="#rpm的弊端" class="headerlink" title="rpm的弊端"></a>rpm的弊端</h2><p>rpm弊端是显而易见的，当用rpm安装软件时，若遇到有依赖关系的软件，必须先安装依赖的软件才能继续安装我们要安装的软件，当依赖关系很复杂的情况下，这种安装方式就很气人，所以我们需要另一种安装方式来解决这个问题——-yum工具的使用</p>
<h2 id="yum的优劣势"><a href="#yum的优劣势" class="headerlink" title="yum的优劣势"></a>yum的优劣势</h2><ul>
<li>yum最大的优势就是能够解决rpm的依赖问题，yum能够自动解决软件安装时的依赖关系。</li>
<li>yum的缺陷就是如果在未完成安装的情况下强行中止安装过程，下次再安装时将无法解决依赖关系，</li>
</ul>
<h2 id="什么是yum及其作用"><a href="#什么是yum及其作用" class="headerlink" title="什么是yum及其作用"></a>什么是yum及其作用</h2><p>yum是yellowdog update manager的简称，它能够实现rpm管理的所有操作，并能够自动解决各rpm包之间的依赖关系。yum是rpm的前端工具，是基于rpm来实现软件的管理的一个工具。</p>
<ul>
<li><p>挂载光盘</p>
</li>
<li><p>插入光盘</p>
</li>
<li><p>执行挂载命令</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># mkdir /mnt/cdrom</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># mount /dev/cdrom /mnt/cdrom/</span></span><br><span class="line">mount: /dev/sr0 写保护，将以只读方式挂载</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ls /mnt/cdrom/</span></span><br><span class="line">addons            GPL       media.repo               RPM-GPG-KEY-redhat-release</span><br><span class="line">EFI               images    Packages                 TRANS.TBL</span><br><span class="line">EULA              isolinux  repodata</span><br><span class="line">extra_files.json  LiveOS    RPM-GPG-KEY-redhat-beta</span><br></pre></td></tr></table></figure>

<h2 id="yum的原理"><a href="#yum的原理" class="headerlink" title="yum的原理"></a>yum的原理</h2><p><img src="https://s2.ax1x.com/2019/04/27/EM9y59.png" alt></p>
<p>yum的工作需要两部分来合作，一部分是yum服务器，另一部分就是client的yum工具。下面分别介绍两部分工作原理。</p>
<h6 id="yum服务器端工作原理"><a href="#yum服务器端工作原理" class="headerlink" title="yum服务器端工作原理"></a>yum服务器端工作原理</h6><p>所有要发行的rpm包都放在yum服务器上以提供别人来下载，rpm包根据kernel的版本号，cpu的版本号分别编译发布。yum服务器只要提供简单的下载就可以了，ftp或者http的形式都可以。yum服务器有一个最重要的环节就是整理出每个rpm包的基本信息，包括rpm包对应的版本号、conf文件、binary信息，以及很关键的依赖信息。在yum服务器上提供了createrepo工具，用于把rpm包的基本概要信息做成一张“清单”，这张“清单”就是描述每个rpm包的spec文件中信息。</p>
<h5 id="client端工作原理"><a href="#client端工作原理" class="headerlink" title="client端工作原理"></a>client端工作原理</h5><p>client每次调用yum install或者search的时候，都会去解析/etc/yum.repos.d下面所有以.repo结尾的配置文件，这些配置文件指定了yum服务器的地址。yum会定期去更新yum服务器上的rpm包清单，然后把清单下载保存到yum客户端自己的cache里面，根据/etc/yum.conf里配置（默认是/var/cache/yum下面），每次调用yum装包的时候都会去这个cache目录下去找清单，根据清单里的rpm包描述从而来确定安装包的名字、版本号、所需要的依赖包等，然后再去yum服务器下载rpm安装。（前提是不存在rpm包的cache）</p>
<h2 id="yum的元数据"><a href="#yum的元数据" class="headerlink" title="yum的元数据"></a>yum的元数据</h2><h4 id="yum的配置文件"><a href="#yum的配置文件" class="headerlink" title="yum的配置文件"></a>yum的配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[bendiyum]      //仓库名称</span><br><span class="line">name=bendiyum    //描写信息</span><br><span class="line">baseurl=file:///mnt/cdrom     //仓库具体路径，可填以下三种</span><br><span class="line">							ftp://</span><br><span class="line">							http://</span><br><span class="line">							file:///</span><br><span class="line">enabled=1      //可选1或者0，1为启用此仓库，0为禁用此仓库</span><br><span class="line">gpgcheck=0     //可选1或者0，1为检查软件和发性，0为不检查来源</span><br><span class="line">			若gpgcheck=1，则必须用gpgkey定义密钥文件的具体路径</span><br><span class="line"> gpgkey=</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># vim /etc/yum.conf</span></span><br><span class="line">[main]  </span><br><span class="line">cachedir=/var/cache/yum/<span class="variable">$basearch</span>/<span class="variable">$releasever</span>     //缓存目录</span><br><span class="line">keepcache=0         //缓存软件包, 1启动 0 关闭</span><br><span class="line">debuglevel=2        //调试级别</span><br><span class="line">logfile=/var/<span class="built_in">log</span>/yum.log       //日志记录位置</span><br><span class="line">exactarch=1          //检查平台是否兼容</span><br><span class="line">obsoletes=1         //检查包是否废弃</span><br><span class="line">gpgcheck=1         //检查来源是否合法,需要有制作者的公钥信息</span><br><span class="line">plugins=1           //是否启用插件</span><br><span class="line">installonly_limit=3</span><br><span class="line"></span><br><span class="line">This is the default, <span class="keyword">if</span> you make this bigger yum won<span class="string">'t see if the metadata</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">is newer on the remote and so you'</span>ll <span class="string">"gain"</span> the bandwidth of not having to</span><br><span class="line"></span><br><span class="line">download the new metadata and <span class="string">"pay"</span> <span class="keyword">for</span> it by yum not having correct</span><br><span class="line"></span><br><span class="line">information.</span><br><span class="line"></span><br><span class="line">It is esp. important, to have correct metadata, <span class="keyword">for</span> distributions like</span><br><span class="line"></span><br><span class="line">Fedora <span class="built_in">which</span> don<span class="string">'t keep old packages around. If you don'</span>t like this checking</span><br><span class="line"></span><br><span class="line">interupting your <span class="built_in">command</span> line usage, it<span class="string">'s much better to have something</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">manually check the metadata once an hour (yum-updatesd will do this).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">metadata_expire=90m         //每小时手动检查元数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PUT YOUR REPOS HERE OR IN separate files named file.repo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">in /etc/yum.repos.d         //包含repos.d目录</span></span><br></pre></td></tr></table></figure>

<h2 id="yum仓库管理"><a href="#yum仓库管理" class="headerlink" title="yum仓库管理"></a>yum仓库管理</h2><h4 id="yum本地仓库"><a href="#yum本地仓库" class="headerlink" title="yum本地仓库"></a>yum本地仓库</h4><ul>
<li>备份挂载目录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># mkdir /opt/myrepo</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># cp -r /mnt/cdrom /opt/myrepo/</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ls /opt/myrepo/</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># ls /opt/myrepo/cdrom</span></span><br><span class="line">addons            GPL       media.repo               RPM-GPG-KEY-redhat-release</span><br><span class="line">EFI               images    Packages                 TRANS.TBL</span><br><span class="line">EULA              isolinux  repodata</span><br><span class="line">extra_files.json  LiveOS    RPM-GPG-KEY-redhat-beta</span><br></pre></td></tr></table></figure>

<ul>
<li>配置repo文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># cd /etc/yum.repos.d/</span></span><br><span class="line">[root@zhoulijie yum.repos.d]<span class="comment"># vim bendiyum.repo</span></span><br><span class="line">[root@zhoulijie yum.repos.d]<span class="comment"># cat bendiyum.repo</span></span><br><span class="line">[bendiyum]</span><br><span class="line">name=bendiyum</span><br><span class="line">baseurl=file:////opt/myrepo/cdrom</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>

<ul>
<li>清空yum本地缓存</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie yum.repos.d]<span class="comment"># yum clean all</span></span><br><span class="line">已加载插件：langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line">正在清理软件源： bendiyum</span><br><span class="line">Cleaning up everything</span><br><span class="line">Maybe you want: rm -rf /var/cache/yum, to also free up space taken by orphaned data from disabled or removed repos</span><br></pre></td></tr></table></figure>

<ul>
<li>检验yum本地仓库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie yum.repos.d]<span class="comment"># yum list | wc -l</span></span><br><span class="line">5096</span><br></pre></td></tr></table></figure>

<h4 id="yum网络仓库"><a href="#yum网络仓库" class="headerlink" title="yum网络仓库"></a>yum网络仓库</h4><ul>
<li>官方网络yum仓库（国外）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure>

<ul>
<li>阿里云yum仓库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.aliyun.com/repo/Centos-5.repo</span><br></pre></td></tr></table></figure>

<ul>
<li>163yum仓库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.163.com/.<span class="built_in">help</span>/CentOS6-Base-163.repo</span><br></pre></td></tr></table></figure>

<ul>
<li>xx大学yum仓库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirror.tuna.tsinghua.edu.cn/<span class="built_in">help</span>/centos/</span><br></pre></td></tr></table></figure>

<ul>
<li>epel源</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//国外</span><br><span class="line">yum -y install epel-release</span><br><span class="line"></span><br><span class="line">//阿里</span><br><span class="line">wget http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure>

<h6 id="软件官方仓库"><a href="#软件官方仓库" class="headerlink" title="软件官方仓库"></a>软件官方仓库</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 源查找方式基本一致,zabbix,mysql,saltstack,openstack等等，上官网找</span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/yum.repos.d/nginx.repo</span></span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo </span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/<span class="variable">$basearch</span>/ </span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<p>redhat7使用centos7的yum源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1.卸载红帽yum源</span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -e $(rpm -qa|grep yum) --nodeps</span></span><br><span class="line"></span><br><span class="line">2.删除所有repo相关文件</span><br><span class="line">[root@localhost ~]<span class="comment"># rm -f /etc/yum.conf</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rm -rf /etc/yum.repos.d/</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rm -rf /var/cache/yum</span></span><br><span class="line"></span><br><span class="line">3.下载centos相关yum组件</span><br><span class="line">[root@localhost ~]<span class="comment"># wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-3.4.3-154.el7.centos.noarch.rpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-metadata-parser-1.1.4-10.el7.x86_64.rpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.31-42.el7.noarch.rpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-updateonboot-1.1.31-42.el7.noarch.rpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-utils-1.1.31-42.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">//如果没有wget命令则使用curl命令</span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o yum-utils-1.1.31-42.el7.noarch.rpm  https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-utils-1.1.31-42.el7.noarch.rpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o yum-3.4.3-154.el7.centos.noarch.rpm  https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-3.4.3-154.el7.centos.noarch.rpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o yum-metadata-parser-1.1.4-10.el7.x86_64.rpm  https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-metadata-parser-1.1.4-10.el7.x86_64.rpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o yum-plugin-fastestmirror-1.1.31-42.el7.noarch.rpm   https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.31-42.el7.noarch.rpm</span></span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o yum-updateonboot-1.1.31-42.el7.noarch.rpm https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-updateonboot-1.1.31-42.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">3.安装所有相关组件</span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -ivh yum-* --nodeps</span></span><br><span class="line"></span><br><span class="line">4.下载base和epel仓库</span><br><span class="line">[root@localhost ~]<span class="comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line">[root@localhost ~]<span class="comment"># sed -i 's#\$releasever#7#g' /etc/yum.repos.d/CentOS-Base.repo</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span></span><br></pre></td></tr></table></figure>

<h2 id="yum管理软件"><a href="#yum管理软件" class="headerlink" title="yum管理软件"></a>yum管理软件</h2><h4 id="yum命令语法："><a href="#yum命令语法：" class="headerlink" title="yum命令语法："></a>yum命令语法：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum [options] [<span class="built_in">command</span>] [package ...]</span><br></pre></td></tr></table></figure>

<h6 id="常用的选项"><a href="#常用的选项" class="headerlink" title="常用的选项"></a>常用的选项</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">--nogpgcheck                //如果从网上下载包有时会检查gpgkey，此时可以使用此命令跳过gpgkey的检查</span><br><span class="line">-y                          //自动回答为<span class="string">"yes"</span></span><br><span class="line">-q                          //静默模式，安装时不输出信息至标准输出</span><br><span class="line">--disablerepo=repoidglob    //临时禁用此处指定的repo</span><br><span class="line">--enablerepo=repoidglob     //临时启用此处指定的repo</span><br><span class="line">--noplugins                 //禁用所有插件</span><br><span class="line">```bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###### 常用的命令</span></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">list            //列表</span><br><span class="line">    all         //默认项</span><br><span class="line">    available   //列出仓库中有的，但尚未安装的所有可用的包</span><br><span class="line">    installed   //列出已经安装的包</span><br><span class="line">    updates     //可用的升级</span><br><span class="line">    </span><br><span class="line">clean           //清理缓存</span><br><span class="line">    packages</span><br><span class="line">    headers</span><br><span class="line">    metadata</span><br><span class="line">    dbcache</span><br><span class="line">    all</span><br><span class="line">    </span><br><span class="line">repolist        //显示repo列表及其简要信息</span><br><span class="line">    all</span><br><span class="line">    enabled     //默认项</span><br><span class="line">    disabled</span><br><span class="line">    </span><br><span class="line">install         //安装</span><br><span class="line">    yum install packages [...]</span><br><span class="line">    </span><br><span class="line">update          //升级</span><br><span class="line">    yum update packages [...]</span><br><span class="line">update_to       //升级为指定版本</span><br><span class="line"></span><br><span class="line">downgrade package1 [package2 ...]   //降级</span><br><span class="line"></span><br><span class="line">remove|erase    //卸载</span><br><span class="line"></span><br><span class="line">info    //显示rpm -qi package的结果</span><br><span class="line">    yum info packages</span><br><span class="line">    </span><br><span class="line">provides|whatprovides   //查看指定的文件或特性是由哪个包安装生成的</span><br><span class="line"></span><br><span class="line">search string1 [string2 ...]    //以指定的关键字搜索程序包名及summary信息</span><br><span class="line"></span><br><span class="line">deplist package [package2 ...]  //显示指定包的依赖关系</span><br><span class="line"></span><br><span class="line"><span class="built_in">history</span>     //查看yum的历史事务信息</span><br><span class="line"></span><br><span class="line">localinstall    //安装本地rpm包，自动解决依赖关系</span><br><span class="line"></span><br><span class="line">grouplist       //列出可用的组</span><br><span class="line"></span><br><span class="line">groupinstall <span class="string">"group name"</span>   //安装一组软件</span><br><span class="line">        </span><br><span class="line">createrepo命令    //创建yum仓库的元数据信息</span><br><span class="line">[root@localhost ~]<span class="comment"># yum install createrepo -y</span></span><br><span class="line">[root@localhost ~]<span class="comment"># createrepo [options] &lt;directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 具体实例</span></span><br><span class="line"><span class="comment">###### 搜索软件包</span></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">//列出软件仓库中可用的软件</span><br><span class="line">[root@localhost ~]<span class="comment"># yum list all</span></span><br><span class="line"></span><br><span class="line">//进行模糊查找</span><br><span class="line">[root@localhost ~]<span class="comment"># yum list | grep ftp</span></span><br><span class="line"></span><br><span class="line">//列出软件包详情</span><br><span class="line">[root@localhost ~]<span class="comment"># yum info ftp</span></span><br></pre></td></tr></table></figure>

<h6 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//安装软件只需要给出软件名称</span><br><span class="line">[root@localhost ~]<span class="comment"># yum install traceroute</span></span><br><span class="line"></span><br><span class="line">//安装过程中分析依赖关系后, 直接安装, 无需交互</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install php</span></span><br><span class="line"></span><br><span class="line">//安装本地的rpm包, 如果有依赖关系, 会自动从软件仓库中下载所需依赖（非来自.repo定义的软件仓库）</span><br><span class="line">[root@localhost ~]<span class="comment"># yum localinstall /mnt/Packages/bind-9.9.4-50.el7.x86_64.rpm</span></span><br><span class="line"></span><br><span class="line">//安装网络上rpm包</span><br><span class="line">[root@localhost ~]<span class="comment"># yum install http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span></span><br></pre></td></tr></table></figure>

<h6 id="重装软件包"><a href="#重装软件包" class="headerlink" title="重装软件包"></a>重装软件包</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//检查软件是否存在</span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -q vsftpd</span></span><br><span class="line">vsftpd-2.2.2-24.el6.x86_64</span><br><span class="line"></span><br><span class="line">//检查vsftpd软件配置文件</span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -qc vsftpd</span></span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br><span class="line"></span><br><span class="line">//不小心删除vsftpd配置文件</span><br><span class="line">[root@localhost ~]<span class="comment"># rm -f /etc/vsftpd/vsftpd.conf</span></span><br><span class="line"></span><br><span class="line">//重新安装软件</span><br><span class="line">[root@localhost ~]<span class="comment"># yum reinstall vsftpd</span></span><br><span class="line"></span><br><span class="line">//再次检查</span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -qc vsftpd</span></span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure>

<p>更新软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//对比Linux已安装的软件和yum仓库中的软件, 有哪些需要升级</span><br><span class="line">[root@localhost ~]<span class="comment"># yum check-update</span></span><br><span class="line"></span><br><span class="line">//更新软件</span><br><span class="line">[root@localhost ~]<span class="comment">#  yum update acl -y</span></span><br></pre></td></tr></table></figure>

<h6 id="删除软件包"><a href="#删除软件包" class="headerlink" title="删除软件包"></a>删除软件包</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//先安装一个samba软件</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install samba</span></span><br><span class="line"></span><br><span class="line">//删除该软件包,不会删除依赖, 但是我们尽可能不要使用删除软件操作</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y erase samba</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y remove samba</span></span><br></pre></td></tr></table></figure>

<h6 id="与仓库相关的命令"><a href="#与仓库相关的命令" class="headerlink" title="与仓库相关的命令"></a>与仓库相关的命令</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//列出yum源可用的软件仓库</span><br><span class="line">[root@localhost ~]<span class="comment"># yum repolist</span></span><br><span class="line"></span><br><span class="line">//列出全部yum源可用和禁用的仓库</span><br><span class="line">[root@localhost ~]<span class="comment"># yum repolist all</span></span><br><span class="line"></span><br><span class="line">//查看这个文件或命令属于哪个包</span><br><span class="line">[root@localhost ~]<span class="comment"># yum provides /etc/my.cnf</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum provides cd</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum provides *bin/pstree</span></span><br></pre></td></tr></table></figure>

<h6 id="与缓存相关的命令"><a href="#与缓存相关的命令" class="headerlink" title="与缓存相关的命令"></a>与缓存相关的命令</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//缓存yum源软件仓库, xml元数据文件</span><br><span class="line">[root@localhost ~]<span class="comment"># yum makecache</span></span><br><span class="line"></span><br><span class="line">//缓存软件包, 修改yum全局配置文件</span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/yum.conf</span></span><br><span class="line">[main]</span><br><span class="line">cachedir=/var/cache/yum/<span class="variable">$basearch</span>/<span class="variable">$releasever</span></span><br><span class="line">keepcache=1 //启动缓存</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//查看缓存的xml文件</span><br><span class="line">[root@localhost ~]<span class="comment"># ls /var/cache/yum/x86_64/7/base/</span></span><br><span class="line"></span><br><span class="line">//查看缓存软件包路径</span><br><span class="line">[root@localhost ~]<span class="comment"># ls /var/cache/yum/x86_64/7/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#另一种缓存rpm包方式</span></span><br><span class="line"></span><br><span class="line">//1.安装插件支持只下载软件包不安装</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install yum-plugin-downloadonly</span></span><br><span class="line">//2.将软件下载至指定目录</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install --downloadonly --downloaddir=/tmp httpd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//清除所有yum缓存</span><br><span class="line">[root@localhost ~]<span class="comment"># yum clean all</span></span><br><span class="line"></span><br><span class="line">//只清除缓存的软件包</span><br><span class="line">[root@localhost ~]<span class="comment"># yum clean packages</span></span><br></pre></td></tr></table></figure>

<h6 id="与包组相关的命令"><a href="#与包组相关的命令" class="headerlink" title="与包组相关的命令"></a>与包组相关的命令</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//列出已经安装和所有可使用的软件组</span><br><span class="line">[root@localhost ~]<span class="comment"># yum groups list</span></span><br><span class="line"></span><br><span class="line">//安装一整个组的软件</span><br><span class="line">[root@localhost ~]<span class="comment"># yum groups install Development tools \</span></span><br><span class="line">Compatibility libraries \</span><br><span class="line">Base Debugging Tools</span><br><span class="line"></span><br><span class="line">//yum删除包组</span><br><span class="line">[root@localhost ~]<span class="comment"># yum groups remove  -y Base</span></span><br></pre></td></tr></table></figure>

<p>####### 与历史记录相关的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//查看历史执行yum命令</span><br><span class="line">[root@localhost ~]<span class="comment"># yum history</span></span><br><span class="line"></span><br><span class="line">//查询历史执行yum命令ID详细信息</span><br><span class="line">[root@localhost ~]<span class="comment"># yum history info N</span></span><br><span class="line"></span><br><span class="line">//撤销历史执行过的yum命令</span><br><span class="line">[root@localhost ~]<span class="comment"># yum history undo N</span></span><br></pre></td></tr></table></figure>

<h6 id="YUM签名检查机制"><a href="#YUM签名检查机制" class="headerlink" title="YUM签名检查机制"></a>YUM签名检查机制</h6><ul>
<li>rpm软件提供组织redhat在构建rpm包时, 使用其私钥private key对 rpm进行签名</li>
<li>客户端在使用rpm为了验证其合法性, 可以使用redhat提供的公钥public key进行签名检查</li>
</ul>
<p>方式1：指定公钥位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/yum.repos.d/CentOS-Base.repo</span></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;arch=<span class="variable">$basearch</span>&amp;repo=os&amp;infra=<span class="variable">$infra</span> <span class="comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>

<p>方式2：提前导入公钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/yum.repos.d/CentOS-Base.repo</span></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base </span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;arch=<span class="variable">$basearch</span>&amp;repo=os&amp;infra=<span class="variable">$infra</span></span><br><span class="line">baseurl=http://mirror.centos.org/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br></pre></td></tr></table></figure>

<p>方式3：不进行签名验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//不检查软件包的签名</span><br><span class="line">[root@localhost ~]<span class="comment"># yum install httpd --nogpgcheck</span></span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>如何配置本地光盘yum仓库以及网络yum仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mnt/cdrom</span><br><span class="line">mount /dev/cdrom /mnt/cdrom</span><br><span class="line"></span><br><span class="line">vim /etc/yum.repo.d/bendiyum.repo</span><br><span class="line">[bendiyum]</span><br><span class="line">name=bendiyum</span><br><span class="line">baseurl=file:///mnt/cdrom</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">yum clean all</span><br><span class="line">yum list | wc -l</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">首先了解到网络源的位置</span><br><span class="line">使用wget下载</span><br></pre></td></tr></table></figure>

<p>如何使用yum安装 httpd php nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y httpd php nginx</span><br></pre></td></tr></table></figure>

<p>如何配置yum缓存rpm包（至少阐述两种方式）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall /mnt/Packages/<span class="built_in">bind</span>-9.9.4-50.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">yum install http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>如何使用yum安装本地缓存好的rpm包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall /mnt/Packages/<span class="built_in">bind</span>-9.9.4-50.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>如何使用yum删除httpd软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove httpd</span><br></pre></td></tr></table></figure>

<p>如何构建企业内部yum仓库服务(请写出详细步骤,至少准备两台虚拟机，使用http方式)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/6.linux--yum工具的使用/" data-id="ck7ooyake00334su6mreqt6q8"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-5.linux--linux计划任务" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/5.linux--linux计划任务/"
    >Linux计划任务</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/5.linux--linux计划任务/" class="article-date">
  <time datetime="2019-08-29T15:44:18.541Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>[TOC]</p>
<h2 id="crond计划任务概述"><a href="#crond计划任务概述" class="headerlink" title="crond计划任务概述"></a>crond计划任务概述</h2><p>crond 是linux下用来周期性的执行某种任务或等待处理某些事件的一个守护进程，与windows下的计划任务类似，当安装完成操作系统后，默认会安装此服务 工具，并且会自动启动crond进程，crond进程每分钟会定期检查是否有要执行的任务，如果有要执行的任务，则自动执行该任务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Schedule one-time tasks with at.   一次性调度执行 at</span><br><span class="line">Schedule recurring jobs with cron. 循环调度执行 cron</span><br><span class="line">Schedule recurring system jobs. 所有计划任务执行中的输出都会以邮件的方式发送给指定用户, 除非重定向</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//循环调度执行cron 进程每分钟会处理一次计划任务</span><br><span class="line">[root@zhoulijie ~]# systemctl status crond</span><br><span class="line">[root@zhoulijie ~]# ps aux | grep crond</span><br><span class="line">root       1238  0.0  0.0 126236  1672 ?        Ss   00:27   0:00 /usr/sbin/crond -n</span><br><span class="line">root      16029  0.0  0.0 112680   984 pts/0    S+   21:58   0:00 grep --color=auto crond</span><br></pre></td></tr></table></figure>

<p><strong>计划任务分为以下两种情况：</strong></p>
<ul>
<li><p>系统级别的定时任务:</p>
<blockquote>
<p>清理系统缓存<br>临时文件清理<br>系统信息采集<br>日志文件切割</p>
</blockquote>
</li>
<li><p>用户级别的定时任务:</p>
<blockquote>
<p>定时同步互联网时间<br>定时备份系统配置文件<br>定时备份数据库文件</p>
</blockquote>
</li>
</ul>
<h2 id="crond配置文件详解"><a href="#crond配置文件详解" class="headerlink" title="crond配置文件详解"></a>crond配置文件详解</h2><ul>
<li><p>Linux下的任务调度分为两类，系统任务调度和用户任务调度。</p>
</li>
<li><p>系统任务调度：系统周期性所要执行的工作，比如写缓存数据到硬盘、日志清理等。在/etc目录下有一个crontab文件，这个就是系统任务调度的配置文件。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">文件              说明</span><br><span class="line">/etc/crontab        //crontab配置文件</span><br><span class="line">/etc/cron.deny      //该文件中所列用户不允许使用crontab命令</span><br><span class="line">/var/spool/cron/*   //所有用户定时文件都存放此目录,文件以用户名命名</span><br><span class="line">/var/log/cron       //定时任务执行后的日志文件,可用来回溯</span><br></pre></td></tr></table></figure>

<h2 id="crond计划任务管理"><a href="#crond计划任务管理" class="headerlink" title="crond计划任务管理"></a>crond计划任务管理</h2><p><strong>crond任务管理</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">参数          含义                指定示例</span><br><span class="line">-e      编辑crontab文件内容       crontab -e</span><br><span class="line">-l      查看crontab文件内容       crontab -l</span><br><span class="line">-r      删除crontab文件内容       crontab -r</span><br><span class="line">-u      管理其他用户的计划任务   crontab -u zhou -l</span><br><span class="line">注意: crontab &#123;-l -e&#125;实际上就是在操作/var/spool/cron/username</span><br></pre></td></tr></table></figure>

<p><strong>crond时间含义</strong></p>
<p><img src="https://img-blog.csdn.net/20180301122140123" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Example of job definition:</span><br><span class="line"># .---------------- minute (0 - 59) //分钟</span><br><span class="line"># |  .------------- hour (0 - 23)   //小时</span><br><span class="line"># |  |  .---------- day of month (1 - 31)   //日期</span><br><span class="line"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr //月份</span><br><span class="line"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat  //星期</span><br><span class="line"># |  |  |  |  |</span><br><span class="line"># *  *  *  *  *   command to be executed</span><br><span class="line"></span><br><span class="line">// *    表示任意的(分、时、日、月、周)时间都执行</span><br><span class="line">// -    表示一个时间范围段, 如5-7点</span><br><span class="line">// ,    表示分隔时段, 如6,0,4表示周六、日、四</span><br><span class="line">// */n  表示每隔n单位时间, 如*/10 每10分钟</span><br></pre></td></tr></table></figure>

<p><strong>crond编写示例</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">00 02 * * * command      //每天2:00整 </span><br><span class="line">00 02 1 * * command      //每月1号2:00整 </span><br><span class="line">00 02 14 2 * command     //每年2月14号2:00整 </span><br><span class="line">00 02 * * 7 command      //每周日2:00整 </span><br><span class="line">00 02 * 6 5 command      //每年6月的周五2:00整</span><br><span class="line">00 02 14 * 7 command     //每月14号2:00整或每周日2:00整，这两个时间都执行</span><br><span class="line">00 02 14 2 7 command     //每年 2 月 14 号 2:00 整 或者 每周日 2:00 整，这两个时间都执行 </span><br><span class="line">00 02 * * * command      //每天2:00整</span><br><span class="line">*  02 * * * command      //每天2:00中的每一分钟 (错误示范)</span><br><span class="line">* * * * *  command       //每分钟执行 ls</span><br><span class="line">* * 14 2 *  command      //2月14号的每分钟(错误示范)</span><br><span class="line">*/5 * * * *  command     //每隔5分钟 </span><br><span class="line">00 02 * 1,5,8 * command  //每年1,5,8月的每天2:00整 </span><br><span class="line">00 02 1-8 * *  command   //每月1到8号的2:00整</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180510204632418?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhdGVycGlsbGFyNw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p><strong>crond书写规范</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//1.为计划任务增加必要的注释</span><br><span class="line">[root@zhoulijie ~]# crontab -e</span><br><span class="line">no crontab for root - using an empty one</span><br><span class="line">crontab: installing new crontab</span><br><span class="line">[root@zhoulijie ~]# crontab -l</span><br><span class="line">##time sync</span><br><span class="line">*/5 * * * * /usr/sbin/ntpdate time1.aliyun.com &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line">//2.规范计划任务执行脚本存放的路径/scripts/</span><br><span class="line">[root@zhoulijie ~]# crontab -e</span><br><span class="line">crontab: installing new crontab</span><br><span class="line">[root@zhoulijie ~]# crontab -l</span><br><span class="line">##backup www to /backup</span><br><span class="line">30 01 * * * /bin/sh /scripts/www_backup.sh &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line">//3.执行shell脚本任务前加/bin/sh, 脚本结尾加&amp;&gt;/dev/null</span><br><span class="line">//调试好后应屏蔽debug输出信息,避免产生系统垃圾占用过多inode, 如需输出日志, 可重定向至日志文件</span><br><span class="line">[root@zhoulijie ~]# crontab -e</span><br><span class="line">crontab: installing new crontab</span><br><span class="line">[root@zhoulijie ~]# crontab -l</span><br><span class="line">####backup www to /backup</span><br><span class="line">30 01 * * * /bin/sh /scripts/www_backup.sh &amp;&gt;/tmp/www_backup.log</span><br></pre></td></tr></table></figure>

<h2 id="crond配置编写实例"><a href="#crond配置编写实例" class="headerlink" title="crond配置编写实例"></a>crond配置编写实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]# crontab -e</span><br><span class="line"></span><br><span class="line">#每天凌晨切割nginx日志</span><br><span class="line">05 00 * * * /bin/bash -x /scripts/cut_nginx.sh &amp;&gt; /scripts/log/nginx.log</span><br><span class="line"></span><br><span class="line">#每天5点备份数据库</span><br><span class="line">00 05 * * * /bin/bash -x /scripts/dump_sql.sh &amp;&gt;/scripts/log/mysql.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//注意：</span><br><span class="line">1.我们所有的crond服务是运行的程序。而crontab命令用户用来设置定时规则的命令。</span><br><span class="line">2.crond服务是企业生产工作中常用的重要服务，at很少使用，可以忽略。</span><br><span class="line">3.几乎每个服务器都会用到crond服务。</span><br></pre></td></tr></table></figure>

<h2 id="crond计划任务调试"><a href="#crond计划任务调试" class="headerlink" title="crond计划任务调试"></a>crond计划任务调试</h2><blockquote>
<ol>
<li>调整任务每分钟执行, 检测是否是否正常, 有些任务不要频繁执行</li>
<li>调整系统时间然后在检测任务, 生产不建议直接使用此方式</li>
<li>执行脚本, 将脚本执行输出写入指定日志文件, 观察日志内容是否正常</li>
<li>注意一些任务命令带来的问题echo “wangqing” &gt;&gt;/tmp/test.log &amp;&gt;/dev/null</li>
<li>命令使用绝对路径, 防止无法找到命令导致定时任务执行故障</li>
<li>查看/var/log/cron日志进行调试</li>
</ol>
</blockquote>
<p>建议: 将需要定期执行的任务写入脚本中, 建立/scripts目录统一存放脚本, 脚本中命令必须使用绝对路径,手动执行脚本检测输出是否正常, 然后将脚本加入计划任务测试, 测试后无问题将脚本输出写入对应的日志文件中即可。</p>
<p>计划任务添加步骤：</p>
<ol>
<li>手动执行保留执行命令的正确结果</li>
<li>编写脚本<ul>
<li>脚本需要统一路径/scripts</li>
<li>脚本开头建议填写注释信息, 包括执行时间、周期、任务</li>
<li>脚本内容复制执行成功的命令至脚本文件中(减少每个环节出错几率)</li>
<li>脚本内容尽可能的优化, 使用一些变量或使用简单的判断语句</li>
<li>脚本执行的输出信息不要随意打印, 可以重定向至其他位置保留或丢入黑洞</li>
</ul>
</li>
<li>执行脚本<ul>
<li>使用bash执行, 防止脚本没有增加执行权限(/bin/bash)</li>
<li>执行命令以及脚本成功后并复制该命令</li>
</ul>
</li>
<li>编写计划任务<ul>
<li>加上必要的注释信息, 人、时间、任务</li>
<li>设定计划任务执行的周期</li>
<li>加入执行脚本的命令</li>
</ul>
</li>
<li>调试计划任务<ul>
<li>增加任务频率测试、调整系统时间测试(不能用于生产)</li>
<li>检查环境变量问题、检查crond服务产生日志进行排查</li>
</ul>
</li>
</ol>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>1.在linux系统中备份脚本backup.sh需要再每周1-5的每天下午1点和晚上8点执行，下列哪个cron命令可以完成（D）</p>
<p>a. 00 13,20 * 1-5 * backup.sh </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">每年的1-5月的13点和20点执行backup.sh</span><br></pre></td></tr></table></figure>

<p>b. 0 13,20 1,5 * * backup.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">每月的1号和5号的13点和20点执行backup.sh</span><br></pre></td></tr></table></figure>

<p>c. * 13,20 * * 1-5 backup.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">错误显示</span><br></pre></td></tr></table></figure>

<p>d. 00 13,20 * * 1-5 backup.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">每周一-周五的13点和20点执行backup.sh</span><br></pre></td></tr></table></figure>

<p>说明以上答案每一行是什么含义</p>
<p>2.新建/scripts/httpd.sh文件，并让/scripts/httpd.sh脚本在每天的00:10分执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># mkdir /scripts</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># touch /scripts/httpd.sh</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># whereis sh</span></span><br><span class="line">sh: /usr/bin/sh /usr/share/man/man1/sh.1.gz /usr/share/man/man1p/sh.1p.gz</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># crontab -e</span></span><br><span class="line">crontab: installing new crontab</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># crontab -l</span></span><br><span class="line">10 00 * * * /usr/bin/sh /scripts/httpd.sh</span><br></pre></td></tr></table></figure>

<p>3.新建/backup目录,每周一下午5:50将/backup目录下的所有文件打包成 backup.tar.gz</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># mkdir /bachup</span></span><br><span class="line">[root@zhoulijie ~]<span class="comment"># whereis tar</span></span><br><span class="line">tar: /usr/bin/tar /usr/share/man/man1/tar.1.gz /usr/share/man/man5/tar.5.gz</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># crontab -e</span></span><br><span class="line">crontab: installing new crontab</span><br><span class="line">[root@zhoulijie ~]<span class="comment"># crontab -l</span></span><br><span class="line">50 17 * * 1 /usr/bin/tar -czf backup.tar.gz /backup</span><br></pre></td></tr></table></figure>

<p>4.写一个定时任务，每天0点5分把/var/log/nginx下7天前的文件转移到/backup/2018_xx_xx的目录中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># crontab -l</span></span><br><span class="line">5 0 * * * /usr/bin/find /var/<span class="built_in">log</span>/nginx -mtime +7 | xargs /usr/bin/mv &#123;&#125; /backup/$(date <span class="string">'+%Y_%m_%d'</span>)</span><br></pre></td></tr></table></figure>

<p>5.系统脚本/scripts/which.sh，如何定时每隔7分钟执行一次？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># crontab -e</span></span><br><span class="line">*/7 * * * *</span><br></pre></td></tr></table></figure>

<p>6.如何不小心删除了/var/spool/cron/root文件，该如何恢复。</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/5.linux--linux计划任务/" data-id="ck7ooyai900284su6b0olw5tn"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-4.linux--权限管理" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/08/29/4.linux--权限管理/"
    >权限管理</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/08/29/4.linux--权限管理/" class="article-date">
  <time datetime="2019-08-29T15:44:18.536Z" itemprop="datePublished">2019-08-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux基础/">linux基础</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <blockquote>
<p><strong>关于作者</strong></p>
<p><strong>周李杰</strong>，最后一批90后，现居<strong>湖北武汉</strong></p>
<p>孤独患者，懒癌中期，无脑幻想者。但却人畜无害，无需远离。</p>
<p>兴趣众多，然无一精通。正努力成为一个有趣的人。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; print(&quot;👆以上是不完整的我&quot;) //请我吃大餐将会了解更多</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h1><p>[TOC]</p>
<h2 id="权限简介"><a href="#权限简介" class="headerlink" title="权限简介"></a>权限简介</h2><p>1.文件的权限主要针对三类对象进行定义：</p>
<ul>
<li>owner：属主，u</li>
<li>group：属组，g</li>
<li>other：其它，o</li>
</ul>
<blockquote>
<p> 我们可以把owner 当成小明，group当成小明他家里人，other当成隔壁老王</p>
</blockquote>
<p>2.每个文件针对每个访问者都定义了三种权限：</p>
<table>
<thead>
<tr>
<th align="center">权限</th>
<th align="center">对应的操作对象</th>
<th align="center">权限说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">r</td>
<td align="center">文件</td>
<td align="center">可读，可以使用类似cat等命令查看文件内容</td>
</tr>
<tr>
<td align="center">w</td>
<td align="center">文件</td>
<td align="center">可写，可以编辑或删除此文件</td>
</tr>
<tr>
<td align="center">x</td>
<td align="center">文件</td>
<td align="center">可执行，eXacutable，可以在命令提示符下当作命令提交给内核运行</td>
</tr>
<tr>
<td align="center">r</td>
<td align="center">目录</td>
<td align="center">可以对此目录执行ls以列出内部的所有文件</td>
</tr>
<tr>
<td align="center">w</td>
<td align="center">目录</td>
<td align="center">可以在此目录中创建文件，也可删除此目录中的文件</td>
</tr>
<tr>
<td align="center">x</td>
<td align="center">目录</td>
<td align="center">可以使用cd切换进此目录，也可以使用ls -l查看内部文件的详细信息</td>
</tr>
</tbody></table>
<p>3.权限的八进制与十进制转换：</p>
<p>|权限|八进制|十进制|<br>|—|000|0|<br>|–x|001|1|<br>|-w-|010|2|<br>|-wx|011|3|<br>|r–|100|4|<br>|r-x|101|5|<br>|rw-|110|6|<br>|rwx|111|7|</p>
<h2 id="权限管理命令"><a href="#权限管理命令" class="headerlink" title="权限管理命令"></a>权限管理命令</h2><h4 id="修改权限的命令chmod"><a href="#修改权限的命令chmod" class="headerlink" title="修改权限的命令chmod"></a>修改权限的命令chmod</h4><p>-R 递归修改权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># ls</span></span><br><span class="line">123  abc  qqq  shadow</span><br><span class="line">[root@MR tmp]<span class="comment"># ls -l abc</span></span><br><span class="line">总用量 0</span><br><span class="line">-rw-r--r--. 1 root root 0 3月  27 09:54 123</span><br><span class="line">-rw-r--r--. 1 root root 0 3月  27 09:54 3445</span><br><span class="line">-rw-r--r--. 1 root root 0 3月  27 09:55 efsf</span><br><span class="line">[root@MR tmp]<span class="comment"># chmod -R 666 abc</span></span><br><span class="line">[root@MR tmp]<span class="comment"># ls -l abc</span></span><br><span class="line">总用量 0</span><br><span class="line">-rw-rw-rw-. 1 root root 0 3月  27 09:54 123</span><br><span class="line">-rw-rw-rw-. 1 root root 0 3月  27 09:54 3445</span><br><span class="line">-rw-rw-rw-. 1 root root 0 3月  27 09:55 efsf</span><br></pre></td></tr></table></figure>

<h4 id="修改文件属主和属组的命令chown"><a href="#修改文件属主和属组的命令chown" class="headerlink" title="修改文件属主和属组的命令chown"></a>修改文件属主和属组的命令chown</h4><p>-R 修改目录及其内部文件的属主(中间用冒号或者逗号隔开)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@MR tmp]<span class="comment"># ls -l abc</span></span><br><span class="line">总用量 0</span><br><span class="line">-rw-rw-rw-. 1 root root 0 3月  27 09:54 123</span><br><span class="line">-rw-rw-rw-. 1 root root 0 3月  27 09:54 3445</span><br><span class="line">-rw-rw-rw-. 1 root root 0 3月  27 09:55 efsf</span><br><span class="line">[root@MR tmp]<span class="comment"># chown -R zhou:zhou abc</span></span><br><span class="line">[root@MR tmp]<span class="comment"># ls -l abc</span></span><br><span class="line">总用量 0</span><br><span class="line">-rw-rw-rw-. 1 zhou zhou 0 3月  27 09:54 123</span><br><span class="line">-rw-rw-rw-. 1 zhou zhou 0 3月  27 09:54 3445</span><br><span class="line">-rw-rw-rw-. 1 zhou zhou 0 3月  27 09:55 efsf</span><br></pre></td></tr></table></figure>

<h2 id="遮罩码"><a href="#遮罩码" class="headerlink" title="遮罩码"></a>遮罩码</h2><p>为什么文件创建以后默认权限是644？<br>为什么目录创建以后默认权限是755？</p>
<p>这是由遮罩码umask来控制的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@MR ~]<span class="comment"># cat /usr/bin/umask</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">builtin</span> <span class="built_in">umask</span> <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>

<p>从名字就能看出来，遮罩码umask是用来隐藏一些权限的。举例：如果你不想让人家认出你，你会怎么办？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># umask</span></span><br><span class="line">0022</span><br></pre></td></tr></table></figure>

<p>文件最终的权限为：</p>
<ul>
<li>666-umask</li>
</ul>
<p>目录最终的权限为：</p>
<ul>
<li>777-umask</li>
</ul>
<blockquote>
<p>文件默认是不能具有执行权限的，如果算得的结果有执行权限则将其权限整体加1</p>
</blockquote>
<h2 id="Linux安全上下文与特殊权限"><a href="#Linux安全上下文与特殊权限" class="headerlink" title="Linux安全上下文与特殊权限"></a>Linux安全上下文与特殊权限</h2><h4 id="Linux安全上下文"><a href="#Linux安全上下文" class="headerlink" title="Linux安全上下文"></a>Linux安全上下文</h4><p>前提：进程有属主和属组；文件有属主和属组 </p>
<ul>
<li>任何一个可执行程序文件能不能启动为进程，取决于发起者对程序文件是否拥有可执行权限；</li>
<li>启动为进程后，其进程的属主为发起者，属组为发起者所属的组</li>
<li>进程访问文件时的权限取决于进程的发起者： <ul>
<li>进程的发起者是文件的属主时，则应用文件属主权限</li>
<li>进程的发起者是文件的属组时，则应用文件属组权限</li>
<li>应用文件“其它”权限</li>
</ul>
</li>
</ul>
<h4 id="特殊权限"><a href="#特殊权限" class="headerlink" title="特殊权限"></a>特殊权限</h4><p>linux默认权限是根据linux安全上下文的方式来控制的，而特殊权限的存在打破了linux安全上下文的规则。 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SUID(4)     //运行程序时，这个程序启动的进程的属主是程序文件自身的属主，而不是启动者为属主</span><br><span class="line">    chmod u+s file</span><br><span class="line">    chmod u<span class="_">-s</span> file</span><br><span class="line">    //如果file本身原来就有执行权限，则SUID显示为s，否则显示为S</span><br><span class="line">    </span><br><span class="line">SGID(2)     //运行程序时，这个程序启动的进程的属组是程序文件自身的属组，而不是启动者所属的基本组</span><br><span class="line">    //默认情况下，用户创建文件时，其属组为此用户所属的基本组；</span><br><span class="line">    //一旦某目录被设定了SGID，则对此目录有写权限的用户在此目录中创建的文件或目录，其所属的组 \</span><br><span class="line">    //为此设定了SGID的目录的属组</span><br><span class="line">    chmod g+s DIR</span><br><span class="line">    chmod g<span class="_">-s</span> DIR</span><br><span class="line">    //如果file本身原来就有执行权限，则SGID显示为s，否则显示为S</span><br><span class="line">    </span><br><span class="line">Sticky(1)       //在一个公共目录，每个人都能创建文件，删除自己的文件，但是不能删除别人创建的文件</span><br><span class="line">    chmod o+t DIR</span><br><span class="line">    chmod o-t DIR</span><br><span class="line">    //如果DIR本身原来就有执行权限，则Sticky显示为t，否则显示为T</span><br><span class="line">    </span><br><span class="line">4755    //有SUID，文件权限为755</span><br><span class="line">2755    //有SGID，文件权限为755</span><br><span class="line">1755    //有Sticky，文件权限为755</span><br><span class="line">7755    //有SUID、SGID、Sticky，文件权限为755</span><br><span class="line">//这里前面的4、2、1分别表示SUID、SGID、Sticky</span><br></pre></td></tr></table></figure>

<h2 id="文件系通访问控制列表facl"><a href="#文件系通访问控制列表facl" class="headerlink" title="文件系通访问控制列表facl"></a>文件系通访问控制列表facl</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//语法：setfacl [-bkndRLP] &#123; -m|-M|-x|-X ... &#125; file ...</span><br><span class="line">    -m      //设定</span><br><span class="line">        u:UID:perm</span><br><span class="line">        g:GID:perm</span><br><span class="line">    //setfacl -m u:test:rw file</span><br><span class="line">    //setfacl -m g:test:rw file</span><br><span class="line">    //如果要为某个目录设定默认的访问控制列表，只需要设定时在u或g前面加上d即可。 如：\</span><br><span class="line">    //setfacl -m du:test:rw file，此时在此目录中创建的文件均继承此访问控制列表所设置的权限</span><br><span class="line">    -x      //取消</span><br><span class="line">        u:UID</span><br><span class="line">        g:GID</span><br><span class="line">    //setfacl -x u:test file</span><br><span class="line">    //setfacl -x g:test file</span><br><span class="line">    -b      //Remove all</span><br><span class="line">        </span><br><span class="line">//语法：getfacl [-aceEsRLPtpndvh] file ...</span><br><span class="line">//getfacl file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//文件权限应用次序：</span><br><span class="line">//默认情况下：</span><br><span class="line">    Owner --&gt; Group --&gt; Other</span><br><span class="line">//有设置facl的情况下：</span><br><span class="line">    Owner --&gt; facl,user --&gt; Group --&gt; facl,group --&gt; Other</span><br></pre></td></tr></table></figure>

<h2 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h2><p>sudo可以实现某个用户能够以另外哪一个用户的身份通过哪些主机执行什么命令</p>
<p>sudo的配置文件：/etc/sudoers</p>
<p>使用visudo命令进行sudo的配置，每一行就是一个sudo条目，条目格式如下：</p>
<ul>
<li>who which_hosts=(runas) command<ul>
<li>who：User_Alias，表示运行命令者的身份</li>
<li>which_hosts：Host_Alias，通过哪些主机</li>
<li>runas：Runas_Alias，以哪个用户的身份</li>
<li>command：Cmnd_Alias，运行哪些命令   </li>
</ul>
</li>
</ul>
<p><strong>别名必须全部而且只能使用大写英文字母的组合，可以使用感叹号取反</strong></p>
<p><strong>别名分类：</strong></p>
<ul>
<li><p>用户别名：</p>
<ul>
<li>User_Alias NETWORKADMIN =<ul>
<li>用户的用户名</li>
<li>组名，使用%引导</li>
<li>还可以其它已经定义的用户别名</li>
</ul>
</li>
</ul>
</li>
<li><p>主机别名：</p>
<ul>
<li>Host_Alias =<ul>
<li>主机名</li>
<li>IP地址</li>
<li>网络地址</li>
<li>其它主机别名</li>
</ul>
</li>
</ul>
</li>
<li><p>Runas别名： </p>
<ul>
<li>Runas_Alias =<ul>
<li>用户名</li>
<li>%组名</li>
<li>其它的Runas别名</li>
</ul>
</li>
</ul>
</li>
<li><p>命令别名：</p>
<ul>
<li>Cmnd_Alias =<ul>
<li>命令路径</li>
<li>目录（此目录内的所有命令）</li>
<li>其它已定义的命令别名</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo命令语法：sudo [options] COMMAND</span><br><span class="line">    -V      //显示版本编号</span><br><span class="line">    -h      //会显示版本编号及指令的使用方式说明</span><br><span class="line">    -l      //列出当前用户可以使用的所有sudo类命令</span><br><span class="line">    -v      //因为sudo在第一次执行时或是在N分钟内没有执行（N默认为5）会问密码，这个参数 \</span><br><span class="line">            //是重新做一次确认，如果超过N分钟，也会问密码</span><br><span class="line">    -k      //让认证信息失效，如果不指定-k，默认认证信息在5分钟后失效</span><br><span class="line">    -b      //将要执行的指令放在后台执行</span><br><span class="line">    -u USERNAME     //以指定的用户名执行命令，默认为root</span><br></pre></td></tr></table></figure>

<h2 id="管理命令"><a href="#管理命令" class="headerlink" title="管理命令"></a>管理命令</h2><p>w 显示当前登录到系统的用户有哪些，以及其正在做什么</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zhou@zhoulijie ~]$ w</span><br><span class="line"> 20:36:03 up 18 min,  2 users,  load average: 0.00, 0.01, 0.05</span><br><span class="line">USER     TTY        LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     tty1      20:18   17:47   0.02s  0.02s -bash</span><br><span class="line">root     pts/0     20:18    3.00s  0.13s  0.04s w</span><br></pre></td></tr></table></figure>

<p> sleep   //睡眠</p>
<blockquote>
<p>   s:秒，默认<br>   m：分<br>   h：小时<br>   d：天</p>
</blockquote>
<p>last   显示/var/log/wtmp文件，显示用户登录历史及系统重启历史 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zhou@zhoulijie ~]$ last</span><br><span class="line">root     pts/0        192.168.83.1     Mon Apr  8 20:18   still logged <span class="keyword">in</span></span><br><span class="line">root     tty1                          Mon Apr  8 20:18   still logged <span class="keyword">in</span></span><br><span class="line">reboot   system boot  3.10.0-123.el7.x Mon Apr  8 20:17 - 20:37  (00:19)</span><br><span class="line">............................以下省略............................</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​     -n #  显示最近#次的相关信息    </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zhou@zhoulijie ~]$ last -n 2</span><br><span class="line">root     pts/0        192.168.83.1     Mon Apr  8 20:18   still logged <span class="keyword">in</span></span><br><span class="line">root     tty1                          Mon Apr  8 20:18   still logged <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">wtmp begins Wed Mar  6 16:48:05 2019</span><br></pre></td></tr></table></figure>

<p> lastb  显示/var/log/btmp文件，显示用户错误的登录尝试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># lastb</span></span><br><span class="line">root     ssh:notty    192.168.83.1     Wed Mar 27 09:48 - 09:48  (00:00)</span><br><span class="line">root     pts/0                         Wed Mar  6 17:16 - 17:16  (00:00)</span><br><span class="line">root     tty1                          Wed Mar  6 16:48 - 16:48  (00:00)</span><br><span class="line"></span><br><span class="line">btmp begins Wed Mar  6 16:48:38 2019</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​     -n #  显示最近#次的相关信息    </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># lastb -n 2</span></span><br><span class="line">root     ssh:notty    192.168.83.1     Wed Mar 27 09:48 - 09:48  (00:00)</span><br><span class="line">root     pts/0                         Wed Mar  6 17:16 - 17:16  (00:00)</span><br><span class="line"></span><br><span class="line">btmp begins Wed Mar  6 16:48:38 2019</span><br></pre></td></tr></table></figure>

<p>lastlog   显示每个用户最近一次成功登录信息  </p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># lastlog</span></span><br><span class="line">用户名           端口     来自             最后登陆时间</span><br><span class="line">root             pts/0                     一 4月  8 20:42:13 +0800 2019</span><br><span class="line">bin                                        **从未登录过**</span><br><span class="line">daemon                                     **从未登录过**</span><br><span class="line">adm                                        **从未登录过**</span><br><span class="line">lp                                         **从未登录过**</span><br><span class="line">sync                                       **从未登录过**</span><br><span class="line">shutdown                                   **从未登录过**</span><br><span class="line">............................以下省略............................</span><br></pre></td></tr></table></figure>

<blockquote>
<p> -u username     //显示特定用户最近的登录信息      </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zhoulijie ~]<span class="comment"># lastlog -u zhou</span></span><br><span class="line">用户名           端口     来自             最后登陆时间</span><br><span class="line">zhou             pts/0                     一 4月  8 20:28:24 +0800 2019</span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>1、新建一个没有家目录的用户openstack</p>
<p><strong>useradd -M openstack</strong></p>
<p> 2、复制/etc/skel为/home/openstack</p>
<p><strong>cp -r -p /etc/skel /home/openstack</strong></p>
<p> 3、改变/home/openstack及其内部文件的属主属组均为openstack</p>
<p><strong>chown -R openstack:openstack /home/openstack/</strong></p>
<p> 4、设置/home/openstack及其内部的文件，属组和其它用户没有任何访问权限 </p>
<p><strong>chmod -R 700 /home/openstack</strong></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/chineselijie/2019/08/29/4.linux--权限管理/" data-id="ck7ooyahs00234su62njcizpg"
        class="article-share-link">分享</a>
        
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux基础/">linux基础</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2019-2020
        Li Jie
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <ul class="list-inline">
  <li>PV:<span id="busuanzi_value_page_pv"></span></li>
  <li>UV:<span id="busuanzi_value_site_uv"></span></li>
</ul>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer.png" alt="Li Jie&#39;s blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>喜欢就打赏吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>

<script src="/fancybox/jquery.fancybox.min.js"></script>



<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['面朝大海，春暖花开','愿你一生努力，一生被爱','想要的都拥有，得不到的都释怀'],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: false
  }
</script>

<script src="/js/ayer.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>




<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>